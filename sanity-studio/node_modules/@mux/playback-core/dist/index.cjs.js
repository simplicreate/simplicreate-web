"use strict";var Ht=Object.create;var z=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var Vt=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty;var Yt=(e,t)=>{for(var r in t)z(e,r,{get:t[r],enumerable:!0})},Le=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Wt(t))!Ft.call(e,o)&&o!==r&&z(e,o,{get:()=>t[o],enumerable:!(n=Kt(t,o))||n.enumerable});return e};var _e=(e,t,r)=>(r=e!=null?Ht(Vt(e)):{},Le(t||!e||!e.__esModule?z(r,"default",{value:e,enumerable:!0}):r,e)),$t=e=>Le(z({},"__esModule",{value:!0}),e);var Pr={};Yt(Pr,{AutoplayTypes:()=>W,CmcdTypeValues:()=>jt,CmcdTypes:()=>N,ExtensionMimeTypeMap:()=>w,Hls:()=>R,MaxAutoResolution:()=>Qt,MaxResolution:()=>qt,MediaError:()=>m,MimeTypeShorthandMap:()=>V,MinCapLevelController:()=>B,MinResolution:()=>Gt,MuxErrorCategory:()=>v,MuxErrorCode:()=>C,MuxJWTAud:()=>te,PlaybackTypes:()=>q,RenditionOrder:()=>Xt,StreamTypes:()=>L,addChapters:()=>Te,addCuePoints:()=>le,addTextTrack:()=>ee,allMediaTypes:()=>zt,errorCategoryToTokenNameOrPrefix:()=>K,fetchAndDispatchMuxMetadata:()=>ne,generatePlayerInitTime:()=>gr,generateUUID:()=>Mt,getActiveChapter:()=>me,getActiveCuePoint:()=>pe,getAppCertificate:()=>_t,getCapLevelControllerConfig:()=>St,getChapters:()=>ze,getCoreReference:()=>vr,getCuePoints:()=>je,getCurrentPdt:()=>Ge,getDRMConfig:()=>Lt,getEnded:()=>Ct,getError:()=>bt,getLicenseKey:()=>wt,getLiveEdgeStart:()=>Cr,getMediaPlaylistFromMultivariantPlaylist:()=>ut,getMetadata:()=>Rr,getMultivariantPlaylistSessionData:()=>dt,getSeekable:()=>xe,getStartDate:()=>qe,getStreamInfoFromHlsjsLevelDetails:()=>Tt,getStreamInfoFromPlaylist:()=>pt,getStreamInfoFromSrcAndType:()=>ft,getStreamType:()=>Me,getStreamTypeConfig:()=>ht,getTargetLiveWindow:()=>xr,getTextTrack:()=>O,i18n:()=>x,initialize:()=>vt,isKeyOf:()=>U,isMuxVideoSrc:()=>ke,isPseudoEnded:()=>xt,isStuckOnLastFragment:()=>ve,loadMedia:()=>Nt,mux:()=>J.default,muxMediaState:()=>k,parseJwt:()=>X,parseTagAttributes:()=>lt,removeTextTrack:()=>Ye,setupChapters:()=>Ee,setupCuePoints:()=>fe,setupHls:()=>Pt,setupMux:()=>It,setupNativeFairplayDRM:()=>At,shorthandKeys:()=>Jt,teardown:()=>Dt,toAppCertURL:()=>De,toDRMTypeFromKeySystem:()=>ct,toLicenseKeyURL:()=>j,toMuxVideoURL:()=>Mr,toPlaybackIdFromSrc:()=>Re,toPlaybackIdParts:()=>F,updateStreamInfoFromHlsjsLevelDetails:()=>mt,updateStreamInfoFromSrc:()=>yt});module.exports=$t(Pr);var J=_e(require("mux-embed"));var we=_e(require("hls.js")),R=we.default;var it=require("hls.js");var v={VIDEO:"video",THUMBNAIL:"thumbnail",STORYBOARD:"storyboard",DRM:"drm"},C={NOT_AN_ERROR:0,NETWORK_OFFLINE:2000002,NETWORK_UNKNOWN_ERROR:2e6,NETWORK_NO_STATUS:2000001,NETWORK_INVALID_URL:24e5,NETWORK_NOT_FOUND:2404e3,NETWORK_NOT_READY:2412e3,NETWORK_GENERIC_SERVER_FAIL:25e5,NETWORK_TOKEN_MISSING:2403201,NETWORK_TOKEN_MALFORMED:2412202,NETWORK_TOKEN_EXPIRED:2403210,NETWORK_TOKEN_AUD_MISSING:2403221,NETWORK_TOKEN_AUD_MISMATCH:2403222,NETWORK_TOKEN_SUB_MISMATCH:2403232,ENCRYPTED_ERROR:5e6,ENCRYPTED_UNSUPPORTED_KEY_SYSTEM:5000001,ENCRYPTED_GENERATE_REQUEST_FAILED:5000002,ENCRYPTED_UPDATE_LICENSE_FAILED:5000003,ENCRYPTED_UPDATE_SERVER_CERT_FAILED:5000004,ENCRYPTED_CDM_ERROR:5000005,ENCRYPTED_OUTPUT_RESTRICTED:5000006,ENCRYPTED_MISSING_TOKEN:5000002},K=e=>e===v.VIDEO?"playback":e,_=class _ extends Error{constructor(t,r=_.MEDIA_ERR_CUSTOM,n,o){var s;super(t),this.name="MediaError",this.code=r,this.context=o,this.fatal=n!=null?n:r>=_.MEDIA_ERR_NETWORK&&r<=_.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(s=_.defaultMessages[this.code])!=null?s:"")}};_.MEDIA_ERR_ABORTED=1,_.MEDIA_ERR_NETWORK=2,_.MEDIA_ERR_DECODE=3,_.MEDIA_ERR_SRC_NOT_SUPPORTED=4,_.MEDIA_ERR_ENCRYPTED=5,_.MEDIA_ERR_CUSTOM=100,_.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var m=_;var Bt=e=>e==null,U=(e,t)=>Bt(t)?!1:e in t,W={ANY:"any",MUTED:"muted"},L={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},q={MSE:"mse",NATIVE:"native"},N={HEADER:"header",QUERY:"query",NONE:"none"},jt=Object.values(N),w={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},V={HLS:w.M3U8},Jt=Object.keys(V),zt=[...Object.values(w),"hls","HLS"],qt={upTo720p:"720p",upTo1080p:"1080p",upTo1440p:"1440p",upTo2160p:"2160p"},Gt={noLessThan480p:"480p",noLessThan540p:"540p",noLessThan720p:"720p",noLessThan1080p:"1080p",noLessThan1440p:"1440p",noLessThan2160p:"2160p"},Xt={DESCENDING:"desc"},Qt={upTo720p:"720p",upTo1080p:"1080p",upTo1440p:"1440p",upTo2160p:"2160p"};var Zt="en",G={code:Zt};var P=(e,t,r,n,o=e)=>{o.addEventListener(t,r,n),e.addEventListener("teardown",()=>{o.removeEventListener(t,r)},{once:!0})};function Ae(e,t,r){t&&r>t&&(r=t);for(let n=0;n<e.length;n++)if(e.start(n)<=r&&e.end(n)>=r)return!0;return!1}var F=e=>{let t=e.indexOf("?");if(t<0)return[e];let r=e.slice(0,t),n=e.slice(t);return[r,n]},Y=e=>{let{type:t}=e;if(t){let r=t.toUpperCase();return U(r,V)?V[r]:t}return er(e)},se=e=>e==="VOD"?L.ON_DEMAND:L.LIVE,ie=e=>e==="EVENT"?Number.POSITIVE_INFINITY:e==="VOD"?Number.NaN:0,er=e=>{let{src:t}=e;if(!t)return"";let r="";try{r=new URL(t).pathname}catch{console.error("invalid url")}let n=r.lastIndexOf(".");if(n<0)return rr(e)?w.M3U8:"";let s=r.slice(n+1).toUpperCase();return U(s,w)?w[s]:""},tr="mux.com",rr=({src:e,customDomain:t=tr})=>{let r;try{r=new URL(`${e}`)}catch{return!1}let n=r.protocol==="https:",o=r.hostname===`stream.${t}`.toLowerCase(),s=r.pathname.split("/"),a=s.length===2,i=!(s!=null&&s[1].includes("."));return n&&o&&a&&i},X=e=>{let t=(e!=null?e:"").split(".")[1];if(t)try{let r=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(r).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch{return}},Se=({exp:e},t=Date.now())=>!e||e*1e3<t,Ie=({sub:e},t)=>e!==t,Ne=({aud:e},t)=>!e,Oe=({aud:e},t)=>e!==t,Ue="en";function x(e,t=!0){var o,s;let r=t&&(s=(o=G)==null?void 0:o[e])!=null?s:e,n=t?G.code:Ue;return new ae(r,n)}var ae=class{constructor(t,r=(n=>(n=G)!=null?n:Ue)()){this.message=t,this.locale=r}format(t){return this.message.replace(/\{(\w+)\}/g,(r,n)=>{var o;return(o=t[n])!=null?o:""})}toString(){return this.message}};var nr=Object.values(W),He=e=>typeof e=="boolean"||typeof e=="string"&&nr.includes(e),Ke=(e,t,r)=>{let{autoplay:n}=e,o=!1,s=!1,a=He(n)?n:!!n,i=()=>{o||P(t,"playing",()=>{o=!0},{once:!0})};if(i(),P(t,"loadstart",()=>{o=!1,i(),ce(t,a)},{once:!0}),P(t,"loadstart",()=>{r||(e.streamType&&e.streamType!==L.UNKNOWN?s=e.streamType===L.LIVE:s=!Number.isFinite(t.duration)),ce(t,a)},{once:!0}),r&&r.once(R.Events.LEVEL_LOADED,(d,f)=>{var u;e.streamType&&e.streamType!==L.UNKNOWN?s=e.streamType===L.LIVE:s=(u=f.details.live)!=null?u:!1}),!a){let d=()=>{!s||Number.isFinite(e.startTime)||(r!=null&&r.liveSyncPosition?t.currentTime=r.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};r&&P(t,"play",()=>{t.preload==="metadata"?r.once(R.Events.LEVEL_UPDATED,d):d()},{once:!0})}return d=>{o||(a=He(d)?d:!!d,ce(t,a))}},ce=(e,t)=>{if(!t)return;let r=e.muted,n=()=>e.muted=r;switch(t){case W.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(n)});break;case W.MUTED:e.muted=!0,e.play().catch(n);break;default:e.play().catch(()=>{});break}};var We=({preload:e,src:t},r,n)=>{let o=u=>{u!=null&&["","none","metadata","auto"].includes(u)?r.setAttribute("preload",u):r.removeAttribute("preload")};if(!n)return o(e),o;let s=!1,a=!1,i=n.config.maxBufferLength,c=n.config.maxBufferSize,d=u=>{o(u);let p=u!=null?u:r.preload;a||p==="none"||(p==="metadata"?(n.config.maxBufferLength=1,n.config.maxBufferSize=1):(n.config.maxBufferLength=i,n.config.maxBufferSize=c),f())},f=()=>{!s&&t&&(s=!0,n.loadSource(t))};return P(r,"play",()=>{a=!0,n.config.maxBufferLength=i,n.config.maxBufferSize=c,f()},{once:!0}),d(e),d};function Ve(e,t){var i;if(!("videoTracks"in e))return;let r=new WeakMap;t.on(R.Events.MANIFEST_PARSED,function(c,d){a();let f=e.addVideoTrack("main");f.selected=!0;for(let[u,p]of d.levels.entries()){let l=f.addRendition(p.url[0],p.width,p.height,p.videoCodec,p.bitrate);r.set(p,`${u}`),l.id=`${u}`}}),t.on(R.Events.AUDIO_TRACKS_UPDATED,function(c,d){s();for(let f of d.audioTracks){let u=f.default?"main":"alternative",p=e.addAudioTrack(u,f.name,f.lang);p.id=`${f.id}`,f.default&&(p.enabled=!0)}}),e.audioTracks.addEventListener("change",()=>{var f;let c=+((f=[...e.audioTracks].find(u=>u.enabled))==null?void 0:f.id),d=t.audioTracks.map(u=>u.id);c!=t.audioTrack&&d.includes(c)&&(t.audioTrack=c)}),t.on(R.Events.LEVELS_UPDATED,function(c,d){var p;let f=e.videoTracks[(p=e.videoTracks.selectedIndex)!=null?p:0];if(!f)return;let u=d.levels.map(l=>r.get(l));for(let l of e.videoRenditions)l.id&&!u.includes(l.id)&&f.removeRendition(l)});let n=c=>{let d=c.target.selectedIndex;d!=t.nextLevel&&(t.nextLevel=d)};(i=e.videoRenditions)==null||i.addEventListener("change",n);let o=()=>{for(let c of e.videoTracks)e.removeVideoTrack(c)},s=()=>{for(let c of e.audioTracks)e.removeAudioTrack(c)},a=()=>{o(),s()};t.once(R.Events.DESTROYING,a)}var ue=e=>"time"in e?e.time:e.startTime;function Fe(e,t){t.on(R.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(o,{tracks:s})=>{s.forEach(a=>{var f,u;let i=(f=a.subtitleTrack)!=null?f:a.closedCaptions,c=t.subtitleTracks.findIndex(({lang:p,name:l,type:T})=>p==(i==null?void 0:i.lang)&&l===a.label&&T.toLowerCase()===a.kind),d=((u=a._id)!=null?u:a.default)?"default":`${a.kind}${c}`;ee(e,a.kind,a.label,i==null?void 0:i.lang,d,a.default)})});let r=()=>{if(!t.subtitleTracks.length)return;let o=Array.from(e.textTracks).find(i=>i.id&&i.mode==="showing"&&["subtitles","captions"].includes(i.kind));if(!o)return;let s=t.subtitleTracks[t.subtitleTrack],a=s?s.default?"default":`${t.subtitleTracks[t.subtitleTrack].type.toLowerCase()}${t.subtitleTrack}`:void 0;if(t.subtitleTrack<0||(o==null?void 0:o.id)!==a){let i=t.subtitleTracks.findIndex(({lang:c,name:d,type:f,default:u})=>o.id==="default"&&u||c==o.language&&d===o.label&&f.toLowerCase()===o.kind);t.subtitleTrack=i}(o==null?void 0:o.id)===a&&o.cues&&Array.from(o.cues).forEach(i=>{o.addCue(i)})};e.textTracks.addEventListener("change",r),t.on(R.Events.CUES_PARSED,(o,{track:s,cues:a})=>{let i=e.textTracks.getTrackById(s);if(!i)return;let c=i.mode==="disabled";c&&(i.mode="hidden"),a.forEach(d=>{var f;(f=i.cues)!=null&&f.getCueById(d.id)||i.addCue(d)}),c&&(i.mode="disabled")}),t.once(R.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",r),e.querySelectorAll("track[data-removeondestroy]").forEach(s=>{s.remove()})});let n=()=>{Array.from(e.textTracks).forEach(o=>{var s,a;if(!["subtitles","caption"].includes(o.kind)&&(o.label==="thumbnails"||o.kind==="chapters")){if(!((s=o.cues)!=null&&s.length)){let i="track";o.kind&&(i+=`[kind="${o.kind}"]`),o.label&&(i+=`[label="${o.label}"]`);let c=e.querySelector(i),d=(a=c==null?void 0:c.getAttribute("src"))!=null?a:"";c==null||c.removeAttribute("src"),setTimeout(()=>{c==null||c.setAttribute("src",d)},0)}o.mode!=="hidden"&&(o.mode="hidden")}})};t.once(R.Events.MANIFEST_LOADED,n),t.once(R.Events.MEDIA_ATTACHED,n)}function ee(e,t,r,n,o,s){let a=document.createElement("track");return a.kind=t,a.label=r,n&&(a.srclang=n),o&&(a.id=o),s&&(a.default=!0),a.track.mode=["subtitles","captions"].includes(t)?"disabled":"hidden",a.setAttribute("data-removeondestroy",""),e.append(a),a.track}function Ye(e,t){let r=Array.prototype.find.call(e.querySelectorAll("track"),n=>n.track===t);r==null||r.remove()}function O(e,t,r){var n;return(n=Array.from(e.querySelectorAll("track")).find(o=>o.track.label===t&&o.track.kind===r))==null?void 0:n.track}async function $e(e,t,r,n){let o=O(e,r,n);return o||(o=ee(e,n,r),o.mode="hidden",await new Promise(s=>setTimeout(()=>s(void 0),0))),o.mode!=="hidden"&&(o.mode="hidden"),[...t].sort((s,a)=>ue(a)-ue(s)).forEach(s=>{var c,d;let a=s.value,i=ue(s);if("endTime"in s&&s.endTime!=null)o==null||o.addCue(new VTTCue(i,s.endTime,n==="chapters"?a:JSON.stringify(a!=null?a:null)));else{let f=Array.prototype.findIndex.call(o==null?void 0:o.cues,T=>T.startTime>=i),u=(c=o==null?void 0:o.cues)==null?void 0:c[f],p=u?u.startTime:Number.isFinite(e.duration)?e.duration:Number.MAX_SAFE_INTEGER,l=(d=o==null?void 0:o.cues)==null?void 0:d[f-1];l&&(l.endTime=i),o==null||o.addCue(new VTTCue(i,p,n==="chapters"?a:JSON.stringify(a!=null?a:null)))}}),e.textTracks.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),o}var de="cuepoints",Be=Object.freeze({label:de});async function le(e,t,r=Be){return $e(e,t,r.label,"metadata")}var Q=e=>({time:e.startTime,value:JSON.parse(e.text)});function je(e,t={label:de}){let r=O(e,t.label,"metadata");return r!=null&&r.cues?Array.from(r.cues,n=>Q(n)):[]}function pe(e,t={label:de}){var s,a;let r=O(e,t.label,"metadata");if(!((s=r==null?void 0:r.activeCues)!=null&&s.length))return;if(r.activeCues.length===1)return Q(r.activeCues[0]);let{currentTime:n}=e,o=Array.prototype.find.call((a=r.activeCues)!=null?a:[],({startTime:i,endTime:c})=>i<=n&&c>n);return Q(o||r.activeCues[0])}async function fe(e,t=Be){return new Promise(r=>{P(e,"loadstart",async()=>{let n=await le(e,[],t);P(e,"cuechange",()=>{let o=pe(e);if(o){let s=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:o});e.dispatchEvent(s)}},{},n),r(n)})})}var ye="chapters",Je=Object.freeze({label:ye}),Z=e=>({startTime:e.startTime,endTime:e.endTime,value:e.text});async function Te(e,t,r=Je){return $e(e,t,r.label,"chapters")}function ze(e,t={label:ye}){var n;let r=O(e,t.label,"chapters");return(n=r==null?void 0:r.cues)!=null&&n.length?Array.from(r.cues,o=>Z(o)):[]}function me(e,t={label:ye}){var s,a;let r=O(e,t.label,"chapters");if(!((s=r==null?void 0:r.activeCues)!=null&&s.length))return;if(r.activeCues.length===1)return Z(r.activeCues[0]);let{currentTime:n}=e,o=Array.prototype.find.call((a=r.activeCues)!=null?a:[],({startTime:i,endTime:c})=>i<=n&&c>n);return Z(o||r.activeCues[0])}async function Ee(e,t=Je){return new Promise(r=>{P(e,"loadstart",async()=>{let n=await Te(e,[],t);P(e,"cuechange",()=>{let o=me(e);if(o){let s=new CustomEvent("chapterchange",{composed:!0,bubbles:!0,detail:o});e.dispatchEvent(s)}},{},n),r(n)})})}function qe(e,t){if(t){let r=t.playingDate;if(r!=null)return new Date(r.getTime()-e.currentTime*1e3)}return typeof e.getStartDate=="function"?e.getStartDate():new Date(NaN)}function Ge(e,t){if(t&&t.playingDate)return t.playingDate;if(typeof e.getStartDate=="function"){let r=e.getStartDate();return new Date(r.getTime()+e.currentTime*1e3)}return new Date(NaN)}var te={VIDEO:"v",THUMBNAIL:"t",STORYBOARD:"s",DRM:"d"},or=e=>{if(e===v.VIDEO)return te.VIDEO;if(e===v.DRM)return te.DRM},ar=(e,t)=>{var o,s;let r=K(e),n=`${r}Token`;return(o=t.tokens)!=null&&o[r]?(s=t.tokens)==null?void 0:s[r]:U(n,t)?t[n]:void 0},$=(e,t,r,n,o=!1,s=!(a=>(a=globalThis.navigator)==null?void 0:a.onLine)())=>{var E,D;if(s){let g=x("Your device appears to be offline",o),b=void 0,y=m.MEDIA_ERR_NETWORK,h=new m(g,y,!1,b);return h.errorCategory=t,h.muxCode=C.NETWORK_OFFLINE,h.data=e,h}let i="status"in e?e.status:e.code,c=Date.now(),d=m.MEDIA_ERR_NETWORK;if(i===200)return;let f=K(t),u=ar(t,r),p=or(t),[l]=F((E=r.playbackId)!=null?E:"");if(!i||!l)return;let T=X(u);if(u&&!T){let g=x("The {tokenNamePrefix}-token provided is invalid or malformed.",o).format({tokenNamePrefix:f}),b=x("Compact JWT string: {token}",o).format({token:u}),y=new m(g,d,!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_TOKEN_MALFORMED,y.data=e,y}if(i>=500){let g=new m("",d,n!=null?n:!0);return g.errorCategory=t,g.muxCode=C.NETWORK_UNKNOWN_ERROR,g}if(i===403)if(T){if(Se(T,c)){let g={timeStyle:"medium",dateStyle:"medium"},b=x("The video\u2019s secured {tokenNamePrefix}-token has expired.",o).format({tokenNamePrefix:f}),y=x("Expired at: {expiredDate}. Current time: {currentDate}.",o).format({expiredDate:new Intl.DateTimeFormat("en",g).format((D=T.exp)!=null?D:0*1e3),currentDate:new Intl.DateTimeFormat("en",g).format(c)}),h=new m(b,d,!0,y);return h.errorCategory=t,h.muxCode=C.NETWORK_TOKEN_EXPIRED,h.data=e,h}if(Ie(T,l)){let g=x("The video\u2019s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",o).format({tokenNamePrefix:f}),b=x("Specified playback ID: {playbackId} and the playback ID encoded in the {tokenNamePrefix}-token: {tokenPlaybackId}",o).format({tokenNamePrefix:f,playbackId:l,tokenPlaybackId:T.sub}),y=new m(g,d,!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_TOKEN_SUB_MISMATCH,y.data=e,y}if(Ne(T,p)){let g=x("The {tokenNamePrefix}-token is formatted with incorrect information.",o).format({tokenNamePrefix:f}),b=x("The {tokenNamePrefix}-token has no aud value. aud value should be {expectedAud}.",o).format({tokenNamePrefix:f,expectedAud:p}),y=new m(g,d,!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_TOKEN_AUD_MISSING,y.data=e,y}if(Oe(T,p)){let g=x("The {tokenNamePrefix}-token is formatted with incorrect information.",o).format({tokenNamePrefix:f}),b=x("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.",o).format({tokenNamePrefix:f,expectedAud:p,aud:T.aud}),y=new m(g,d,!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_TOKEN_AUD_MISMATCH,y.data=e,y}}else{let g=x("Authorization error trying to access this {category} URL. If this is a signed URL, you might need to provide a {tokenNamePrefix}-token.",o).format({tokenNamePrefix:f,category:t}),b=x("Specified playback ID: {playbackId}",o).format({playbackId:l}),y=new m(g,d,n!=null?n:!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_TOKEN_MISSING,y.data=e,y}if(i===412){let g=x("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",o),b=x("Specified playback ID: {playbackId}",o).format({playbackId:l}),y=new m(g,d,n!=null?n:!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_NOT_READY,y.streamType=r.streamType===L.LIVE?"live":r.streamType===L.ON_DEMAND?"on-demand":"unknown",y.data=e,y}if(i===404){let g=x("This URL or playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",o),b=x("Specified playback ID: {playbackId}",o).format({playbackId:l}),y=new m(g,d,n!=null?n:!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_NOT_FOUND,y.data=e,y}if(i===400){let g=x("The URL or playback-id was invalid. You may have used an invalid value as a playback-id."),b=x("Specified playback ID: {playbackId}",o).format({playbackId:l}),y=new m(g,d,n!=null?n:!0,b);return y.errorCategory=t,y.muxCode=C.NETWORK_INVALID_URL,y.data=e,y}let M=new m("",d,n!=null?n:!0);return M.errorCategory=t,M.muxCode=C.NETWORK_UNKNOWN_ERROR,M.data=e,M};var Xe=R.DefaultConfig.capLevelController,sr={"720p":921600,"1080p":2073600,"1440p":4194304,"2160p":8294400};function ir(e){let t=e.toLowerCase().trim();return sr[t]}var S=class S extends Xe{constructor(t){super(t)}static setMaxAutoResolution(t,r){r?S.maxAutoResolution.set(t,r):S.maxAutoResolution.delete(t)}getMaxAutoResolution(){var r;let t=this.hls;return(r=S.maxAutoResolution.get(t))!=null?r:void 0}get levels(){var t;return(t=this.hls.levels)!=null?t:[]}getValidLevels(t){return this.levels.filter((r,n)=>this.isLevelAllowed(r)&&n<=t)}getMaxLevelCapped(t){let r=this.getValidLevels(t),n=this.getMaxAutoResolution();if(!n)return super.getMaxLevel(t);let o=ir(n);if(!o)return super.getMaxLevel(t);let s=r.filter(c=>c.width*c.height<=o),a=s.findIndex(c=>c.width*c.height===o);if(a!==-1){let c=s[a];return r.findIndex(d=>d===c)}if(s.length===0)return 0;let i=s[s.length-1];return r.findIndex(c=>c===i)}getMaxLevel(t){if(this.getMaxAutoResolution()!==void 0)return this.getMaxLevelCapped(t);let r=super.getMaxLevel(t),n=this.getValidLevels(t);if(!n[r])return r;let o=Math.min(n[r].width,n[r].height),s=S.minMaxResolution;return o>=s?r:Xe.getMaxLevelByMediaSize(n,s*(16/9),s)}};S.minMaxResolution=720,S.maxAutoResolution=new WeakMap;var ge=S,B=ge;var cr="com.apple.fps.1_0",ur="application/vnd.apple.mpegurl",Qe=({mediaEl:e,getAppCertificate:t,getLicenseKey:r,saveAndDispatchError:n,drmTypeCb:o})=>{if(!window.WebKitMediaKeys||!("onwebkitneedkey"in e)){console.error("No WebKitMediaKeys. FairPlay may not be supported");let p=x("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),l=new m(p,m.MEDIA_ERR_ENCRYPTED,!0);return l.errorCategory=v.DRM,l.muxCode=C.ENCRYPTED_CDM_ERROR,n(e,l),()=>{}}let s=e,a=t(),i=null,c=p=>{(async()=>{try{s.webkitKeys||d();let T=await a;if(p.initData===null||T==null)return;let M=dr(p.initData,T);f(M)}catch(T){console.error("Could not start encrypted playback due to exception",T),n(s,T)}})()},d=()=>{try{let p=new WebKitMediaKeys(cr);s.webkitSetMediaKeys(p),o()}catch{let p="Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser.",l=new m(p,m.MEDIA_ERR_ENCRYPTED,!0);throw l.errorCategory=v.DRM,l.muxCode=C.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,l}},f=p=>{let l=s.webkitKeys.createSession(ur,p),T=async D=>{try{let g=D.message,b=await r(g);l.update(b)}catch(g){console.error("Error on FairPlay session message",g),n(e,g)}},M=D=>{let g=D.target.error;if(!g)return;console.error(`Internal Webkit Key Session Error - sysCode: ${g.systemCode} code: ${g.code}`);let b=x("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser."),y=new m(b,m.MEDIA_ERR_ENCRYPTED,!0);y.errorCategory=v.DRM,y.muxCode=C.ENCRYPTED_CDM_ERROR,n(e,y)},E=()=>{l.removeEventListener("webkitkeymessage",T),l.removeEventListener("webkitkeyerror",M),e.removeEventListener("teardown",E),"webkitCurrentPlaybackTargetIsWireless"in e&&e.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",E),i=null;try{l.close()}catch{}};"webkitCurrentPlaybackTargetIsWireless"in e&&e.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",E,{once:!0}),l.addEventListener("webkitkeymessage",T),l.addEventListener("webkitkeyerror",M),e.addEventListener("teardown",E),i=E},u=()=>{e.removeEventListener("webkitneedkey",c),e.removeEventListener("teardown",u),i==null||i();try{s.webkitSetMediaKeys(null)}catch{}};return e.addEventListener("webkitneedkey",c),e.addEventListener("teardown",u,{once:!0}),u},dr=(e,t)=>{let r=pr(lr(e)),n=new Uint8Array(e),o=new Uint8Array(r),s=new Uint8Array(t),a=n.byteLength+4+s.byteLength+4+o.byteLength,i=new Uint8Array(a),c=0,d=u=>{i.set(u,c),c+=u.byteLength},f=u=>{let p=new DataView(i.buffer),l=u.byteLength;p.setUint32(c,l,!0),c+=4,d(u)};return d(n),f(o),f(s),i},lr=e=>new TextDecoder("utf-16le").decode(e).replace("skd://","").slice(1);function pr(e){let t=new ArrayBuffer(e.length*2),r=new DataView(t);for(let n=0;n<e.length;n++)r.setUint16(n*2,e.charCodeAt(n),!0);return t}var Ze=({mediaEl:e,getAppCertificate:t,getLicenseKey:r,saveAndDispatchError:n,drmTypeCb:o,fallbackToWebkitFairplay:s})=>{let a=null,i=async u=>{try{let p=u.initDataType;if(p!=="skd"){console.error(`Received unexpected initialization data type "${p}"`);return}e.mediaKeys||await c(p);let l=u.initData;if(l==null){console.error(`Could not start encrypted playback due to missing initData in ${u.type} event`);return}await d(p,l)}catch(p){n(e,p);return}},c=async u=>{let p=await navigator.requestMediaKeySystemAccess("com.apple.fps",[{initDataTypes:[u],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}]).then(T=>(o(),T)).catch(()=>{let T=x("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),M=new m(T,m.MEDIA_ERR_ENCRYPTED,!0);M.errorCategory=v.DRM,M.muxCode=C.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,n(e,M)});if(!p)return;let l=await p.createMediaKeys();try{let T=await t();await l.setServerCertificate(T).catch(()=>{let M=x("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),E=new m(M,m.MEDIA_ERR_ENCRYPTED,!0);return E.errorCategory=v.DRM,E.muxCode=C.ENCRYPTED_UPDATE_SERVER_CERT_FAILED,Promise.reject(E)})}catch(T){n(e,T);return}await e.setMediaKeys(l)},d=async(u,p)=>{let l=e.mediaKeys.createSession(),T=async D=>{let g=D.message,b=await r(g);try{await l.update(b)}catch{let y=x("Failed to update DRM license. This may be an issue with the player or your protected content."),h=new m(y,m.MEDIA_ERR_ENCRYPTED,!0);h.errorCategory=v.DRM,h.muxCode=C.ENCRYPTED_UPDATE_LICENSE_FAILED,n(e,h)}},M=()=>{let D=g=>{let b;if(g==="internal-error"){let y=x("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");b=new m(y,m.MEDIA_ERR_ENCRYPTED,!0),b.errorCategory=v.DRM,b.muxCode=C.ENCRYPTED_CDM_ERROR}else if(g==="output-restricted"||g==="output-downscaled"){let y=x("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");b=new m(y,m.MEDIA_ERR_ENCRYPTED,!1),b.errorCategory=v.DRM,b.muxCode=C.ENCRYPTED_OUTPUT_RESTRICTED}b&&n(e,b)};l.keyStatuses.forEach(g=>D(g))};l.addEventListener("keystatuseschange",M),l.addEventListener("message",T);let E=async()=>{l.removeEventListener("keystatuseschange",M),l.removeEventListener("message",T),"webkitCurrentPlaybackTargetIsWireless"in e&&e.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",E),e.removeEventListener("teardown",E),await l.close().catch(D=>{console.warn("There was an error when closing EME session",D)}),a=null};"webkitCurrentPlaybackTargetIsWireless"in e&&e.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",E,{once:!0}),e.addEventListener("teardown",E,{once:!0}),a=E,await l.generateRequest(u,p).catch(async D=>{if(D.name==="NotSupportedError"&&"webkitCurrentPlaybackTargetIsWireless"in e&&e.webkitCurrentPlaybackTargetIsWireless)console.warn("Failed to generate a DRM license request. Attempting to fallback to Webkit DRM"),s==null||s();else{let g=x("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),b=new m(g,m.MEDIA_ERR_ENCRYPTED,!0);return b.errorCategory=v.DRM,b.muxCode=C.ENCRYPTED_GENERATE_REQUEST_FAILED,console.error("Failed to generate license request",D),Promise.reject(b)}})},f=async()=>{e.removeEventListener("encrypted",i),e.removeEventListener("teardown",f),a&&await a(),await e.setMediaKeys(null).catch(()=>{})};return e.addEventListener("encrypted",i),e.addEventListener("teardown",f,{once:!0}),f};var re={FAIRPLAY:"fairplay",PLAYREADY:"playready",WIDEVINE:"widevine"},ct=e=>{if(e.includes("fps"))return re.FAIRPLAY;if(e.includes("playready"))return re.PLAYREADY;if(e.includes("widevine"))return re.WIDEVINE},ut=e=>{let t=e.split(`
`).find((r,n,o)=>n&&o[n-1].startsWith("#EXT-X-STREAM-INF"));return fetch(t).then(r=>r.status!==200?Promise.reject(r):r.text())},dt=e=>{let t=e.split(`
`).filter(n=>n.startsWith("#EXT-X-SESSION-DATA"));if(!t.length)return{};let r={};for(let n of t){let o=lt(n),s=o["DATA-ID"];s&&(r[s]={...o})}return{sessionData:r}},fr=/([A-Z0-9-]+)="?(.*?)"?(?:,|$)/g;function lt(e){let t=[...e.matchAll(fr)];return Object.fromEntries(t.map(([,r,n])=>[r,n]))}var pt=e=>{var i,c,d;let t=e.split(`
`),n=(c=((i=t.find(f=>f.startsWith("#EXT-X-PLAYLIST-TYPE")))!=null?i:"").split(":")[1])==null?void 0:c.trim(),o=se(n),s=ie(n),a;if(o===L.LIVE){let f=t.find(p=>p.startsWith("#EXT-X-PART-INF"));if(!!f)a=+f.split(":")[1].split("=")[1]*2;else{let p=t.find(M=>M.startsWith("#EXT-X-TARGETDURATION")),l=(d=p==null?void 0:p.split(":"))==null?void 0:d[1];a=+(l!=null?l:6)*3}}return{streamType:o,targetLiveWindow:s,liveEdgeStartOffset:a}},ft=async(e,t)=>{if(t===w.MP4)return{streamType:L.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0,sessionData:void 0};if(t===w.M3U8){let r=await fetch(e);if(!r.ok)return Promise.reject(r);let n=await r.text(),o=await ut(n);return{...dt(n),...pt(o)}}return console.error(`Media type ${t} is an unrecognized or unsupported type for src ${e}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0,sessionData:void 0}},yt=async(e,t,r=Y({src:e}))=>{var c,d,f,u;let{streamType:n,targetLiveWindow:o,liveEdgeStartOffset:s,sessionData:a}=await ft(e,r),i=a==null?void 0:a["com.apple.hls.chapters"];(i!=null&&i.URI||i!=null&&i.VALUE.toLocaleLowerCase().startsWith("http"))&&ne((c=i.URI)!=null?c:i.VALUE,t),((d=k.get(t))!=null?d:{}).liveEdgeStartOffset=s,((f=k.get(t))!=null?f:{}).targetLiveWindow=o,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((u=k.get(t))!=null?u:{}).streamType=n,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},ne=async(e,t)=>{var r,n;try{let o=await fetch(e);if(!o.ok)throw new Error(`Failed to fetch Mux metadata: ${o.status} ${o.statusText}`);let s=await o.json(),a={};if(!((r=s==null?void 0:s[0])!=null&&r.metadata))return;for(let c of s[0].metadata)c.key&&c.value&&(a[c.key]=c.value);((n=k.get(t))!=null?n:{}).metadata=a;let i=new CustomEvent("muxmetadata");t.dispatchEvent(i)}catch(o){console.error(o)}},Tt=e=>{var a;let t=e.type,r=se(t),n=ie(t),o,s=!!((a=e.partList)!=null&&a.length);return r===L.LIVE&&(o=s?e.partTarget*2:e.targetduration*3),{streamType:r,targetLiveWindow:n,liveEdgeStartOffset:o,lowLatency:s}},mt=(e,t,r)=>{var i,c,d,f,u,p,l,T;let{streamType:n,targetLiveWindow:o,liveEdgeStartOffset:s,lowLatency:a}=Tt(e);if(n===L.LIVE){a?(r.config.backBufferLength=(i=r.userConfig.backBufferLength)!=null?i:4,r.config.maxFragLookUpTolerance=(c=r.userConfig.maxFragLookUpTolerance)!=null?c:.001,r.config.abrBandWidthUpFactor=(d=r.userConfig.abrBandWidthUpFactor)!=null?d:r.config.abrBandWidthFactor):r.config.backBufferLength=(f=r.userConfig.backBufferLength)!=null?f:8;let M=Object.freeze({get length(){return t.seekable.length},start(E){return t.seekable.start(E)},end(E){var D;return E>this.length||E<0||Number.isFinite(t.duration)?t.seekable.end(E):(D=r.liveSyncPosition)!=null?D:t.seekable.end(E)}});((u=k.get(t))!=null?u:{}).seekable=M}((p=k.get(t))!=null?p:{}).liveEdgeStartOffset=s,((l=k.get(t))!=null?l:{}).targetLiveWindow=o,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((T=k.get(t))!=null?T:{}).streamType=n,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},et,tt,Et=(tt=(et=globalThis==null?void 0:globalThis.navigator)==null?void 0:et.userAgent)!=null?tt:"",rt,nt,ot,yr=(ot=(nt=(rt=globalThis==null?void 0:globalThis.navigator)==null?void 0:rt.userAgentData)==null?void 0:nt.platform)!=null?ot:"",Tr=Et.toLowerCase().includes("android")||["x11","android"].some(e=>yr.toLowerCase().includes(e)),mr=e=>/^((?!chrome|android).)*safari/i.test(Et)&&!!e.canPlayType("application/vnd.apple.mpegurl"),k=new WeakMap,A="mux.com",at,st,gt=(st=(at=R).isSupported)==null?void 0:st.call(at),Er=e=>Tr||!mr(e),gr=()=>{if(typeof window!="undefined")return J.default.utils.now()},Mt=J.default.utils.generateUUID,Mr=({playbackId:e,customDomain:t=A,maxResolution:r,minResolution:n,renditionOrder:o,programStartTime:s,programEndTime:a,assetStartTime:i,assetEndTime:c,playbackToken:d,tokens:{playback:f=d}={},extraSourceParams:u={}}={})=>{if(!e)return;let[p,l=""]=F(e),T=new URL(`https://stream.${t}/${p}.m3u8${l}`);return f||T.searchParams.has("token")?(T.searchParams.forEach((M,E)=>{E!="token"&&T.searchParams.delete(E)}),f&&T.searchParams.set("token",f)):(r&&T.searchParams.set("max_resolution",r),n&&(T.searchParams.set("min_resolution",n),r&&+r.slice(0,-1)<+n.slice(0,-1)&&console.error("minResolution must be <= maxResolution","minResolution",n,"maxResolution",r)),o&&T.searchParams.set("rendition_order",o),s&&T.searchParams.set("program_start_time",`${s}`),a&&T.searchParams.set("program_end_time",`${a}`),i&&T.searchParams.set("asset_start_time",`${i}`),c&&T.searchParams.set("asset_end_time",`${c}`),Object.entries(u).forEach(([M,E])=>{E!=null&&T.searchParams.set(M,E)})),T.toString()},oe=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},Re=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(/\.m3u8|\//);return t||void 0},br=e=>{var t,r,n;return(t=e==null?void 0:e.metadata)!=null&&t.video_id?e.metadata.video_id:ke(e)&&(n=(r=oe(e.playbackId))!=null?r:Re(e.src))!=null?n:e.src},bt=e=>{var t;return(t=k.get(e))==null?void 0:t.error},Rr=e=>{var t;return(t=k.get(e))==null?void 0:t.metadata},Me=e=>{var t,r;return(r=(t=k.get(e))==null?void 0:t.streamType)!=null?r:L.UNKNOWN},xr=e=>{var t,r;return(r=(t=k.get(e))==null?void 0:t.targetLiveWindow)!=null?r:Number.NaN},xe=e=>{var t,r;return(r=(t=k.get(e))==null?void 0:t.seekable)!=null?r:e.seekable},Cr=e=>{var n;let t=(n=k.get(e))==null?void 0:n.liveEdgeStartOffset;if(typeof t!="number")return Number.NaN;let r=xe(e);return r.length?r.end(r.length-1)-t:Number.NaN},vr=e=>{var t;return(t=k.get(e))==null?void 0:t.coreReference},Ce=.034,Dr=(e,t,r=Ce)=>Math.abs(e-t)<=r,Rt=(e,t,r=Ce)=>e>t||Dr(e,t,r),xt=(e,t=Ce)=>e.paused&&Rt(e.currentTime,e.duration,t),ve=(e,t)=>{var d,f,u;if(!t||!e.buffered.length)return;if(e.readyState>2)return!1;let r=t.currentLevel>=0?(f=(d=t.levels)==null?void 0:d[t.currentLevel])==null?void 0:f.details:(u=t.levels.find(p=>!!p.details))==null?void 0:u.details;if(!r||r.live)return;let{fragments:n}=r;if(!(n!=null&&n.length))return;if(e.currentTime<e.duration-(r.targetduration+.5))return!1;let o=n[n.length-1];if(e.currentTime<=o.start)return!1;let s=o.start+o.duration/2,a=e.buffered.start(e.buffered.length-1),i=e.buffered.end(e.buffered.length-1);return s>a&&s<i},Ct=(e,t)=>e.ended||e.loop?e.ended:t&&ve(e,t)?!0:xt(e),vt=(e,t,r)=>{Dt(t,r,e);let{metadata:n={}}=e,{view_session_id:o=Mt()}=n,s=br(e);n.view_session_id=o,n.video_id=s,e.metadata=n;let a=p=>{var l;(l=t.mux)==null||l.emit("hb",{view_drm_type:p})};e.drmTypeCb=a,e.fallbackToWebkitFairplay=async()=>{var E;let p=!t.paused,l=t.currentTime;e.useWebkitFairplay=!0;let T=e.muxDataKeepSession;e.muxDataKeepSession=!0;let M=(E=k.get(t))==null?void 0:E.coreReference;vt(e,t,M),e.muxDataKeepSession=T,e.useWebkitFairplay=!1,p&&await t.play().then(()=>{t.currentTime=l}).catch(()=>{}),t.currentTime=l},k.set(t,{retryCount:0});let i=Pt(e,t),c=We(e,t,i);e!=null&&e.muxDataKeepSession&&(t!=null&&t.mux)&&!t.mux.deleted?i&&t.mux.addHLSJS({hlsjs:i,Hls:i?R:void 0}):It(e,t,i),Nt(e,t,i),fe(t),Ee(t);let d=Ke(e,t,i),f={engine:i,setAutoplay:d,setPreload:c},u=k.get(t);return u&&(u.coreReference=f),f},Dt=(e,t,r)=>{let n=t==null?void 0:t.engine;e!=null&&e.mux&&!e.mux.deleted&&(r!=null&&r.muxDataKeepSession?n&&e.mux.removeHLSJS():(e.mux.destroy(),delete e.mux)),n&&(n.detachMedia(),n.destroy()),e&&(e.hasAttribute("src")&&(e.removeAttribute("src"),e.load()),e.removeEventListener("error",Ut),e.removeEventListener("error",be),e.removeEventListener("durationchange",Ot),k.delete(e),e.dispatchEvent(new Event("teardown")))};function kt(e,t){var d;let r=Y(e);if(!(r===w.M3U8))return!0;let o=!r||((d=t.canPlayType(r))!=null?d:!0),{preferPlayback:s}=e,a=s===q.MSE,i=s===q.NATIVE,c=gt&&(a||Er(t));return o&&(i||!c)}var Pt=(e,t)=>{let{debug:r,streamType:n,startTime:o=-1,metadata:s,preferCmcd:a,_hlsConfig:i={},maxAutoResolution:c}=e,f=Y(e)===w.M3U8,u=kt(e,t);if(f&&!u&&gt){let p={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelOnFPSDrop:!0},l=ht(n),T=Lt(e),M=[N.QUERY,N.HEADER].includes(a)?{useHeaders:a===N.HEADER,sessionId:s==null?void 0:s.view_session_id,contentId:s==null?void 0:s.video_id}:void 0,E=St(e,i),D=new R({debug:r,startPosition:o,cmcd:M,xhrSetup:(g,b)=>{var H,Pe;if(a&&a!==N.QUERY)return;let y=new URL(b);if(!y.searchParams.has("CMCD"))return;let h=((Pe=(H=y.searchParams.get("CMCD"))==null?void 0:H.split(","))!=null?Pe:[]).filter(he=>he.startsWith("sid")||he.startsWith("cid")).join(",");y.searchParams.set("CMCD",h),g.open("GET",y)},...p,...E,...l,...T,...i});return E.capLevelController===B&&c!==void 0&&B.setMaxAutoResolution(D,c),D.on(R.Events.MANIFEST_PARSED,async function(g,b){var h,H;let y=(h=b.sessionData)==null?void 0:h["com.apple.hls.chapters"];(y!=null&&y.URI||y!=null&&y.VALUE.toLocaleLowerCase().startsWith("http"))&&ne((H=y==null?void 0:y.URI)!=null?H:y==null?void 0:y.VALUE,t)}),D}},ht=e=>e===L.LIVE?{backBufferLength:8}:{},Lt=e=>{let{tokens:{drm:t}={},playbackId:r,drmTypeCb:n}=e,o=oe(r);return!t||!o?{}:{emeEnabled:!0,drmSystems:{"com.apple.fps":{licenseUrl:j(e,"fairplay"),serverCertificateUrl:De(e,"fairplay")},"com.widevine.alpha":{licenseUrl:j(e,"widevine")},"com.microsoft.playready":{licenseUrl:j(e,"playready")}},requestMediaKeySystemAccessFunc:(s,a)=>(s==="com.widevine.alpha"&&(a=[...a.map(i=>{var d;let c=(d=i.videoCapabilities)==null?void 0:d.map(f=>({...f,robustness:"HW_SECURE_ALL"}));return{...i,videoCapabilities:c}}),...a]),navigator.requestMediaKeySystemAccess(s,a).then(i=>{let c=ct(s);return n==null||n(c),i}))}},_t=async e=>{let t=await fetch(e);return t.status!==200?Promise.reject(t):await t.arrayBuffer()},wt=async(e,t)=>{let r=await fetch(t,{method:"POST",headers:{"Content-type":"application/octet-stream"},body:e});if(r.status!==200)return Promise.reject(r);let n=await r.arrayBuffer();return new Uint8Array(n)},At=(e,t)=>{let o={mediaEl:t,getAppCertificate:()=>_t(De(e,"fairplay")).catch(s=>{if(s instanceof Response){let a=$(s,v.DRM,e);return console.error("mediaError",a==null?void 0:a.message,a==null?void 0:a.context),a?Promise.reject(a):Promise.reject(new Error("Unexpected error in app cert request"))}return Promise.reject(s)}),getLicenseKey:s=>wt(s,j(e,"fairplay")).catch(a=>{if(a instanceof Response){let i=$(a,v.DRM,e);return console.error("mediaError",i==null?void 0:i.message,i==null?void 0:i.context),i?Promise.reject(i):Promise.reject(new Error("Unexpected error in license key request"))}return Promise.reject(a)}),saveAndDispatchError:I,drmTypeCb:()=>{var s;(s=e.drmTypeCb)==null||s.call(e,re.FAIRPLAY)}};if(e.useWebkitFairplay)Qe(o);else{let s={fallbackToWebkitFairplay:async()=>{var i;await a(),(i=e.fallbackToWebkitFairplay)==null||i.call(e)},...o},a=Ze(s)}},j=({playbackId:e,tokens:{drm:t}={},customDomain:r=A},n)=>{let o=oe(e);return`https://license.${r.toLocaleLowerCase().endsWith(A)?r:A}/license/${n}/${o}?token=${t}`},De=({playbackId:e,tokens:{drm:t}={},customDomain:r=A},n)=>{let o=oe(e);return`https://license.${r.toLocaleLowerCase().endsWith(A)?r:A}/appcert/${n}/${o}?token=${t}`},ke=({playbackId:e,src:t,customDomain:r})=>{if(e)return!0;if(typeof t!="string")return!1;let n=window==null?void 0:window.location.href,o=new URL(t,n).hostname.toLocaleLowerCase();return o.includes(A)||!!r&&o.includes(r.toLocaleLowerCase())},St=(e,t)=>{let r={};return r.capLevelToPlayerSize=e.capRenditionToPlayerSize,r.capLevelToPlayerSize==null?(r.capLevelController=B,r.capLevelToPlayerSize=!0):r.capLevelController=it.CapLevelController,r},It=(e,t,r)=>{var c;let{envKey:n,disableTracking:o,muxDataSDK:s=J.default,muxDataSDKOptions:a={}}=e,i=ke(e);if(!o&&(n||i)){let{playerInitTime:d,playerSoftwareName:f,playerSoftwareVersion:u,beaconCollectionDomain:p,debug:l,disableCookies:T}=e,M={...e.metadata,video_title:((c=e==null?void 0:e.metadata)==null?void 0:c.video_title)||void 0},E=D=>typeof D.player_error_code=="string"?!1:typeof e.errorTranslator=="function"?e.errorTranslator(D):D;s.monitor(t,{debug:l,beaconCollectionDomain:p,hlsjs:r,Hls:r?R:void 0,automaticErrorTracking:!1,errorTranslator:E,disableCookies:T,...a,data:{...n?{env_key:n}:{},player_software_name:f,player_software:f,player_software_version:u,player_init_time:d,...M}})}},Nt=(e,t,r)=>{var f,u;let n=kt(e,t),{src:o,customDomain:s=A}=e,a=()=>{t.ended||e.disablePseudoEnded||!Ct(t,r)||(ve(t,r)?t.currentTime=t.buffered.end(t.buffered.length-1):t.dispatchEvent(new Event("ended")))},i,c,d=()=>{let p=xe(t),l,T;p.length>0&&(l=p.start(0),T=p.end(0)),(c!==T||i!==l)&&t.dispatchEvent(new CustomEvent("seekablechange",{composed:!0})),i=l,c=T};if(P(t,"durationchange",d),t&&n){let p=Y(e);if(typeof o=="string"){if(o.endsWith(".mp4")&&o.includes(s)){let M=Re(o),E=new URL(`https://stream.${s}/${M}/metadata.json`);ne(E.toString(),t)}let l=()=>{if(Me(t)!==L.LIVE||Number.isFinite(t.duration))return;let M=setInterval(d,1e3);t.addEventListener("teardown",()=>{clearInterval(M)},{once:!0}),P(t,"durationchange",()=>{Number.isFinite(t.duration)&&clearInterval(M)})},T=async()=>yt(o,t,p).then(l).catch(M=>{if(M instanceof Response){let E=$(M,v.VIDEO,e);if(E){I(t,E);return}}else M instanceof Error});if(t.preload==="none"){let M=()=>{T(),t.removeEventListener("loadedmetadata",E)},E=()=>{T(),t.removeEventListener("play",M)};P(t,"play",M,{once:!0}),P(t,"loadedmetadata",E,{once:!0})}else T();(f=e.tokens)!=null&&f.drm?At(e,t):P(t,"encrypted",()=>{let M=x("Attempting to play DRM-protected content without providing a DRM token."),E=new m(M,m.MEDIA_ERR_ENCRYPTED,!0);E.errorCategory=v.DRM,E.muxCode=C.ENCRYPTED_MISSING_TOKEN,I(t,E)},{once:!0}),t.setAttribute("src",o),e.startTime&&(((u=k.get(t))!=null?u:{}).startTime=e.startTime,t.addEventListener("durationchange",Ot,{once:!0}))}else t.removeAttribute("src");t.addEventListener("error",Ut),t.addEventListener("error",be),t.addEventListener("emptied",()=>{t.querySelectorAll("track[data-removeondestroy]").forEach(T=>{T.remove()})},{once:!0}),P(t,"pause",a),P(t,"seeked",a),P(t,"play",()=>{t.ended||Rt(t.currentTime,t.duration)&&(t.currentTime=t.seekable.length?t.seekable.start(0):0)})}else r&&o?(r.once(R.Events.LEVEL_LOADED,(p,l)=>{mt(l.details,t,r),d(),Me(t)===L.LIVE&&!Number.isFinite(t.duration)&&(r.on(R.Events.LEVEL_UPDATED,d),P(t,"durationchange",()=>{Number.isFinite(t.duration)&&r.off(R.Events.LEVELS_UPDATED,d)}))}),r.on(R.Events.ERROR,(p,l)=>{var M,E;let T=kr(l,e);if(T.muxCode===C.NETWORK_NOT_READY){let g=(M=k.get(t))!=null?M:{},b=(E=g.retryCount)!=null?E:0;if(b<6){let y=b===0?5e3:6e4,h=new m(`Retrying in ${y/1e3} seconds...`,T.code,T.fatal);Object.assign(h,T),I(t,h),setTimeout(()=>{g.retryCount=b+1,l.details==="manifestLoadError"&&l.url&&r.loadSource(l.url)},y);return}else{g.retryCount=0;let y=new m('Try again later or <a href="#" onclick="window.location.reload(); return false;" style="color: #4a90e2;">click here to retry</a>',T.code,T.fatal);Object.assign(y,T),I(t,y);return}}I(t,T)}),r.on(R.Events.MANIFEST_LOADED,()=>{let p=k.get(t);p&&p.error&&(p.error=null,p.retryCount=0,t.dispatchEvent(new Event("emptied")),t.dispatchEvent(new Event("loadstart")))}),t.addEventListener("error",be),P(t,"waiting",a),Ve(e,r),Fe(t,r),r.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function Ot(e){var n;let t=e.target,r=(n=k.get(t))==null?void 0:n.startTime;if(r&&Ae(t.seekable,t.duration,r)){let o=t.preload==="auto";o&&(t.preload="none"),t.currentTime=r,o&&(t.preload="auto")}}async function Ut(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(t!=null&&t.error))return;let{message:r,code:n}=t.error,o=new m(r,n);if(t.src&&n===m.MEDIA_ERR_SRC_NOT_SUPPORTED&&t.readyState===HTMLMediaElement.HAVE_NOTHING){setTimeout(()=>{var a;let s=(a=bt(t))!=null?a:t.error;(s==null?void 0:s.code)===m.MEDIA_ERR_SRC_NOT_SUPPORTED&&I(t,o)},500);return}if(t.src&&(n!==m.MEDIA_ERR_DECODE||n!==void 0))try{let{status:s}=await fetch(t.src);o.data={response:{code:s}}}catch{}I(t,o)}function I(e,t){var r;t.fatal&&(((r=k.get(e))!=null?r:{}).error=t,e.dispatchEvent(new CustomEvent("error",{detail:t})))}function be(e){var n,o;if(!(e instanceof CustomEvent)||!(e.detail instanceof m))return;let t=e.target,r=e.detail;!r||!r.fatal||(((n=k.get(t))!=null?n:{}).error=r,(o=t.mux)==null||o.emit("error",{player_error_code:r.code,player_error_message:r.message,player_error_context:r.context}))}var kr=(e,t)=>{var c,d,f;!e.fatal?t.debug&&console.warn("getErrorFromHlsErrorData() (non-fatal)",e):console.error("getErrorFromHlsErrorData()",e);let n={[R.ErrorTypes.NETWORK_ERROR]:m.MEDIA_ERR_NETWORK,[R.ErrorTypes.MEDIA_ERROR]:m.MEDIA_ERR_DECODE,[R.ErrorTypes.KEY_SYSTEM_ERROR]:m.MEDIA_ERR_ENCRYPTED},o=u=>[R.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,R.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED].includes(u.details)?m.MEDIA_ERR_NETWORK:n[u.type],s=u=>{if(u.type===R.ErrorTypes.KEY_SYSTEM_ERROR)return v.DRM;if(u.type===R.ErrorTypes.NETWORK_ERROR)return v.VIDEO},a,i=o(e);if(i===m.MEDIA_ERR_NETWORK&&e.response){let u=(c=s(e))!=null?c:v.VIDEO;a=(d=$(e.response,u,t,e.fatal))!=null?d:new m("",i,e.fatal)}else if(i===m.MEDIA_ERR_ENCRYPTED)if(e.details===R.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE){let u=x("Attempting to play DRM-protected content without providing a DRM token.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_MISSING_TOKEN}else if(e.details===R.ErrorDetails.KEY_SYSTEM_NO_ACCESS){let u=x("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM}else if(e.details===R.ErrorDetails.KEY_SYSTEM_NO_SESSION){let u=x("Failed to generate a DRM license request. This may be an issue with the player or your protected content.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,!0),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_GENERATE_REQUEST_FAILED}else if(e.details===R.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED){let u=x("Failed to update DRM license. This may be an issue with the player or your protected content.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_UPDATE_LICENSE_FAILED}else if(e.details===R.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED){let u=x("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_UPDATE_SERVER_CERT_FAILED}else if(e.details===R.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR){let u=x("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_CDM_ERROR}else if(e.details===R.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED){let u=x("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");a=new m(u,m.MEDIA_ERR_ENCRYPTED,!1),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_OUTPUT_RESTRICTED}else a=new m(e.error.message,m.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=v.DRM,a.muxCode=C.ENCRYPTED_ERROR;else a=new m("",i,e.fatal);return a.context||(a.context=`${e.url?`url: ${e.url}
`:""}${e.response&&(e.response.code||e.response.text)?`response: ${e.response.code}, ${e.response.text}
`:""}${e.reason?`failure reason: ${e.reason}
`:""}${e.level?`level: ${e.level}
`:""}${e.parent?`parent stream controller: ${e.parent}
`:""}${e.buffer?`buffer length: ${e.buffer}
`:""}${e.error?`error: ${e.error}
`:""}${e.event?`event: ${e.event}
`:""}${e.err?`error message: ${(f=e.err)==null?void 0:f.message}
`:""}`),a.data=e,a};
//# sourceMappingURL=index.cjs.js.map
