const intRegex=/^-?\d+$/,noiseValue=/^-?\d+n+$/,originalStringify=JSON.stringify,originalParse=JSON.parse,customFormat=/^-?\d+n$/,bigIntsStringify=/([\[:])?"(-?\d+)n"($|([\\n]|\s)*(\s|[\\n])*[,\}\]])/g,noiseStringify=/([\[:])?("-?\d+n+)n("$|"([\\n]|\s)*(\s|[\\n])*[,\}\]])/g,JSONStringify=(r,n,e)=>{if("rawJSON"in JSON)return originalStringify(r,((r,e)=>"bigint"==typeof e?JSON.rawJSON(e.toString()):"function"==typeof n?n(r,e):(Array.isArray(n)&&n.includes(r),e)),e);if(!r)return originalStringify(r,n,e);const t=originalStringify(r,((r,e)=>"string"==typeof e&&Boolean(e.match(noiseValue))||"bigint"==typeof e?e.toString()+"n":"function"==typeof n?n(r,e):(Array.isArray(n)&&n.includes(r),e)),e);return t.replace(bigIntsStringify,"$1$2$3").replace(noiseStringify,"$1$2$3")},isContextSourceSupported=()=>JSON.parse("1",((r,n,e)=>!!e&&"1"===e.source)),convertMarkedBigIntsReviver=(r,n,e,t)=>{if("string"==typeof n&&n.match(customFormat))return BigInt(n.slice(0,-1));return"string"==typeof n&&n.match(noiseValue)?n.slice(0,-1):"function"!=typeof t?n:t(r,n,e)},JSONParseV2=(r,n)=>JSON.parse(r,((r,e,t)=>{const i="number"==typeof e&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER),s=t&&intRegex.test(t.source);return i&&s?BigInt(t.source):"function"!=typeof n?e:n(r,e,t)})),MAX_INT=Number.MAX_SAFE_INTEGER.toString(),MAX_DIGITS=MAX_INT.length,stringsOrLargeNumbers=/"(?:\\.|[^"])*"|-?(0|[1-9][0-9]*)(\.[0-9]+)?([eE][+-]?[0-9]+)?/g,noiseValueWithQuotes=/^"-?\d+n+"$/,JSONParse=(r,n)=>{if(!r)return originalParse(r,n);if(JSON.parse("1",((r,n,e)=>!!e&&"1"===e.source)))return JSONParseV2(r,n);const e=r.replace(stringsOrLargeNumbers,((r,n,e,t)=>{const i='"'===r[0];if(i&&Boolean(r.match(noiseValueWithQuotes)))return r.substring(0,r.length-1)+'n"';const s=e||t,o=n&&(n.length<MAX_DIGITS||n.length===MAX_DIGITS&&n<=MAX_INT);return i||s||o?r:'"'+r+'n"'}));return originalParse(e,((r,e,t)=>convertMarkedBigIntsReviver(r,e,t,n)))};export{JSONStringify,JSONParse};