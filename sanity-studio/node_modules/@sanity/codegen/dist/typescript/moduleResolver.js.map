{"version":3,"sources":["../../src/typescript/moduleResolver.ts"],"sourcesContent":["import {createRequire} from 'node:module'\n\nimport createDebug from 'debug'\nimport {createMatchPath, loadConfig as loadTSConfig} from 'tsconfig-paths'\n\nconst require = createRequire(import.meta.url)\nconst debug = createDebug('sanity:codegen:moduleResolver')\n\n/**\n * This is a custom implementation of require.resolve that takes into account the paths\n * configuration in tsconfig.json. This is necessary if we want to resolve paths that are\n * custom defined in the tsconfig.json file.\n * Resolving here is best effort and might not work in all cases.\n * @beta\n */\nexport function getResolver(cwd?: string): NodeJS.RequireResolve {\n  const tsConfig = loadTSConfig(cwd)\n\n  if (tsConfig.resultType === 'failed') {\n    debug('Could not load tsconfig, using default resolver: %s', tsConfig.message)\n    return require.resolve\n  }\n\n  const matchPath = createMatchPath(\n    tsConfig.absoluteBaseUrl,\n    tsConfig.paths,\n    tsConfig.mainFields,\n    tsConfig.addMatchAll,\n  )\n\n  const resolve = function (request: string, options?: {paths?: string[]}): string {\n    const found = matchPath(request)\n    if (found !== undefined) {\n      return require.resolve(found, options)\n    }\n    return require.resolve(request, options)\n  }\n\n  // wrap the resolve.path function to make it available.\n  resolve.paths = (request: string): string[] | null => {\n    return require.resolve.paths(request)\n  }\n  return resolve\n}\n"],"names":["createRequire","createDebug","createMatchPath","loadConfig","loadTSConfig","require","url","debug","getResolver","cwd","tsConfig","resultType","message","resolve","matchPath","absoluteBaseUrl","paths","mainFields","addMatchAll","request","options","found","undefined"],"mappings":"AAAA,SAAQA,aAAa,QAAO,cAAa;AAEzC,OAAOC,iBAAiB,QAAO;AAC/B,SAAQC,eAAe,EAAEC,cAAcC,YAAY,QAAO,iBAAgB;AAE1E,MAAMC,UAAUL,cAAc,YAAYM,GAAG;AAC7C,MAAMC,QAAQN,YAAY;AAE1B;;;;;;CAMC,GACD,OAAO,SAASO,YAAYC,GAAY;IACtC,MAAMC,WAAWN,aAAaK;IAE9B,IAAIC,SAASC,UAAU,KAAK,UAAU;QACpCJ,MAAM,uDAAuDG,SAASE,OAAO;QAC7E,OAAOP,QAAQQ,OAAO;IACxB;IAEA,MAAMC,YAAYZ,gBAChBQ,SAASK,eAAe,EACxBL,SAASM,KAAK,EACdN,SAASO,UAAU,EACnBP,SAASQ,WAAW;IAGtB,MAAML,UAAU,SAAUM,OAAe,EAAEC,OAA4B;QACrE,MAAMC,QAAQP,UAAUK;QACxB,IAAIE,UAAUC,WAAW;YACvB,OAAOjB,QAAQQ,OAAO,CAACQ,OAAOD;QAChC;QACA,OAAOf,QAAQQ,OAAO,CAACM,SAASC;IAClC;IAEA,uDAAuD;IACvDP,QAAQG,KAAK,GAAG,CAACG;QACf,OAAOd,QAAQQ,OAAO,CAACG,KAAK,CAACG;IAC/B;IACA,OAAON;AACT"}