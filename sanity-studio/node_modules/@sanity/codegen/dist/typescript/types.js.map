{"version":3,"sources":["../../src/typescript/types.ts"],"sourcesContent":["import type * as t from '@babel/types'\n\nconst isRecord = (value: unknown): value is Record<string, unknown> =>\n  (typeof value === 'object' || typeof value === 'function') && !!value\n\n/**\n * Statistics from the query type evaluation process.\n * @public\n */\nexport interface TypeEvaluationStats {\n  allTypes: number\n  emptyUnions: number\n  unknownTypes: number\n}\n\ninterface QueryVariable {\n  id: t.Identifier\n\n  end?: number\n  start?: number\n}\n\n/**\n * A GROQ query extracted from a source file.\n * @public\n */\nexport interface ExtractedQuery {\n  filename: string\n  query: string\n  variable: QueryVariable\n}\n\n/**\n * A module (file) containing extracted GROQ queries.\n * @public\n */\nexport interface ExtractedModule {\n  errors: QueryExtractionError[]\n  filename: string\n  queries: ExtractedQuery[]\n}\n\n/**\n * An `ExtractedQuery` that has been evaluated against a schema, yielding a TypeScript type.\n * @public\n */\nexport interface EvaluatedQuery extends ExtractedQuery {\n  ast: t.ExportNamedDeclaration\n  code: string\n  id: t.Identifier\n  stats: TypeEvaluationStats\n  tsType: t.TSType\n}\n\n/**\n * A module containing queries that have been evaluated.\n * @public\n */\nexport interface EvaluatedModule {\n  errors: (QueryEvaluationError | QueryExtractionError)[]\n  filename: string\n  queries: EvaluatedQuery[]\n}\n\ninterface QueryExtractionErrorOptions {\n  cause: unknown\n  filename: string\n\n  variable?: QueryVariable\n}\n\n/**\n * An error that occurred during query extraction.\n * @public\n */\nexport class QueryExtractionError extends Error {\n  filename: string\n  variable?: QueryVariable\n  constructor({cause, filename, variable}: QueryExtractionErrorOptions) {\n    super(\n      `Error while extracting query ${variable ? `from variable '${variable.id.name}' ` : ''}in ${filename}: ${\n        isRecord(cause) && typeof cause.message === 'string' ? cause.message : 'Unknown error'\n      }`,\n    )\n    this.name = 'QueryExtractionError'\n    this.cause = cause\n    this.variable = variable\n    this.filename = filename\n  }\n}\n\ninterface QueryEvaluationErrorOptions {\n  cause: unknown\n  filename: string\n\n  variable?: QueryVariable\n}\n\n/**\n * An error that occurred during query evaluation.\n * @public\n */\nexport class QueryEvaluationError extends Error {\n  filename: string\n  variable?: QueryVariable\n  constructor({cause, filename, variable}: QueryEvaluationErrorOptions) {\n    super(\n      `Error while evaluating query ${variable ? `from variable '${variable.id.name}' ` : ''}in ${filename}: ${\n        isRecord(cause) && typeof cause.message === 'string' ? cause.message : 'Unknown error'\n      }`,\n    )\n    this.name = 'QueryEvaluationError'\n    this.cause = cause\n    this.variable = variable\n    this.filename = filename\n  }\n}\n"],"names":["isRecord","value","QueryExtractionError","Error","filename","variable","cause","id","name","message","QueryEvaluationError"],"mappings":"AAEA,MAAMA,WAAW,CAACC,QAChB,AAAC,CAAA,OAAOA,UAAU,YAAY,OAAOA,UAAU,UAAS,KAAM,CAAC,CAACA;AAoElE;;;CAGC,GACD,OAAO,MAAMC,6BAA6BC;IACxCC,SAAgB;IAChBC,SAAwB;IACxB,YAAY,EAACC,KAAK,EAAEF,QAAQ,EAAEC,QAAQ,EAA8B,CAAE;QACpE,KAAK,CACH,CAAC,6BAA6B,EAAEA,WAAW,CAAC,eAAe,EAAEA,SAASE,EAAE,CAACC,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,GAAG,EAAEJ,SAAS,EAAE,EACrGJ,SAASM,UAAU,OAAOA,MAAMG,OAAO,KAAK,WAAWH,MAAMG,OAAO,GAAG,iBACvE;QAEJ,IAAI,CAACD,IAAI,GAAG;QACZ,IAAI,CAACF,KAAK,GAAGA;QACb,IAAI,CAACD,QAAQ,GAAGA;QAChB,IAAI,CAACD,QAAQ,GAAGA;IAClB;AACF;AASA;;;CAGC,GACD,OAAO,MAAMM,6BAA6BP;IACxCC,SAAgB;IAChBC,SAAwB;IACxB,YAAY,EAACC,KAAK,EAAEF,QAAQ,EAAEC,QAAQ,EAA8B,CAAE;QACpE,KAAK,CACH,CAAC,6BAA6B,EAAEA,WAAW,CAAC,eAAe,EAAEA,SAASE,EAAE,CAACC,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,GAAG,EAAEJ,SAAS,EAAE,EACrGJ,SAASM,UAAU,OAAOA,MAAMG,OAAO,KAAK,WAAWH,MAAMG,OAAO,GAAG,iBACvE;QAEJ,IAAI,CAACD,IAAI,GAAG;QACZ,IAAI,CAACF,KAAK,GAAGA;QACb,IAAI,CAACD,QAAQ,GAAGA;QAChB,IAAI,CAACD,QAAQ,GAAGA;IAClB;AACF"}