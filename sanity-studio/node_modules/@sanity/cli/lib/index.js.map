{"version":3,"file":"index.js","sources":["../src/cliClient.ts","../src/config.ts"],"sourcesContent":["import {type ClientConfig, createClient, type SanityClient} from '@sanity/client'\n\nimport {getSanityCliConfig} from './util/getCliConfig'\nimport {resolveRootDir} from './util/resolveRootDir'\n\n/**\n * `getCliClient` accepts all options the `ClientConfig` does but provides\n * `projectId` and `dataset` from the `sanity.cli.ts` configuration file along\n * with a token in certain scenarios (e.g. `sanity exec SCRIPT --with-user-token`)\n */\nexport interface CliClientOptions extends ClientConfig {\n  /**\n   * If no `projectId` or `dataset` is provided, `getCliClient` will try to\n   * resolve these from the `sanity.cli.ts` configuration file. Use this option\n   * to specify the directory to look for this file.\n   */\n  cwd?: string\n}\n\ninterface GetCliClient {\n  (options?: CliClientOptions): SanityClient\n  /**\n   * @internal\n   * @deprecated This is only for INTERNAL use, and should not be relied upon outside of official Sanity modules\n   * @returns A token to use when constructing a client without a `token` explicitly defined, or undefined\n   */\n  __internal__getToken: () => string | undefined\n}\n\nfunction getCliClientImpl(options: CliClientOptions = {}): SanityClient {\n  if (typeof process !== 'object') {\n    throw new Error('getCliClient() should only be called from node.js scripts')\n  }\n\n  const {\n    cwd = process.env.SANITY_BASE_PATH || process.cwd(),\n    useCdn = false,\n    apiVersion = '2022-06-06',\n    projectId,\n    dataset,\n    token = getCliClient.__internal__getToken(),\n    ...restOfOptions\n  } = options\n\n  if (projectId && dataset) {\n    return createClient({projectId, dataset, apiVersion, useCdn, token, ...restOfOptions})\n  }\n\n  const rootDir = resolveRootDir(cwd)\n  const {config} = getSanityCliConfig(rootDir) || {}\n  if (!config) {\n    throw new Error('Unable to resolve CLI configuration')\n  }\n\n  const apiConfig = config?.api || {}\n  if (!apiConfig.projectId || !apiConfig.dataset) {\n    throw new Error('Unable to resolve project ID/dataset from CLI configuration')\n  }\n\n  return createClient({\n    projectId: apiConfig.projectId,\n    dataset: apiConfig.dataset,\n    apiVersion,\n    useCdn,\n    token,\n    ...restOfOptions,\n  })\n}\n\n/* eslint-disable camelcase */\ngetCliClientImpl.__internal__getToken = (): string | undefined => undefined\n/* eslint-enable camelcase */\n\n/** @internal */\nexport const getCliClient: GetCliClient = getCliClientImpl\n","import {type CliConfig} from './types'\n\n/** @beta */\nexport function defineCliConfig(config: CliConfig): CliConfig {\n  return config\n}\n\n/**\n * @deprecated Use `defineCliConfig` instead\n * @beta\n */\nexport function createCliConfig(config: CliConfig): CliConfig {\n  return config\n}\n"],"names":["createClient","resolveRootDir","getSanityCliConfig"],"mappings":";;;AA6BA,SAAS,iBAAiB,UAA4B,IAAkB;AACtE,MAAI,OAAO,WAAY;AACrB,UAAM,IAAI,MAAM,2DAA2D;AAG7E,QAAM;AAAA,IACJ,MAAM,QAAQ,IAAI,oBAAoB,QAAQ,IAAA;AAAA,IAC9C,SAAS;AAAA,IACT,aAAa;AAAA,IACb;AAAA,IACA;AAAA,IACA,QAAQ,aAAa,qBAAA;AAAA,IACrB,GAAG;AAAA,EAAA,IACD;AAEJ,MAAI,aAAa;AACf,WAAOA,OAAAA,aAAa,EAAC,WAAW,SAAS,YAAY,QAAQ,OAAO,GAAG,eAAc;AAGvF,QAAM,UAAUC,QAAAA,eAAe,GAAG,GAC5B,EAAC,WAAUC,aAAAA,mBAAmB,OAAO,KAAK,CAAA;AAChD,MAAI,CAAC;AACH,UAAM,IAAI,MAAM,qCAAqC;AAGvD,QAAM,YAAY,QAAQ,OAAO,CAAA;AACjC,MAAI,CAAC,UAAU,aAAa,CAAC,UAAU;AACrC,UAAM,IAAI,MAAM,6DAA6D;AAG/E,SAAOF,oBAAa;AAAA,IAClB,WAAW,UAAU;AAAA,IACrB,SAAS,UAAU;AAAA,IACnB;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EAAA,CACJ;AACH;AAGA,iBAAiB,uBAAuB,MAAuB;AAAA;AAIxD,MAAM,eAA6B;ACvEnC,SAAS,gBAAgB,QAA8B;AAC5D,SAAO;AACT;AAMO,SAAS,gBAAgB,QAA8B;AAC5D,SAAO;AACT;;;;;"}