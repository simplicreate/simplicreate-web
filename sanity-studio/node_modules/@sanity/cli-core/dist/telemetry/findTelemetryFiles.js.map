{"version":3,"sources":["../../src/telemetry/findTelemetryFiles.ts"],"sourcesContent":["import {join} from 'node:path'\n\nimport {glob} from 'tinyglobby'\n\nimport {normalizePath} from '../util/normalizePath.js'\nimport {getTelemetryBaseInfo} from './getTelemetryBaseInfo.js'\nimport {telemetryStoreDebug} from './telemetryStoreDebug.js'\n\n/**\n * Discovers and returns paths to all telemetry files for the current user/environment.\n *\n * This function is used during:\n * - Flush operations: to collect and send events from all CLI sessions\n * - Cleanup operations: to find old files that should be removed\n *\n * Uses glob patterns to match files across all sessions (not just the current one).\n *\n * @returns Promise resolving to array of file paths, empty if no files exist\n * @internal\n */\nexport async function findTelemetryFiles(): Promise<string[]> {\n  try {\n    const {basePattern, directory} = await getTelemetryBaseInfo()\n    const pattern = `${basePattern}-*.ndjson`\n    const fullPattern = join(directory, pattern)\n    telemetryStoreDebug('Looking for files matching pattern: %s', fullPattern)\n\n    // Converts windows backslashes to forward slashes for glob pattern\n    const matchingFiles = await glob(normalizePath(fullPattern))\n    telemetryStoreDebug('Found %d matching telemetry files', matchingFiles.length)\n    return matchingFiles\n  } catch (error) {\n    if ((error as {code?: string}).code === 'ENOENT') {\n      telemetryStoreDebug('Telemetry directory does not exist yet')\n      return []\n    }\n    throw error\n  }\n}\n"],"names":["join","glob","normalizePath","getTelemetryBaseInfo","telemetryStoreDebug","findTelemetryFiles","basePattern","directory","pattern","fullPattern","matchingFiles","length","error","code"],"mappings":"AAAA,SAAQA,IAAI,QAAO,YAAW;AAE9B,SAAQC,IAAI,QAAO,aAAY;AAE/B,SAAQC,aAAa,QAAO,2BAA0B;AACtD,SAAQC,oBAAoB,QAAO,4BAA2B;AAC9D,SAAQC,mBAAmB,QAAO,2BAA0B;AAE5D;;;;;;;;;;;CAWC,GACD,OAAO,eAAeC;IACpB,IAAI;QACF,MAAM,EAACC,WAAW,EAAEC,SAAS,EAAC,GAAG,MAAMJ;QACvC,MAAMK,UAAU,GAAGF,YAAY,SAAS,CAAC;QACzC,MAAMG,cAAcT,KAAKO,WAAWC;QACpCJ,oBAAoB,0CAA0CK;QAE9D,mEAAmE;QACnE,MAAMC,gBAAgB,MAAMT,KAAKC,cAAcO;QAC/CL,oBAAoB,qCAAqCM,cAAcC,MAAM;QAC7E,OAAOD;IACT,EAAE,OAAOE,OAAO;QACd,IAAI,AAACA,MAA0BC,IAAI,KAAK,UAAU;YAChDT,oBAAoB;YACpB,OAAO,EAAE;QACX;QACA,MAAMQ;IACR;AACF"}