{"version":3,"sources":["../../src/telemetry/getTelemetryBaseInfo.ts"],"sourcesContent":["import {createHash} from 'node:crypto'\nimport {tmpdir} from 'node:os'\nimport {join} from 'node:path'\n\nimport {getCliToken} from '../services/getCliToken.js'\nimport {isStaging} from '../util/isStaging.js'\n\n/**\n * Base information needed for telemetry file operations.\n * Contains common data used by both file path generation and pattern matching.\n */\ninterface TelemetryBaseInfo {\n  /** Base filename pattern without sessionId suffix */\n  basePattern: string\n  /** Base directory where telemetry files are stored */\n  directory: string\n  /** Environment: 'staging' or 'production' */\n  environment: string\n  /** Hashed token (first 8 chars of SHA256) for privacy */\n  hashedToken: string\n}\n\n/**\n * Gets the base telemetry information needed for file operations.\n *\n * This shared utility extracts common logic used by:\n * - `generateTelemetryFilePath` - for generating session-specific file paths\n * - `findTelemetryFiles` - for discovering all telemetry files via glob patterns\n *\n * @returns Promise resolving to base telemetry information\n * @throws Error if no auth token is found\n * @internal\n */\nexport async function getTelemetryBaseInfo(): Promise<TelemetryBaseInfo> {\n  const token = await getCliToken()\n  if (!token) {\n    throw new Error('No auth token found - user must be logged in for telemetry')\n  }\n\n  const hashedToken = createHash('sha256').update(token).digest('hex').slice(0, 8)\n  const environment = isStaging() ? 'staging' : 'production'\n  const directory = join(tmpdir(), '.config', 'sanity')\n  const basePattern = `telemetry-${hashedToken}-${environment}`\n\n  return {\n    basePattern,\n    directory,\n    environment,\n    hashedToken,\n  }\n}\n"],"names":["createHash","tmpdir","join","getCliToken","isStaging","getTelemetryBaseInfo","token","Error","hashedToken","update","digest","slice","environment","directory","basePattern"],"mappings":"AAAA,SAAQA,UAAU,QAAO,cAAa;AACtC,SAAQC,MAAM,QAAO,UAAS;AAC9B,SAAQC,IAAI,QAAO,YAAW;AAE9B,SAAQC,WAAW,QAAO,6BAA4B;AACtD,SAAQC,SAAS,QAAO,uBAAsB;AAiB9C;;;;;;;;;;CAUC,GACD,OAAO,eAAeC;IACpB,MAAMC,QAAQ,MAAMH;IACpB,IAAI,CAACG,OAAO;QACV,MAAM,IAAIC,MAAM;IAClB;IAEA,MAAMC,cAAcR,WAAW,UAAUS,MAAM,CAACH,OAAOI,MAAM,CAAC,OAAOC,KAAK,CAAC,GAAG;IAC9E,MAAMC,cAAcR,cAAc,YAAY;IAC9C,MAAMS,YAAYX,KAAKD,UAAU,WAAW;IAC5C,MAAMa,cAAc,CAAC,UAAU,EAAEN,YAAY,CAAC,EAAEI,aAAa;IAE7D,OAAO;QACLE;QACAD;QACAD;QACAJ;IACF;AACF"}