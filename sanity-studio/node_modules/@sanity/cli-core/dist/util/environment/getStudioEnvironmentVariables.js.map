{"version":3,"sources":["../../../src/util/environment/getStudioEnvironmentVariables.ts"],"sourcesContent":["import {resolve} from 'node:path'\nimport {pathToFileURL} from 'node:url'\n\nimport {moduleResolve} from 'import-meta-resolve'\n\nimport {doImport} from '../doImport.js'\n\n/**\n * Loads the `getStudioEnvironmentVariables` function from the studio's\n * installed `sanity` package and returns the environment variables.\n *\n * This is used to ensure we're using the same version of environment variable\n * logic as the studio itself.\n *\n * @param rootPath - The root path of the Sanity Studio project\n * @returns Object containing studio environment variables\n * @internal\n */\nexport async function getStudioEnvironmentVariables(\n  rootPath: string,\n): Promise<Record<string, string>> {\n  // Create a fake config URL - doesn't have to be correct, just need the root path\n  const fakeConfigUrl = pathToFileURL(resolve(rootPath, 'sanity.config.mjs'))\n\n  // Load `getStudioEnvironmentVariables` from the `sanity/cli` module installed\n  // relative to where the studio is located, instead of resolving from where this CLI is\n  // running, in order to ensure we're using the same version as the studio would.\n  const sanityCliUrl = moduleResolve('sanity/cli', fakeConfigUrl)\n  try {\n    const {getStudioEnvironmentVariables: getEnvVars} = await doImport(sanityCliUrl.href)\n    if (typeof getEnvVars !== 'function') {\n      throw new TypeError(\n        'Expected `getStudioEnvironmentVariables` from `sanity/cli` to be a function',\n      )\n    }\n    return getEnvVars(rootPath)\n  } catch (err) {\n    const message = err instanceof Error ? err.message : String(err)\n    throw new Error(\n      `Failed to import getStudioEnvironmentVariables from sanity/cli module: ${message}`,\n    )\n  }\n}\n"],"names":["resolve","pathToFileURL","moduleResolve","doImport","getStudioEnvironmentVariables","rootPath","fakeConfigUrl","sanityCliUrl","getEnvVars","href","TypeError","err","message","Error","String"],"mappings":"AAAA,SAAQA,OAAO,QAAO,YAAW;AACjC,SAAQC,aAAa,QAAO,WAAU;AAEtC,SAAQC,aAAa,QAAO,sBAAqB;AAEjD,SAAQC,QAAQ,QAAO,iBAAgB;AAEvC;;;;;;;;;;CAUC,GACD,OAAO,eAAeC,8BACpBC,QAAgB;IAEhB,iFAAiF;IACjF,MAAMC,gBAAgBL,cAAcD,QAAQK,UAAU;IAEtD,8EAA8E;IAC9E,uFAAuF;IACvF,gFAAgF;IAChF,MAAME,eAAeL,cAAc,cAAcI;IACjD,IAAI;QACF,MAAM,EAACF,+BAA+BI,UAAU,EAAC,GAAG,MAAML,SAASI,aAAaE,IAAI;QACpF,IAAI,OAAOD,eAAe,YAAY;YACpC,MAAM,IAAIE,UACR;QAEJ;QACA,OAAOF,WAAWH;IACpB,EAAE,OAAOM,KAAK;QACZ,MAAMC,UAAUD,eAAeE,QAAQF,IAAIC,OAAO,GAAGE,OAAOH;QAC5D,MAAM,IAAIE,MACR,CAAC,uEAAuE,EAAED,SAAS;IAEvF;AACF"}