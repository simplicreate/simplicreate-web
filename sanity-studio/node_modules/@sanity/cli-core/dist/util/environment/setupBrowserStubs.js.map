{"version":3,"sources":["../../../src/util/environment/setupBrowserStubs.ts"],"sourcesContent":["import * as stubs from './stubs.js'\n\n/**\n * Sets up browser globals (window, document, etc.) in the global scope.\n *\n * This is used by both mockBrowserEnvironment (for child processes) and\n * studioWorkerLoader (for worker threads) to provide a browser-like environment.\n *\n * @returns A cleanup function that removes the injected globals\n * @internal\n */\nexport async function setupBrowserStubs(): Promise<() => void> {\n  // Guard against double-registering\n  if (globalThis.window && '__mockedBySanity' in globalThis.window) {\n    return () => {\n      /* intentional noop - already mocked */\n    }\n  }\n\n  // Inject browser stubs into global scope\n  const mockStubs = stubs as unknown as Record<string, unknown>\n  const mockedGlobalThis: Record<string, unknown> = globalThis\n  const stubbedKeys: string[] = []\n\n  for (const key in stubs) {\n    if (!(key in mockedGlobalThis)) {\n      mockedGlobalThis[key] = mockStubs[key]\n      stubbedKeys.push(key)\n    }\n  }\n\n  // Add marker to window to detect double-mocking\n  if (globalThis.window) {\n    ;(globalThis.window as unknown as Record<string, unknown>).__mockedBySanity = true\n  }\n\n  // Return cleanup function\n  return () => {\n    for (const key of stubbedKeys) {\n      delete mockedGlobalThis[key]\n    }\n\n    // Remove marker\n    if (globalThis.window) {\n      delete (globalThis.window as unknown as Record<string, unknown>).__mockedBySanity\n    }\n  }\n}\n"],"names":["stubs","setupBrowserStubs","globalThis","window","mockStubs","mockedGlobalThis","stubbedKeys","key","push","__mockedBySanity"],"mappings":"AAAA,YAAYA,WAAW,aAAY;AAEnC;;;;;;;;CAQC,GACD,OAAO,eAAeC;IACpB,mCAAmC;IACnC,IAAIC,WAAWC,MAAM,IAAI,sBAAsBD,WAAWC,MAAM,EAAE;QAChE,OAAO;QACL,qCAAqC,GACvC;IACF;IAEA,yCAAyC;IACzC,MAAMC,YAAYJ;IAClB,MAAMK,mBAA4CH;IAClD,MAAMI,cAAwB,EAAE;IAEhC,IAAK,MAAMC,OAAOP,MAAO;QACvB,IAAI,CAAEO,CAAAA,OAAOF,gBAAe,GAAI;YAC9BA,gBAAgB,CAACE,IAAI,GAAGH,SAAS,CAACG,IAAI;YACtCD,YAAYE,IAAI,CAACD;QACnB;IACF;IAEA,gDAAgD;IAChD,IAAIL,WAAWC,MAAM,EAAE;;QACnBD,WAAWC,MAAM,CAAwCM,gBAAgB,GAAG;IAChF;IAEA,0BAA0B;IAC1B,OAAO;QACL,KAAK,MAAMF,OAAOD,YAAa;YAC7B,OAAOD,gBAAgB,CAACE,IAAI;QAC9B;QAEA,gBAAgB;QAChB,IAAIL,WAAWC,MAAM,EAAE;YACrB,OAAO,AAACD,WAAWC,MAAM,CAAwCM,gBAAgB;QACnF;IACF;AACF"}