{"version":3,"sources":["../../src/util/getCliTelemetry.ts"],"sourcesContent":["import {CLIError} from '@oclif/core/errors'\n\nimport {type CLITelemetryStore} from '../telemetry/types.js'\nimport {isTrueish} from './isTrueish.js'\n\n/**\n * @public\n * Symbol used to store the CLI telemetry store on globalThis.\n * Use `getCliTelemetry()` to access the store instead of accessing this directly.\n */\nexport const CLI_TELEMETRY_SYMBOL = Symbol.for('sanity.cli.telemetry')\n\ntype GlobalWithTelemetry = typeof globalThis & {\n  [CLI_TELEMETRY_SYMBOL]?: CLITelemetryStore\n}\n\n/**\n * @public\n */\nexport function getCliTelemetry(): CLITelemetryStore {\n  const global = globalThis as GlobalWithTelemetry\n  // This should never happen, but just in case.\n  // Ignore this error in tests to avoid failing tests as tests don't run to\n  if (!global[CLI_TELEMETRY_SYMBOL] && !isTrueish(process.env.TEST)) {\n    throw new CLIError('CLI telemetry not initialized', {exit: 1})\n  }\n\n  return global[CLI_TELEMETRY_SYMBOL] as CLITelemetryStore\n}\n\n/**\n * Sets the global CLI telemetry store.\n * @internal\n */\nexport function setCliTelemetry(telemetry: CLITelemetryStore): void {\n  const global = globalThis as GlobalWithTelemetry\n  global[CLI_TELEMETRY_SYMBOL] = telemetry\n}\n\n/**\n * Clears the global CLI telemetry store.\n * @internal\n */\nexport function clearCliTelemetry(): void {\n  const global = globalThis as GlobalWithTelemetry\n  delete global[CLI_TELEMETRY_SYMBOL]\n}\n"],"names":["CLIError","isTrueish","CLI_TELEMETRY_SYMBOL","Symbol","for","getCliTelemetry","global","globalThis","process","env","TEST","exit","setCliTelemetry","telemetry","clearCliTelemetry"],"mappings":"AAAA,SAAQA,QAAQ,QAAO,qBAAoB;AAG3C,SAAQC,SAAS,QAAO,iBAAgB;AAExC;;;;CAIC,GACD,OAAO,MAAMC,uBAAuBC,OAAOC,GAAG,CAAC,wBAAuB;AAMtE;;CAEC,GACD,OAAO,SAASC;IACd,MAAMC,SAASC;IACf,8CAA8C;IAC9C,0EAA0E;IAC1E,IAAI,CAACD,MAAM,CAACJ,qBAAqB,IAAI,CAACD,UAAUO,QAAQC,GAAG,CAACC,IAAI,GAAG;QACjE,MAAM,IAAIV,SAAS,iCAAiC;YAACW,MAAM;QAAC;IAC9D;IAEA,OAAOL,MAAM,CAACJ,qBAAqB;AACrC;AAEA;;;CAGC,GACD,OAAO,SAASU,gBAAgBC,SAA4B;IAC1D,MAAMP,SAASC;IACfD,MAAM,CAACJ,qBAAqB,GAAGW;AACjC;AAEA;;;CAGC,GACD,OAAO,SAASC;IACd,MAAMR,SAASC;IACf,OAAOD,MAAM,CAACJ,qBAAqB;AACrC"}