{"version":3,"sources":["../src/SanityCommand.ts"],"sourcesContent":["import {Command, Interfaces} from '@oclif/core'\n\nimport {getCliConfig} from './config/cli/getCliConfig.js'\nimport {type CliConfig} from './config/cli/types/cliConfig.js'\nimport {findProjectRoot} from './config/findProjectRoot.js'\nimport {type ProjectRootResult} from './config/util/recursivelyResolveProjectRoot.js'\nimport {subdebug} from './debug.js'\nimport {\n  getGlobalCliClient,\n  getProjectCliClient,\n  type GlobalCliClientOptions,\n  type ProjectCliClientOptions,\n} from './services/apiClient.js'\nimport {type CLITelemetryStore} from './telemetry/types.js'\nimport {type Output} from './types.js'\nimport {getCliTelemetry} from './util/getCliTelemetry.js'\nimport {isInteractive} from './util/isInteractive.js'\n\ntype Flags<T extends typeof Command> = Interfaces.InferredFlags<\n  (typeof SanityCommand)['baseFlags'] & T['flags']\n>\n\ntype Args<T extends typeof Command> = Interfaces.InferredArgs<T['args']>\n\nconst debug = subdebug('sanityCommand')\n\nexport abstract class SanityCommand<T extends typeof Command> extends Command {\n  protected args!: Args<T>\n  protected flags!: Flags<T>\n\n  /**\n   * Get the global API client.\n   *\n   * @param args - The global API client options.\n   * @returns The global API client.\n   *\n   * @deprecated use `getGlobalCliClient` function directly instead.\n   */\n  protected getGlobalApiClient = (args: GlobalCliClientOptions) => getGlobalCliClient(args)\n\n  /**\n   * Get the project API client.\n   *\n   * @param args - The project API client options.\n   * @returns The project API client.\n   *\n   * @deprecated use `getProjectCliClient` function directly instead.\n   */\n  protected getProjectApiClient = (args: ProjectCliClientOptions) => getProjectCliClient(args)\n\n  /**\n   * Helper for outputting to the console.\n   *\n   * @example\n   * ```ts\n   * this.output.log('Hello')\n   * this.output.warn('Warning')\n   * this.output.error('Error')\n   * ```\n   */\n  protected output: Output = {\n    error: this.error.bind(this),\n    log: this.log.bind(this),\n    warn: this.warn.bind(this),\n  }\n\n  /**\n   * The telemetry store.\n   *\n   * @returns The telemetry store.\n   */\n  protected telemetry!: CLITelemetryStore\n\n  /**\n   * Get the CLI config.\n   *\n   * @returns The CLI config.\n   */\n  protected async getCliConfig(): Promise<CliConfig> {\n    const root = await this.getProjectRoot()\n\n    debug(`Using project root`, root)\n    return getCliConfig(root.directory)\n  }\n\n  /**\n   * Get the project ID from the CLI config.\n   *\n   * @returns The project ID or `undefined` if it's not set.\n   */\n  protected async getProjectId(): Promise<string | undefined> {\n    const config = await this.getCliConfig()\n\n    return config.api?.projectId\n  }\n\n  /**\n   * Get the project's root directory by resolving the config\n   *\n   * @returns The project root result.\n   */\n  protected getProjectRoot(): Promise<ProjectRootResult> {\n    return findProjectRoot(process.cwd())\n  }\n\n  public async init(): Promise<void> {\n    const {args, flags} = await this.parse({\n      args: this.ctor.args,\n      baseFlags: (super.ctor as typeof SanityCommand).baseFlags,\n      enableJsonFlag: this.ctor.enableJsonFlag,\n      flags: this.ctor.flags,\n      strict: this.ctor.strict,\n    })\n\n    this.args = args as Args<T>\n    this.flags = flags as Flags<T>\n    this.telemetry = getCliTelemetry()\n\n    await super.init()\n  }\n\n  /**\n   * Check if the command is running in unattended mode.\n   *\n   * This means the command should not ask for user input, instead using defaults where\n   * possible, and if that does not make sense (eg there's missing information), then we\n   * should error out (remember to exit with a non-zero code).\n   *\n   * Most commands should take an explicit `--yes` flag to enable unattended mode, but\n   * some commands may also be run in unattended mode if `process.stdin` is not a TTY\n   * (eg when running in a CI environment).\n   */\n  protected isUnattended(): boolean {\n    return this.flags.yes || !this.resolveIsInteractive()\n  }\n\n  /**\n   * Resolver for checking if the terminal is interactive. Override in tests to provide mock values.\n   *\n   * @returns Whether the terminal is interactive.\n   */\n  protected resolveIsInteractive(): boolean {\n    return isInteractive()\n  }\n}\n"],"names":["Command","getCliConfig","findProjectRoot","subdebug","getGlobalCliClient","getProjectCliClient","getCliTelemetry","isInteractive","debug","SanityCommand","args","flags","getGlobalApiClient","getProjectApiClient","output","error","bind","log","warn","telemetry","root","getProjectRoot","directory","getProjectId","config","api","projectId","process","cwd","init","parse","ctor","baseFlags","enableJsonFlag","strict","isUnattended","yes","resolveIsInteractive"],"mappings":"AAAA,SAAQA,OAAO,QAAmB,cAAa;AAE/C,SAAQC,YAAY,QAAO,+BAA8B;AAEzD,SAAQC,eAAe,QAAO,8BAA6B;AAE3D,SAAQC,QAAQ,QAAO,aAAY;AACnC,SACEC,kBAAkB,EAClBC,mBAAmB,QAGd,0BAAyB;AAGhC,SAAQC,eAAe,QAAO,4BAA2B;AACzD,SAAQC,aAAa,QAAO,0BAAyB;AAQrD,MAAMC,QAAQL,SAAS;AAEvB,OAAO,MAAeM,sBAAgDT;IAC1DU,KAAc;IACdC,MAAgB;IAE1B;;;;;;;GAOC,GACD,AAAUC,qBAAqB,CAACF,OAAiCN,mBAAmBM,MAAK;IAEzF;;;;;;;GAOC,GACD,AAAUG,sBAAsB,CAACH,OAAkCL,oBAAoBK,MAAK;IAE5F;;;;;;;;;GASC,GACD,AAAUI,SAAiB;QACzBC,OAAO,IAAI,CAACA,KAAK,CAACC,IAAI,CAAC,IAAI;QAC3BC,KAAK,IAAI,CAACA,GAAG,CAACD,IAAI,CAAC,IAAI;QACvBE,MAAM,IAAI,CAACA,IAAI,CAACF,IAAI,CAAC,IAAI;IAC3B,EAAC;IAED;;;;GAIC,GACD,AAAUG,UAA6B;IAEvC;;;;GAIC,GACD,MAAgBlB,eAAmC;QACjD,MAAMmB,OAAO,MAAM,IAAI,CAACC,cAAc;QAEtCb,MAAM,CAAC,kBAAkB,CAAC,EAAEY;QAC5B,OAAOnB,aAAamB,KAAKE,SAAS;IACpC;IAEA;;;;GAIC,GACD,MAAgBC,eAA4C;QAC1D,MAAMC,SAAS,MAAM,IAAI,CAACvB,YAAY;QAEtC,OAAOuB,OAAOC,GAAG,EAAEC;IACrB;IAEA;;;;GAIC,GACD,AAAUL,iBAA6C;QACrD,OAAOnB,gBAAgByB,QAAQC,GAAG;IACpC;IAEA,MAAaC,OAAsB;QACjC,MAAM,EAACnB,IAAI,EAAEC,KAAK,EAAC,GAAG,MAAM,IAAI,CAACmB,KAAK,CAAC;YACrCpB,MAAM,IAAI,CAACqB,IAAI,CAACrB,IAAI;YACpBsB,WAAW,AAAC,KAAK,CAACD,KAA8BC,SAAS;YACzDC,gBAAgB,IAAI,CAACF,IAAI,CAACE,cAAc;YACxCtB,OAAO,IAAI,CAACoB,IAAI,CAACpB,KAAK;YACtBuB,QAAQ,IAAI,CAACH,IAAI,CAACG,MAAM;QAC1B;QAEA,IAAI,CAACxB,IAAI,GAAGA;QACZ,IAAI,CAACC,KAAK,GAAGA;QACb,IAAI,CAACQ,SAAS,GAAGb;QAEjB,MAAM,KAAK,CAACuB;IACd;IAEA;;;;;;;;;;GAUC,GACD,AAAUM,eAAwB;QAChC,OAAO,IAAI,CAACxB,KAAK,CAACyB,GAAG,IAAI,CAAC,IAAI,CAACC,oBAAoB;IACrD;IAEA;;;;GAIC,GACD,AAAUA,uBAAgC;QACxC,OAAO9B;IACT;AACF"}