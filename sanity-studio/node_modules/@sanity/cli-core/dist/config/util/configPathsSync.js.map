{"version":3,"sources":["../../../src/config/util/configPathsSync.ts"],"sourcesContent":["import {existsSync, readFileSync} from 'node:fs'\nimport {basename, join} from 'node:path'\n\n/**\n * @internal\n */\ninterface PathResult {\n  exists: boolean\n  path: string\n}\n\n/**\n * Checks for a `sanity.json` file with `\"root\": true` in the given directory synchronously.\n *\n * @param basePath - The base path to look for a `sanity.json` in\n * @returns true if a `sanity.json` with `\"root\": true` is found, false otherwise\n * @internal\n */\nfunction isSanityV2StudioRootSync(basePath: string): boolean {\n  try {\n    const content = readFileSync(join(basePath, 'sanity.json'), 'utf8')\n    const sanityJson = JSON.parse(content)\n    if (!sanityJson || typeof sanityJson !== 'object' || Array.isArray(sanityJson)) {\n      throw new Error('Invalid sanity.json, expected an object')\n    }\n    const isRoot = Boolean(sanityJson?.root)\n    return isRoot\n  } catch {\n    return false\n  }\n}\n\n/**\n * Finds the path for a given set of files synchronously.\n *\n * @param basePath - The base path to search for files.\n * @param files - The files to search for.\n * @returns Array of path results\n * @internal\n */\nfunction findPathForFilesSync(basePath: string, files: string[]): PathResult[] {\n  return files.map((file) => {\n    const path = join(basePath, file)\n    const exists = existsSync(path)\n    return {exists, path}\n  })\n}\n\n/**\n * Resolves to a string containing the found config path, or `undefined` if not found.\n * Throws if Sanity v2 studio root is found.\n *\n * @param basePath - The base path to start searching from\n * @returns A string containing the found config path, or `undefined` if not found\n * @internal\n */\nexport function findStudioConfigPathSync(basePath: string): string | undefined {\n  if (isSanityV2StudioRootSync(basePath)) {\n    throw new Error(\n      `Found 'sanity.json' at ${basePath} - Sanity Studio < v3 is no longer supported`,\n    )\n  }\n\n  const paths = findPathForFilesSync(basePath, [\n    'sanity.config.ts',\n    'sanity.config.tsx',\n    'sanity.config.js',\n    'sanity.config.jsx',\n  ])\n\n  const configPaths = paths.filter((path) => path.exists)\n  if (configPaths.length > 1) {\n    const baseNames = configPaths.map((config) => config.path).map((path) => basename(path))\n    throw new Error(`Multiple studio config files found (${baseNames.join(', ')})`)\n  }\n\n  if (configPaths.length === 1) {\n    return configPaths[0].path\n  }\n}\n\n/**\n * Resolves to a string containing the found config path, or `undefined` if not found.\n *\n * @param basePath - The base path to start searching from\n * @returns A string containing the found config path, or `undefined` if not found\n * @internal\n */\nexport function findAppConfigPathSync(basePath: string): string | undefined {\n  const paths = findPathForFilesSync(basePath, ['sanity.cli.ts', 'sanity.cli.js'])\n  const configPaths = paths.filter((path) => path.exists)\n  if (configPaths.length > 1) {\n    throw new Error(\n      `Multiple app config files found (${configPaths.map((path) => path.path).join(', ')})`,\n    )\n  }\n\n  if (configPaths.length === 1) {\n    return configPaths[0].path\n  }\n}\n"],"names":["existsSync","readFileSync","basename","join","isSanityV2StudioRootSync","basePath","content","sanityJson","JSON","parse","Array","isArray","Error","isRoot","Boolean","root","findPathForFilesSync","files","map","file","path","exists","findStudioConfigPathSync","paths","configPaths","filter","length","baseNames","config","findAppConfigPathSync"],"mappings":"AAAA,SAAQA,UAAU,EAAEC,YAAY,QAAO,UAAS;AAChD,SAAQC,QAAQ,EAAEC,IAAI,QAAO,YAAW;AAUxC;;;;;;CAMC,GACD,SAASC,yBAAyBC,QAAgB;IAChD,IAAI;QACF,MAAMC,UAAUL,aAAaE,KAAKE,UAAU,gBAAgB;QAC5D,MAAME,aAAaC,KAAKC,KAAK,CAACH;QAC9B,IAAI,CAACC,cAAc,OAAOA,eAAe,YAAYG,MAAMC,OAAO,CAACJ,aAAa;YAC9E,MAAM,IAAIK,MAAM;QAClB;QACA,MAAMC,SAASC,QAAQP,YAAYQ;QACnC,OAAOF;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEA;;;;;;;CAOC,GACD,SAASG,qBAAqBX,QAAgB,EAAEY,KAAe;IAC7D,OAAOA,MAAMC,GAAG,CAAC,CAACC;QAChB,MAAMC,OAAOjB,KAAKE,UAAUc;QAC5B,MAAME,SAASrB,WAAWoB;QAC1B,OAAO;YAACC;YAAQD;QAAI;IACtB;AACF;AAEA;;;;;;;CAOC,GACD,OAAO,SAASE,yBAAyBjB,QAAgB;IACvD,IAAID,yBAAyBC,WAAW;QACtC,MAAM,IAAIO,MACR,CAAC,uBAAuB,EAAEP,SAAS,4CAA4C,CAAC;IAEpF;IAEA,MAAMkB,QAAQP,qBAAqBX,UAAU;QAC3C;QACA;QACA;QACA;KACD;IAED,MAAMmB,cAAcD,MAAME,MAAM,CAAC,CAACL,OAASA,KAAKC,MAAM;IACtD,IAAIG,YAAYE,MAAM,GAAG,GAAG;QAC1B,MAAMC,YAAYH,YAAYN,GAAG,CAAC,CAACU,SAAWA,OAAOR,IAAI,EAAEF,GAAG,CAAC,CAACE,OAASlB,SAASkB;QAClF,MAAM,IAAIR,MAAM,CAAC,oCAAoC,EAAEe,UAAUxB,IAAI,CAAC,MAAM,CAAC,CAAC;IAChF;IAEA,IAAIqB,YAAYE,MAAM,KAAK,GAAG;QAC5B,OAAOF,WAAW,CAAC,EAAE,CAACJ,IAAI;IAC5B;AACF;AAEA;;;;;;CAMC,GACD,OAAO,SAASS,sBAAsBxB,QAAgB;IACpD,MAAMkB,QAAQP,qBAAqBX,UAAU;QAAC;QAAiB;KAAgB;IAC/E,MAAMmB,cAAcD,MAAME,MAAM,CAAC,CAACL,OAASA,KAAKC,MAAM;IACtD,IAAIG,YAAYE,MAAM,GAAG,GAAG;QAC1B,MAAM,IAAId,MACR,CAAC,iCAAiC,EAAEY,YAAYN,GAAG,CAAC,CAACE,OAASA,KAAKA,IAAI,EAAEjB,IAAI,CAAC,MAAM,CAAC,CAAC;IAE1F;IAEA,IAAIqB,YAAYE,MAAM,KAAK,GAAG;QAC5B,OAAOF,WAAW,CAAC,EAAE,CAACJ,IAAI;IAC5B;AACF"}