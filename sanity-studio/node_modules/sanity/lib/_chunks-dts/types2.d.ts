import { ComponentType, RefObject } from "react";
import { SanityDocument } from "@sanity/types";
import { ClientPerspective, StackablePerspective } from "@sanity/client";
import { Observable } from "rxjs";
import { DocumentStore, DocumentValuePermission, PermissionCheckResult, SanityClient as SanityClient$1 } from "sanity";
import { PreviewUrlResolver } from "@sanity/preview-url-secret/define-preview-url";
import * as xstate102 from "xstate";
import { ActorRefFrom } from "xstate";
interface Context$2 {
  url: URL | null;
  error: Error | null;
  visualEditingOverlaysEnabled: boolean;
}
declare const presentationMachine: xstate102.StateMachine<Context$2, {
  type: "toggle visual editing overlays";
  enabled: boolean;
} | {
  type: "iframe loaded";
} | {
  type: "iframe refresh";
} | {
  type: "iframe reload";
}, {}, never, never, never, never, "error" | "loading" | {
  loaded: "idle" | "refreshing" | "reloading";
}, "busy" | "error", xstate102.NonReducibleUnknown, xstate102.NonReducibleUnknown, xstate102.EventObject, xstate102.MetaObject, {
  id: "Presentation Tool";
  states: {
    readonly error: {};
    readonly loading: {};
    readonly loaded: {
      states: {
        readonly idle: {};
        readonly refreshing: {};
        readonly reloading: {};
      };
    };
  };
}>;
type PresentationMachineRef = ActorRefFrom<typeof presentationMachine>;
/** @internal */
interface ResolvePreviewModeUrlInput {
  previewUrlSecret: string;
  resolvedPreviewMode: PreviewUrlPreviewMode;
  initialUrl: URL;
}
interface Context$1 {
  initialUrl: URL | null;
  previewUrl: URL | null;
  allowOrigins: URLPattern[] | null;
  error: Error | null;
  previewSearchParam: string | null;
  previewUrlSecret: {
    secret: string;
    expiresAt: Date;
  } | null;
  previewAccessSharingCreatePermission: PermissionCheckResult | null;
  previewAccessSharingReadPermission: PermissionCheckResult | null;
  previewAccessSharingUpdatePermission: PermissionCheckResult | null;
  previewUrlSecretPermission: PermissionCheckResult | null;
  previewMode: PreviewUrlPreviewMode | null;
}
type SetPreviewSearchParamEvent = {
  type: 'set preview search param';
  previewSearchParam: string | null;
};
type Input = Omit<SetPreviewSearchParamEvent, 'type'>;
interface CheckPermissionInput {
  checkPermissionName: DocumentValuePermission;
  document: Partial<SanityDocument> | null;
}
declare const previewUrlMachine: xstate102.StateMachine<Context$1, SetPreviewSearchParamEvent, {
  [x: string]: xstate102.ActorRefFromLogic<xstate102.ObservableActorLogic<PermissionCheckResult, CheckPermissionInput, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<URLPattern[], {
    initialUrl: URL;
  }, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<URL, ResolvePreviewModeUrlInput, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<URL, {
    initialUrl: URL;
    previewSearchParam: string | null | undefined;
    allowOrigins: URLPattern[];
  }, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<URL, {
    previewSearchParam: string | null;
  }, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<{
    secret: string;
    expiresAt: Date;
  }, xstate102.NonReducibleUnknown, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<string | null, xstate102.NonReducibleUnknown, xstate102.EventObject>> | xstate102.ActorRefFromLogic<xstate102.PromiseActorLogic<false | PreviewUrlPreviewMode, {
    targetOrigin: string;
  }, xstate102.EventObject>> | undefined;
}, {
  src: "check permission";
  logic: xstate102.ObservableActorLogic<PermissionCheckResult, CheckPermissionInput, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "create preview secret";
  logic: xstate102.PromiseActorLogic<{
    secret: string;
    expiresAt: Date;
  }, xstate102.NonReducibleUnknown, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "read shared preview secret";
  logic: xstate102.PromiseActorLogic<string | null, xstate102.NonReducibleUnknown, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "resolve allow patterns";
  logic: xstate102.PromiseActorLogic<URLPattern[], {
    initialUrl: URL;
  }, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "resolve initial url";
  logic: xstate102.PromiseActorLogic<URL, {
    previewSearchParam: string | null;
  }, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "resolve preview mode";
  logic: xstate102.PromiseActorLogic<false | PreviewUrlPreviewMode, {
    targetOrigin: string;
  }, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "resolve preview mode url";
  logic: xstate102.PromiseActorLogic<URL, ResolvePreviewModeUrlInput, xstate102.EventObject>;
  id: string | undefined;
} | {
  src: "resolve url from preview search param";
  logic: xstate102.PromiseActorLogic<URL, {
    initialUrl: URL;
    previewSearchParam: string | null | undefined;
    allowOrigins: URLPattern[];
  }, xstate102.EventObject>;
  id: string | undefined;
}, {
  type: "assign error";
  params: {
    message: string;
    error: unknown;
  };
} | {
  type: "assign preview search param";
  params: {
    previewSearchParam: string | null;
  };
} | {
  type: "notify preview will likely fail";
  params: xstate102.NonReducibleUnknown;
}, {
  type: "can create preview secret";
  params: unknown;
} | {
  type: "has checked permissions";
  params: unknown;
} | {
  type: "has preview mode with created secret";
  params: false | PreviewUrlPreviewMode;
} | {
  type: "has preview mode with share access";
  params: false | PreviewUrlPreviewMode;
} | {
  type: "has preview mode without permissions";
  params: false | PreviewUrlPreviewMode;
} | {
  type: "search param has new origin";
  params: unknown;
}, "expiredSecret", "checkingPermissions" | "error" | "resolvingAllowPatterns" | "resolvingInitialUrl" | "resolvingPreviewMode" | "resolvingUrlFromPreviewSearchParam" | "success" | {
  previewMode: "createPreviewSecret" | "error" | "readShareAccess" | "resolvePreviewUrl" | "success";
}, "busy" | "error", Input, xstate102.NonReducibleUnknown, xstate102.EventObject, xstate102.MetaObject, {
  id: "Preview URL";
  states: {
    readonly checkingPermissions: {};
    readonly resolvingInitialUrl: {};
    readonly error: {};
    readonly resolvingAllowPatterns: {};
    readonly resolvingUrlFromPreviewSearchParam: {
      id: "loop";
    };
    readonly resolvingPreviewMode: {};
    readonly success: {};
    readonly previewMode: {
      states: {
        readonly createPreviewSecret: {};
        readonly readShareAccess: {};
        readonly resolvePreviewUrl: {};
        readonly error: {};
        readonly success: {};
      };
    };
  };
}>;
type PreviewUrlRef = ActorRefFrom<typeof previewUrlMachine>;
/** @public */
interface PreviewProps {
  canSharePreviewAccess: boolean;
  canToggleSharePreviewAccess: boolean;
  canUseSharedPreviewAccess: boolean;
  header?: HeaderOptions;
  initialUrl: URL;
  loadersConnection: ConnectionStatus;
  navigatorEnabled: boolean;
  onPathChange: (nextPath: string) => void;
  onRefresh: (fallback: () => void) => void;
  openPopup: (url: string) => void;
  overlaysConnection: ConnectionStatus;
  presentationRef: PresentationMachineRef;
  perspective: PresentationPerspective;
  previewUrl?: string;
  setViewport: (mode: 'desktop' | 'mobile') => void;
  targetOrigin: string;
  toggleNavigator?: () => void;
  toggleOverlay: () => void;
  viewport: PresentationViewport;
  vercelProtectionBypass: string | null;
  previewUrlRef: PreviewUrlRef;
}
/** @public */
interface PreviewHeaderProps extends PreviewProps {
  iframeRef: RefObject<HTMLIFrameElement | null>;
  renderDefault: (props: PreviewHeaderProps) => React.JSX.Element;
}
/**
 * Represents a document location
 * @public
 */
interface DocumentLocation {
  /**
   * Title of the document
   */
  title: string;
  /**
   * URL of the document location
   */
  href: string;
}
/**
 * State for describing document locations or providing a message if locations are unavailable
 * @public
 */
interface DocumentLocationsState {
  /**
   * Array of document locations
   */
  locations?: DocumentLocation[];
  /**
   * Message to display if locations are unavailable
   */
  message?: string;
  /**
   * Tone of the message
   */
  tone?: 'positive' | 'caution' | 'critical';
}
/**
 * Function used for advanced document location resolution
 * @param params - Object with document `id` and document `type` properties
 * @param context - Object with `documentStore` property for creating listenQuery subscriptions
 * @returns Document location state, optionally as an Observable, or null/undefined if no locations are available
 * @public
 */
type DocumentLocationResolver = (params: {
  id: string;
  type: string;
  version: string | undefined;
  perspectiveStack: StackablePerspective[];
}, context: {
  documentStore: DocumentStore;
}) => DocumentLocationsState | null | undefined | Observable<DocumentLocationsState | null | undefined>;
/**
 * Configuration options for Presentation tool's optional navigator component
 * The navigator appears as a resizable sidebar panel
 *
 * @public
 */
interface NavigatorOptions {
  /**
   * Minimum width of the navigator panel in pixels
   */
  minWidth?: number;
  /**
   * Maximum width of the navigator panel in pixels
   */
  maxWidth?: number;
  /**
   * React component to render in the navigator panel
   */
  component: ComponentType;
}
/**
 * Configuration options for Presentation tool's optional custom preview header component
 *
 * @public
 */
interface HeaderOptions {
  /**
   * React component to render as the preview header, receives PreviewHeaderProps
   */
  component: ComponentType<PreviewHeaderProps>;
}
/** @public */
interface PreviewUrlAllowOptionContext {
  client: SanityClient$1;
  /**
   * Equivalent to `location.origin`
   */
  origin: string;
  /**
   * The initial URL of the preview
   */
  initialUrl: URL;
}
/** @public */
interface PreviewUrlInitialOptionContext {
  client: SanityClient$1;
  /**
   * Equivalent to `location.origin`
   */
  origin: string;
}
/** @public */
interface PreviewUrlPreviewModeOptionContext {
  client: SanityClient$1;
  /**
   * Equivalent to `location.origin`
   */
  origin: string;
  /**
   * The origin on the URL that will be used in the preview iframe
   */
  targetOrigin: string;
}
/** @public */
type PreviewUrlAllowOption = string | string[] | ((context: PreviewUrlAllowOptionContext) => string | string[] | Promise<string | string[]>);
/** @public */
type PreviewUrlInitialOption = string | ((context: PreviewUrlInitialOptionContext) => string | Promise<string>);
/** @public */
type PreviewUrlPreviewModeOption = PreviewUrlPreviewMode | ((context: PreviewUrlPreviewModeOptionContext) => false | PreviewUrlPreviewMode | Promise<false | PreviewUrlPreviewMode>);
/** @public */
interface PreviewUrlPreviewMode {
  /**
   * The route that enables Preview Mode
   * @example '/api/preview'
   * @example '/api/draft-mode/enable'
   */
  enable: string;
  /**
   * Allow sharing access to a preview with others.
   * This is enabled/disabled in the Presentation Tool. It's initially disabled, and can be enabled by someone who has access to creating draft documents in the Studio.
   * Custom roles can limit access to `_id in path("drafts.**") && _type == "sanity.previewUrlSecret"`.
   * This will create a secret that is valid until sharing is disabled. Turning sharing off and on again will create a new secret and can be used to remove access for folks that got the link in an email but should no longer have access.
   * Share URLs to previews will append this secret and give access to anyone who is given the URL, they don't need to be logged into the Studio or to Vercel.
   */
  shareAccess?: boolean;
  /**
   * The route that reports if Preview Mode is enabled or not, useful for debugging
   * @example '/api/check-preview'
   * @deprecated - this API is not yet implemented
   */
  check?: string;
  /**
   * The route that disables Preview Mode, useful for debugging
   * @example '/api/disable-preview'
   * @deprecated - this API is not yet implemented
   */
  disable?: string;
}
/**
 * @public
 */
interface PreviewUrlResolverOptions {
  /**
   * The default preview URL, used when the URL to use is not yet known, or there's no `&preview=...` search param in the studio URL.
   * @example '/en/preview?q=shoes'
   * @example 'https://example.com'
   * @defaultValue `location.origin`
   */
  initial?: PreviewUrlInitialOption;
  previewMode?: PreviewUrlPreviewModeOption;
  /**
   * @defaultValue `location.origin`
   * @deprecated - use `initial` instead
   */
  origin?: string;
  /**
   * @defaultValue '/'
   * @deprecated - use `initial` instead
   */
  preview?: string;
  /**
   * @deprecated - use `previewMode` instead
   */
  draftMode?: {
    /**
     * @deprecated - use `previewMode.enable` instead
     */
    enable: string;
    /**
     * @deprecated - use `previewMode.shareAccess` instead
     */
    shareAccess?: boolean;
    /**
     * @deprecated - use `previewMode.check` instead
     */
    check?: string;
    /**
     * @deprecated - use `previewMode.disable` instead
     */
    disable?: string;
  };
}
/**
 * @deprecated the `previewUrl.initial`, `previewUrl.allowOrigins` and `previewUrl.previewMode.enable` supports async functions that offer advanced control over how preview URLs are resolved
 * @public
 */
type DeprecatedPreviewUrlResolver = PreviewUrlResolver<SanityClient$1>;
/** @public */
type PreviewUrlOption = string | DeprecatedPreviewUrlResolver | PreviewUrlResolverOptions;
/**
 * Object of document location resolver definitions per document type
 * @public
 */
type DocumentLocationResolvers = Record<string, DocumentLocationResolverObject | DocumentLocationsState>;
/**
 * Document location resolver object
 * @public
 */
type DocumentLocationResolverObject<K extends string = string> = {
  /**
   * Object for selecting document fields
   */
  select: Record<K, string>;
  /**
   * Function that accepts a document with the selected fields and returns an optional document location state
   */
  resolve: (value: Record<K, any> | null) => DocumentLocationsState | null | undefined | void;
};
/**
 * Context object passed to functions used in `DocumentResolver` definitions.
 * Contains information about the current URL being matched against route patterns.
 *
 * @example
 * For a route pattern `/blog/:category/:slug` matching URL `https://example.com/blog/tech/hello-world`:
 * ```ts
 * {
 *   origin: 'https://example.com',
 *   params: { category: 'tech', slug: 'hello-world' },
 *   path: '/blog/tech/hello-world'
 * }
 * ```
 *
 * @public
 */
interface DocumentResolverContext {
  /**
   * The origin (protocol + hostname + port) of the matched URL
   */
  origin: string;
  /**
   * Extracted route parameters from URL path matching (e.g., `:slug` â†’ `{slug: 'value'}`)
   */
  params: Record<string, string>;
  /**
   * The pathname of the matched URL (without query parameters)
   */
  path: string;
}
/**
 * Generic function type used in `DocumentResolver` definitions that receives a `DocumentResolverContext` and returns a computed value.
 * @param context - `DocumentResolverContext` containing route information (origin, params, path)
 * @returns Computed value based on the context (typically a string for filters or an object for parameters)
 * @public
 */
type ContextFn<T> = (context: DocumentResolverContext) => T;
/**
 * Configuration object for resolving documents based on URL route patterns.
 * Used to define the main document when navigating to specific URLs in
 * Presentation tool's preview iframe.
 *
 * Supports three different resolution strategies:
 *
 * **Simple type-based resolution:**
 * ```ts
 * {
 *   route: '/blog',
 *   type: 'blog'  // Useful for singleton documents
 * }
 * ```
 *
 * **GROQ filter-based resolution:**
 * ```ts
 * {
 *   route: '/blog/:category/:slug',
 *   filter: ({ params }) => `_type == "post" && slug.current == "${params.slug}"`,
 *   params: ({ params }) => ({ category: params.category })
 * }
 * ```
 *
 * **Advanced resolution with custom logic:**
 * ```ts
 * {
 *   route: '/products/:id',
 *   resolve: ({ params }) => ({
 *     filter: `_type == "product" && _id == $id`,
 *     params: { id: params.id }
 *   })
 * }
 * ```
 *
 * @public
 */
type DocumentResolver = {
  route: string | Array<string>;
  type: string;
  filter?: never;
  params?: never;
  resolve?: never;
} | {
  route: string | Array<string>;
  type?: never;
  filter: ContextFn<string> | string;
  params?: ContextFn<Record<string, string>> | Record<string, string>;
  resolve?: never;
} | {
  route: string | Array<string>;
  type?: never;
  filter?: never;
  params?: never;
  resolve: ContextFn<{
    filter: string;
    params?: Record<string, string>;
  } | undefined>;
};
/**
 * Configuration options for the Presentation tool.
 * @public
 */
interface PresentationPluginOptions {
  devMode?: boolean | (() => boolean);
  icon?: ComponentType;
  name?: string;
  title?: string;
  allowOrigins?: PreviewUrlAllowOption;
  previewUrl: PreviewUrlOption;
  /**
   * @deprecated use `resolve.locations` instead
   */
  locate?: DocumentLocationResolver;
  resolve?: {
    mainDocuments?: DocumentResolver[];
    locations?: DocumentLocationResolvers | DocumentLocationResolver;
  };
  components?: {
    unstable_header?: HeaderOptions;
    unstable_navigator?: NavigatorOptions;
  };
  /**
   * @deprecated this feature flag is no longer needed
   */
  unstable_showUnsafeShareUrl?: boolean;
}
/**
 * Presentation specific state that is stored in the pathname section of the URL
 * @public
 */
interface PresentationStateParams {
  type?: string;
  id?: string;
  path?: string;
}
/**
 * Presentation specific URL search parameters, they should persist when
 * navigating between the document pane and document list pane
 * @public
 */
interface PresentationSearchParams {
  preview?: string;
  perspective?: string;
  viewport?: string;
}
/**
 * Document Pane specific URL search parameters, they should not persist when
 * navigating between the document pane and document list pane
 * @public
 */
interface StructureDocumentPaneParams extends InspectorTab {
  inspect?: string;
  parentRefPath?: string;
  path?: string;
  rev?: string;
  since?: string;
  template?: string;
  templateParams?: string;
  version?: string;
  view?: string;
  pathKey?: string;
  instruction?: string;
  comment?: string;
  scheduledDraft?: string;
}
/**
 * parameters for the changes inspector
 * @public
 */
interface InspectorTab {
  changesInspectorTab?: 'history' | 'review';
}
/**
 * All possible URL search parameters used by the Presentation tool
 * @public
 */
interface CombinedSearchParams extends StructureDocumentPaneParams, PresentationSearchParams {}
/**
 * All possible parameters that can be used to describe the state of the
 * Presentation tool, stored in the pathname and as search parameters of the URL
 * @public
 */
interface PresentationParamsContextValue extends PresentationStateParams, CombinedSearchParams {}
/** @public */
type PresentationNavigateOptions = ({
  state: PresentationStateParams;
  params?: CombinedSearchParams;
} | {
  params: CombinedSearchParams;
  state?: PresentationStateParams;
}) & {
  replace?: boolean;
};
/** @public */
type PresentationNavigate = (options: PresentationNavigateOptions) => void;
/** @public */
type PresentationPerspective = Exclude<ClientPerspective, 'raw'>;
/** @public */
type PresentationViewport = 'desktop' | 'mobile';
/**
 * Represents the connection status between the Sanity Studio and Presentation's preview iframe.
 * @public
 */
type ConnectionStatus = 'connected' | 'connecting' | 'reconnecting' | 'idle';
/** @public */
type PresentationNavigateContextValue = (preview: string | undefined, document?: {
  type: string;
  id: string;
}) => void;
interface PresentationContextValue {
  devMode: boolean;
  name: string;
  navigate: PresentationNavigate;
  params: PresentationParamsContextValue;
  structureParams: StructureDocumentPaneParams;
  searchParams: PresentationSearchParams;
}
export { PreviewUrlResolver as C, PreviewProps as D, PreviewHeaderProps as E, PreviewUrlOption as S, StructureDocumentPaneParams as T, PresentationPerspective as _, DocumentLocationResolver as a, PresentationStateParams as b, DocumentLocationsState as c, HeaderOptions as d, InspectorTab as f, PresentationParamsContextValue as g, PresentationNavigateContextValue as h, DocumentLocation as i, DocumentResolver as l, PresentationContextValue as m, ConnectionStatus as n, DocumentLocationResolverObject as o, NavigatorOptions as p, ContextFn as r, DocumentLocationResolvers as s, CombinedSearchParams as t, DocumentResolverContext as u, PresentationPluginOptions as v, PreviewUrlResolverOptions as w, PresentationViewport as x, PresentationSearchParams as y };