{"version":3,"file":"runtime.js","sources":["../../src/_internal/cli/server/debug.ts","../../src/_internal/cli/server/createExternalFromImportMap.ts","../../src/_internal/cli/server/helpers.ts","../../src/_internal/cli/server/components/Favicons.tsx","../../src/_internal/cli/server/components/globalErrorHandler/GlobalErrorHandler.tsx","../../src/_internal/cli/server/components/NoJavascript.tsx","../../src/_internal/cli/server/components/BasicDocument.tsx","../../src/_internal/cli/server/components/DefaultDocument.tsx","../../src/_internal/cli/server/constants.ts","../../src/_internal/cli/server/renderDocument.tsx","../../src/_internal/cli/server/vite/plugin-sanity-build-entries.ts","../../src/_internal/cli/server/webManifest.ts","../../src/_internal/cli/server/vite/plugin-sanity-favicons.ts","../../src/_internal/cli/server/vite/plugin-sanity-runtime-rewrite.ts","../../src/_internal/cli/server/vite/plugin-schema-extraction.ts","../../src/_internal/cli/server/vite/plugin-typegen.ts","../../src/_internal/cli/server/getViteConfig.ts","../../src/_internal/cli/server/getEntryModule.ts","../../src/_internal/cli/server/sanityConfig.ts","../../src/_internal/cli/server/runtime.ts"],"sourcesContent":["import debugIt from 'debug'\n\nexport const debug = debugIt('sanity:server')\n","import {escapeRegExp} from 'lodash-es'\n\ntype ImportMap = {imports?: Record<string, string>}\n\n/**\n * Generates a Rollup `external` configuration array based on the provided\n * import map. We derive externals from the import map because this ensures that\n * modules listed in the import map are not bundled into the Rollup output so\n * the browser can load these bare specifiers according to the import map.\n */\nexport function createExternalFromImportMap({imports = {}}: ImportMap = {}): (string | RegExp)[] {\n  return Object.keys(imports).map((specifier) =>\n    specifier.endsWith('/') ? new RegExp(`^${escapeRegExp(specifier)}.+`) : specifier,\n  )\n}\n","/**\n * @internal\n */\nexport function isRecord(value: unknown): value is Record<string, unknown> {\n  return Boolean(value) && typeof value === 'object' && !Array.isArray(value)\n}\n\n/**\n * Ensures that the given path both starts and ends with a single slash\n *\n * @internal\n */\nexport function normalizeBasePath(pathName: string): string {\n  return `/${pathName}/`.replace(/^\\/+/, '/').replace(/\\/+$/, '/')\n}\n","import {type JSX} from 'react'\n\nexport function Favicons(): JSX.Element {\n  const base = '/static'\n  return (\n    <>\n      <link rel=\"icon\" href={`${base}/favicon.ico`} sizes=\"any\" />\n      <link rel=\"icon\" href={`${base}/favicon.svg`} type=\"image/svg+xml\" />\n      <link rel=\"apple-touch-icon\" href={`${base}/apple-touch-icon.png`} />\n      <link rel=\"manifest\" href={`${base}/manifest.webmanifest`} />\n    </>\n  )\n}\n","import {type JSX} from 'react'\n\nconst errorHandlerScript = `\n;(function () {\n  // The error channel is provided so that error handling can be delegated to a view component.\n  // If there is a subscriber to the error channel at the time the error happens, the error will be pushed to the subscriber instead of handled here.\n  var errorChannel = (function () {\n    var subscribers = Object.create(null)\n    var nextId = 0\n    function subscribe(subscriber) {\n      var id = nextId++\n      subscribers[id] = subscriber\n      return function unsubscribe() {\n        delete subscribers[id]\n      }\n    }\n\n    function publish(event) {\n      for (var id in subscribers) {\n        if (Object.hasOwn(subscribers, id)) {\n          subscribers[id](event)\n        }\n      }\n    }\n    return {\n      subscribers,\n      publish,\n      subscribe\n    }\n  })()\n\n  // NOTE: Store the error channel instance in the global scope so that the Studio application can\n  // access it and subscribe to errors.\n  window.__sanityErrorChannel = {\n    subscribe: errorChannel.subscribe\n  }\n\n  function _handleError(event) {\n    // If there are error channel subscribers, then we assume they will own error rendering,\n    // and we defer to them (no console error).\n    if (Object.keys(errorChannel.subscribers).length > 0) {\n      errorChannel.publish(event)\n    } else {\n      _renderErrorOverlay(event)\n    }\n  }\n\n  var ERROR_BOX_STYLE = [\n    'background: #fff',\n    'border-radius: 6px',\n    'box-sizing: border-box',\n    'color: #121923',\n    'flex: 1',\n    \"font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue','Liberation Sans',Helvetica,Arial,system-ui,sans-serif\",\n    'font-size: 16px',\n    'line-height: 21px',\n    'margin: 0 auto',\n    'max-width: 960px',\n    'max-height: 90dvh',\n    'overflow: auto',\n    'padding: 20px',\n    'width: 100%',\n  ].join(';')\n\n  var ERROR_CODE_STYLE = [\n    'color: #972E2A',\n    \"font-family: -apple-system-ui-monospace, 'SF Mono', Menlo, Monaco, Consolas, monospace\",\n    'font-size: 13px',\n    'line-height: 17px',\n    'margin: 0',\n  ].join(';')\n\n  function _renderErrorOverlay(event) {\n    var errorElement = document.querySelector('#__sanityError') || document.createElement('div')\n    var error = event.error\n    var colno = event.colno\n    var lineno = event.lineno\n    var filename = event.filename\n\n    errorElement.id = '__sanityError'\n    errorElement.innerHTML = [\n      '<div style=\"' + ERROR_BOX_STYLE + '\">',\n      '<div style=\"font-weight: 700;\">Uncaught error: ' + error.message + '</div>',\n      '<div style=\"color: #515E72; font-size: 13px; line-height: 17px; margin: 10px 0;\">' +\n        filename +\n        ':' +\n        lineno +\n        ':' +\n        colno +\n        '</div>',\n      '<pre style=\"' + ERROR_CODE_STYLE + '\">' + error.stack + '</pre>',\n      '</div>',\n    ].join('')\n\n    errorElement.style.position = 'fixed'\n    errorElement.style.zIndex = 1000000\n    errorElement.style.top = 0\n    errorElement.style.left = 0\n    errorElement.style.right = 0\n    errorElement.style.bottom = 0\n    errorElement.style.padding = '20px'\n    errorElement.style.background = 'rgba(16,17,18,0.66)'\n    errorElement.style.display = 'flex'\n    errorElement.style.alignItems = 'center'\n    errorElement.style.justifyContent = 'center'\n\n    document.body.appendChild(errorElement)\n  }\n\n  // Error listener\n  window.addEventListener('error', (event) => {\n    _handleError({\n      type: 'error',\n      error: event.error,\n      lineno: event.lineno,\n      colno: event.colno,\n      filename: event.filename\n    })\n  })\n\n  // Error listener\n  window.addEventListener('unhandledrejection', (event) => {\n    _handleError({\n      type: 'rejection',\n      error: event.reason\n    })\n  })\n})()\n`\n\n/** @internal */\nexport function GlobalErrorHandler(): JSX.Element {\n  // eslint-disable-next-line react/no-danger\n  return <script dangerouslySetInnerHTML={{__html: errorHandlerScript}} />\n}\n","import {type JSX} from 'react'\n\n/* eslint-disable i18next/no-literal-string */\nconst NoJsStyles = `\n.sanity-app-no-js__root {\n  position: absolute;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  background: #fff;\n}\n\n.sanity-app-no-js__content {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  font-family: helvetica, arial, sans-serif;\n}\n`\n\n/** @internal */\nexport function NoJavascript(): JSX.Element {\n  return (\n    <noscript>\n      <div className=\"sanity-app-no-js__root\">\n        <div className=\"sanity-app-no-js__content\">\n          <style type=\"text/css\">{NoJsStyles}</style>\n          <h1>JavaScript disabled</h1>\n          <p>\n            Please <a href=\"https://www.enable-javascript.com/\">enable JavaScript</a> in your\n            browser and reload the page to proceed.\n          </p>\n        </div>\n      </div>\n    </noscript>\n  )\n}\n","/**\n * App HTML Document, this is in the _internal package\n * to avoid importing styled-components from sanity pacakge\n */\n\n/* eslint-disable i18next/no-literal-string  -- title is literal for now */\nimport {type JSX} from 'react'\n\nimport {Favicons} from './Favicons'\nimport {GlobalErrorHandler} from './globalErrorHandler/GlobalErrorHandler'\nimport {NoJavascript} from './NoJavascript'\n\n/**\n * @internal\n */\nexport interface BasicDocumentProps {\n  entryPath: string\n  css?: string[]\n  // Currently unused, but kept for potential future use\n  // eslint-disable-next-line react/no-unused-prop-types\n  basePath?: string\n}\n\nconst EMPTY_ARRAY: never[] = []\n\n/**\n * This is the equivalent of DefaultDocument for non-studio apps.\n * @internal\n */\nexport function BasicDocument(props: BasicDocumentProps): JSX.Element {\n  const {entryPath, css = EMPTY_ARRAY} = props\n\n  return (\n    <html lang=\"en\">\n      <head>\n        <meta charSet=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, viewport-fit=cover\" />\n        <meta name=\"robots\" content=\"noindex\" />\n        <meta name=\"referrer\" content=\"same-origin\" />\n\n        <Favicons />\n        <title>Sanity Custom App</title>\n        <GlobalErrorHandler />\n\n        {css.map((href) => (\n          <link key={href} rel=\"stylesheet\" href={href} />\n        ))}\n      </head>\n      <body>\n        <div id=\"root\" />\n        <script type=\"module\" src={entryPath} />\n        <NoJavascript />\n      </body>\n    </html>\n  )\n}\n","/* eslint-disable i18next/no-literal-string */\n\nimport {Favicons} from './Favicons'\nimport {GlobalErrorHandler} from './globalErrorHandler/GlobalErrorHandler'\nimport {NoJavascript} from './NoJavascript'\n\nconst globalStyles = `\n  @font-face {\n    font-family: Inter;\n    font-style: normal;\n    font-weight: 400;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-Regular.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: italic;\n    font-weight: 400;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-Italic.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: normal;\n    font-weight: 500;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-Medium.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: italic;\n    font-weight: 500;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-MediumItalic.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: normal;\n    font-weight: 600;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-SemiBold.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: italic;\n    font-weight: 600;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-SemiBoldItalic.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: normal;\n    font-weight: 700;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-Bold.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: italic;\n    font-weight: 700;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-BoldItalic.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: normal;\n    font-weight: 800;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-ExtraBold.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: italic;\n    font-weight: 800;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-ExtraBoldItalic.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: normal;\n    font-weight: 900;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-Black.woff2\") format(\"woff2\");\n  }\n  @font-face {\n    font-family: Inter;\n    font-style: italic;\n    font-weight: 900;\n    font-display: swap;\n    src: url(\"https://studio-static.sanity.io/Inter-BlackItalic.woff2\") format(\"woff2\");\n  }\n  html {\n    @media (prefers-color-scheme: dark) {\n      background-color: #13141b;\n    }\n    @media (prefers-color-scheme: light) {\n      background-color: #ffffff;\n    }\n  }\n  html,\n  body,\n  #sanity {\n    height: 100%;\n  }\n  body {\n    margin: 0;\n    -webkit-font-smoothing: antialiased;\n  }\n`\n\n/**\n * @hidden\n * @beta\n */\nexport interface DefaultDocumentProps {\n  entryPath: string\n  css?: string[]\n\n  // Currently unused, but kept for potential future use\n  // eslint-disable-next-line react/no-unused-prop-types\n  basePath?: string\n}\n\nconst EMPTY_ARRAY: never[] = []\n\n/**\n * @internal\n */\nexport function DefaultDocument(props: DefaultDocumentProps): React.JSX.Element {\n  const {entryPath, css = EMPTY_ARRAY} = props\n\n  return (\n    <html lang=\"en\">\n      <head>\n        <meta charSet=\"utf-8\" />\n        <meta\n          name=\"viewport\"\n          content=\"width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover\"\n        />\n        <meta name=\"robots\" content=\"noindex\" />\n        <meta name=\"referrer\" content=\"same-origin\" />\n\n        <Favicons />\n\n        <title>Sanity Studio</title>\n\n        <GlobalErrorHandler />\n\n        {css.map((href) => (\n          <link key={href} rel=\"stylesheet\" href={href} />\n        ))}\n        {/* eslint-disable-next-line react/no-danger */}\n        <style dangerouslySetInnerHTML={{__html: globalStyles}} />\n      </head>\n      <body>\n        <div id=\"sanity\" />\n        <script type=\"module\" src={entryPath} />\n        <NoJavascript />\n      </body>\n    </html>\n  )\n}\n","/**\n * This script takes the import map from the `#__imports` script tag,\n * modifies relevant URLs that match the sanity-cdn hostname by replacing\n * the existing timestamp in the sanity-cdn URLs with a new runtime timestamp,\n * and injects the modified import map back into the HTML.\n *\n * This will be injected into the HTML of the user's bundle.\n *\n * Note that this is in a separate constants file to prevent \"Cannot access\n * before initialization\" errors.\n */\nexport const TIMESTAMPED_IMPORTMAP_INJECTOR_SCRIPT = `<script>\n  // auto-generated script to add import map with timestamp\n  const importsJson = document.getElementById('__imports')?.textContent;\n  const { imports = {}, ...rest } = importsJson ? JSON.parse(importsJson) : {};\n  const importMapEl = document.createElement('script');\n  importMapEl.type = 'importmap';\n  const newTimestamp = \\`/t\\${Math.floor(Date.now() / 1000)}\\`;\n  importMapEl.textContent = JSON.stringify({\n    imports: Object.fromEntries(\n      Object.entries(imports).map(([specifier, path]) => {\n        try {\n          const url = new URL(path);\n          if (/^sanity-cdn\\\\.[a-zA-Z]+$/.test(url.hostname)) {\n            url.pathname = url.pathname.replace(/\\\\/t\\\\d+/, newTimestamp);\n          }\n          return [specifier, url.toString()];\n        } catch {\n          return [specifier, path];\n        }\n      })\n    ),\n    ...rest,\n  });\n  document.head.appendChild(importMapEl);\n</script>`\n","/**\n * Looks for and imports (in preferred order):\n *   - src/_document.js\n *   - src/_document.tsx\n *\n * Then renders using ReactDOM to a string, which is sent back to the parent\n * process over the worker `postMessage` channel.\n */\nimport fs from 'node:fs'\nimport path from 'node:path'\nimport {fileURLToPath} from 'node:url'\nimport {isMainThread, parentPort, Worker, workerData} from 'node:worker_threads'\n\nimport chalk from 'chalk'\nimport importFresh from 'import-fresh'\nimport {parse as parseHtml} from 'node-html-parser'\nimport {renderToStaticMarkup} from 'react-dom/server'\n\nimport {BasicDocument} from './components/BasicDocument'\nimport {DefaultDocument} from './components/DefaultDocument'\nimport {TIMESTAMPED_IMPORTMAP_INJECTOR_SCRIPT} from './constants'\nimport {debug as serverDebug} from './debug'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = path.dirname(__filename)\n\nconst debug = serverDebug.extend('renderDocument')\n\n// Don't use threads in the jest world\n// eslint-disable-next-line turbo/no-undeclared-env-vars\nconst useThreads = typeof process.env.JEST_WORKER_ID === 'undefined'\nconst hasWarnedAbout = new Set<string>()\n\nconst defaultProps = {\n  entryPath: './.sanity/runtime/app.js',\n}\n\nconst autoGeneratedWarning = `\nThis file is auto-generated from \"sanity dev\".\nModifications to this file are automatically discarded.\n`.trim()\n\ninterface DocumentProps {\n  basePath: string\n  entryPath?: string\n  css?: string[]\n}\n\ninterface RenderDocumentOptions {\n  studioRootPath: string\n  props?: DocumentProps\n  importMap?: {\n    imports?: Record<string, string>\n  }\n  isApp?: boolean\n}\n\nexport function renderDocument(options: RenderDocumentOptions): Promise<string> {\n  return new Promise((resolve, reject) => {\n    if (!useThreads) {\n      resolve(\n        getDocumentHtml(options.studioRootPath, options.props, options.importMap, options.isApp),\n      )\n      return\n    }\n\n    debug('Starting worker thread for %s', __filename)\n    const worker = new Worker(__filename, {\n      execArgv: __DEV__ ? ['-r', `${__dirname}/esbuild-register.js`] : undefined,\n      workerData: {...options, dev: __DEV__, shouldWarn: true},\n      env: process.env,\n    })\n\n    worker.on('message', (msg) => {\n      if (msg.type === 'warning') {\n        if (hasWarnedAbout.has(msg.warnKey)) {\n          return\n        }\n\n        if (Array.isArray(msg.message)) {\n          msg.message.forEach((warning: string) =>\n            console.warn(`${chalk.yellow('[warn]')} ${warning}`),\n          )\n        } else {\n          console.warn(`${chalk.yellow('[warn]')} ${msg.message}`)\n        }\n\n        hasWarnedAbout.add(msg.warnKey)\n        return\n      }\n\n      if (msg.type === 'error') {\n        debug('Error from worker: %s', msg.error || 'Unknown error')\n        reject(new Error(msg.error || 'Document rendering worker stopped with an unknown error'))\n        return\n      }\n\n      if (msg.type === 'result') {\n        debug('Document HTML rendered, %d bytes', msg.html.length)\n        resolve(msg.html)\n      }\n    })\n    worker.on('error', (err) => {\n      debug('Worker errored: %s', err.message)\n      reject(err)\n    })\n    worker.on('exit', (code) => {\n      if (code !== 0) {\n        debug('Worker stopped with code %d', code)\n        reject(new Error(`Document rendering worker stopped with exit code ${code}`))\n      }\n    })\n  })\n}\n\nexport function decorateIndexWithAutoGeneratedWarning(template: string): string {\n  return template.replace(/<head/, `\\n<!--\\n${autoGeneratedWarning}\\n-->\\n<head`)\n}\n\n/**\n * Decorates the given HTML template with a script\n * tag that loads the bridge component to communicate\n * with core-ui.\n */\nexport function decorateIndexWithBridgeScript(template: string): string {\n  const sanityEnv = process.env.SANITY_INTERNAL_ENV || 'production'\n\n  /**\n   * The URL to the bridge script is determined by the\n   * `SANITY_INTERNAL_ENV` environment variable. So if you deploy\n   * a studio to the staging ENV then you'll get the correct script.\n   */\n  const scriptURL =\n    sanityEnv === 'production'\n      ? 'https://core.sanity-cdn.com/bridge.js'\n      : 'https://core.sanity-cdn.work/bridge.js'\n\n  return template.replace(\n    '</head>',\n    `<script src=\"${scriptURL}\" async type=\"module\" data-sanity-core></script>\\n</head>`,\n  )\n}\n\nexport function getPossibleDocumentComponentLocations(studioRootPath: string): string[] {\n  return [path.join(studioRootPath, '_document.js'), path.join(studioRootPath, '_document.tsx')]\n}\n\n/**\n * Adds a base path to a URL if necessary, and returns the resulting URL.\n * @param url - The URL to prefix with a base path.\n * @param basePath - The base path to prefix the URL with. Default value is `/`.\n * @returns The resulting URL with the base path.\n * @internal\n */\nexport function _prefixUrlWithBasePath(url: string, basePath: string): string {\n  // Normalize basePath by adding a leading slash if it's missing.\n  const normalizedBasePath = basePath.startsWith('/') ? basePath : `/${basePath}`\n\n  // If the URL starts with a slash, append it to the basePath, removing any trailing slash if present.\n  if (url.startsWith('/')) {\n    if (normalizedBasePath.endsWith('/')) {\n      return `${normalizedBasePath.slice(0, -1)}${url}`\n    }\n    return `${normalizedBasePath}${url}`\n  }\n\n  // If the URL doesn't start with a slash, append it to the basePath with a slash in between.\n  if (normalizedBasePath.endsWith('/')) {\n    return `${normalizedBasePath}${url}`\n  }\n  return `${normalizedBasePath}/${url}`\n}\n\nif (!isMainThread && parentPort) {\n  void renderDocumentFromWorkerData()\n}\n\nasync function renderDocumentFromWorkerData() {\n  if (!parentPort || !workerData) {\n    throw new Error('Must be used as a Worker with a valid options object in worker data')\n  }\n\n  const {studioRootPath, props, importMap, isApp}: RenderDocumentOptions = workerData || {}\n\n  if (workerData?.dev) {\n    // Define `__DEV__` in the worker thread as well\n    // oxlint-disable-next-line no-explicit-any\n    ;(global as any).__DEV__ = true\n  }\n\n  if (typeof studioRootPath !== 'string') {\n    parentPort.postMessage({type: 'error', message: 'Missing/invalid `studioRootPath` option'})\n    return\n  }\n\n  if (props && typeof props !== 'object') {\n    parentPort.postMessage({type: 'error', message: '`props` must be an object if provided'})\n    return\n  }\n\n  // Require hook #1\n  // Use `esbuild` to allow JSX/TypeScript and modern JS features\n  debug('Registering esbuild for node %s', process.version)\n  const {register} = await import('esbuild-register/dist/node')\n  const {unregister} = __DEV__\n    ? {unregister: () => undefined}\n    : register({\n        target: `node${process.version.slice(1)}`,\n        supported: {'dynamic-import': true},\n        jsx: 'automatic',\n        extensions: ['.jsx', '.ts', '.tsx', '.mjs'],\n        format: 'cjs',\n      })\n\n  // Require hook #2\n  // Same as above, but we don't want to enforce a .jsx extension for anything with JSX\n  debug('Registering esbuild for .js files using jsx loader')\n  const {unregister: unregisterJs} = __DEV__\n    ? {unregister: () => undefined}\n    : register({\n        target: `node${process.version.slice(1)}`,\n        supported: {'dynamic-import': true},\n        extensions: ['.js'],\n        jsx: 'automatic',\n        loader: 'jsx',\n        format: 'cjs',\n      })\n\n  const html = getDocumentHtml(studioRootPath, props, importMap, isApp)\n\n  parentPort.postMessage({type: 'result', html})\n\n  // Be polite and clean up after esbuild-register\n  unregister()\n  unregisterJs()\n}\n\nfunction getDocumentHtml(\n  studioRootPath: string,\n  props?: DocumentProps,\n  importMap?: {imports?: Record<string, string>},\n  isApp?: boolean,\n): string {\n  const Document = getDocumentComponent(studioRootPath, isApp)\n\n  // NOTE: Validate the list of CSS paths so implementers of `_document.tsx` don't have to\n  // - If the path is not a full URL, check if it starts with `/`\n  //   - If not, then prepend a `/` to the string\n  const css = props?.css?.map((url) => {\n    try {\n      // If the URL is absolute, we don't need to prefix it\n      return new URL(url).toString()\n    } catch {\n      return _prefixUrlWithBasePath(url, props.basePath)\n    }\n  })\n\n  debug('Rendering document component using React')\n  const result = addTimestampedImportMapScriptToHtml(\n    renderToStaticMarkup(<Document {...defaultProps} {...props} css={css} />),\n    importMap,\n  )\n\n  return `<!DOCTYPE html>${result}`\n}\n\n/**\n * @internal\n */\nexport function addTimestampedImportMapScriptToHtml(\n  html: string,\n  importMap?: {imports?: Record<string, string>},\n): string {\n  if (!importMap) return html\n\n  let root = parseHtml(html)\n  let htmlEl = root.querySelector('html')\n  if (!htmlEl) {\n    const oldRoot = root\n    root = parseHtml('<html></html>')\n    htmlEl = root.querySelector('html')!\n    htmlEl.appendChild(oldRoot)\n  }\n\n  let headEl = htmlEl.querySelector('head')\n\n  if (!headEl) {\n    htmlEl.insertAdjacentHTML('afterbegin', '<head></head>')\n    headEl = root.querySelector('head')!\n  }\n\n  headEl.insertAdjacentHTML(\n    'beforeend',\n    `<script type=\"application/json\" id=\"__imports\">${JSON.stringify(importMap)}</script>`,\n  )\n  headEl.insertAdjacentHTML('beforeend', TIMESTAMPED_IMPORTMAP_INJECTOR_SCRIPT)\n  return root.outerHTML\n}\n\nfunction getDocumentComponent(studioRootPath: string, isApp?: boolean) {\n  debug('Loading default document component from `sanity` module')\n\n  const Document = isApp ? BasicDocument : DefaultDocument\n\n  debug('Attempting to load user-defined document component from %s', studioRootPath)\n  const userDefined = tryLoadDocumentComponent(studioRootPath)\n\n  if (!userDefined) {\n    debug('Using default document component')\n    return Document\n  }\n\n  debug('Found user defined document component at %s', userDefined.path)\n\n  const DocumentComp = userDefined.component.default || userDefined.component // CommonJS\n  if (typeof DocumentComp === 'function') {\n    debug('User defined document component is a function, assuming valid')\n    return DocumentComp\n  }\n\n  debug('User defined document component did not have a default export')\n  const userExports = Object.keys(userDefined.component).join(', ') || 'None'\n  const relativePath = path.relative(process.cwd(), userDefined.path)\n  const typeHint =\n    typeof userDefined.component.default === 'undefined'\n      ? ''\n      : ` (type was ${typeof userDefined.component.default})`\n\n  const warnKey = `${relativePath}/${userDefined.modified}`\n\n  parentPort?.postMessage({\n    type: 'warning',\n    message: [\n      `${relativePath} did not have a default export that is a React component${typeHint}`,\n      `Named exports/properties found: ${userExports}`.trim(),\n      `Using default document component from \"sanity\".`,\n    ],\n    warnKey,\n  })\n\n  return DefaultDocument\n}\n\nfunction tryLoadDocumentComponent(studioRootPath: string) {\n  const locations = getPossibleDocumentComponentLocations(studioRootPath)\n\n  for (const componentPath of locations) {\n    debug('Trying to load document component from %s', componentPath)\n    try {\n      return {\n        component: importFresh<any>(componentPath),\n        path: componentPath,\n        modified: Math.floor(fs.statSync(componentPath)?.mtimeMs),\n      }\n    } catch (err) {\n      // Allow \"not found\" errors\n      if (err.code !== 'MODULE_NOT_FOUND') {\n        debug('Failed to load document component: %s', err.message)\n        throw err\n      }\n\n      debug('Document component not found at %s', componentPath)\n    }\n  }\n\n  return null\n}\n","import {type ChunkMetadata, type Plugin} from 'vite'\n\nimport {decorateIndexWithBridgeScript, renderDocument} from '../renderDocument'\n\ninterface ViteOutputBundle {\n  [fileName: string]: ViteRenderedChunk | ViteRenderedAsset\n}\n\ninterface ViteRenderedAsset {\n  type: 'asset'\n}\n\ninterface ViteRenderedChunk {\n  type: 'chunk'\n  name: string\n  fileName: string\n  facadeModuleId: string | null\n  code: string\n  imports: string[]\n  viteMetadata: ChunkMetadata\n  isEntry: boolean\n}\n\nconst entryChunkId = '.sanity/runtime/app.js'\n\nexport function sanityBuildEntries(options: {\n  cwd: string\n  basePath: string\n  importMap?: {imports?: Record<string, string>}\n  isApp?: boolean\n}): Plugin {\n  const {cwd, basePath, importMap, isApp} = options\n\n  return {\n    name: 'sanity/server/build-entries',\n    apply: 'build',\n\n    buildStart() {\n      this.emitFile({\n        type: 'chunk',\n        id: entryChunkId,\n        name: 'sanity',\n      })\n    },\n\n    async generateBundle(_options, outputBundle) {\n      const bundle = outputBundle as unknown as ViteOutputBundle\n      const entryFile = Object.values(bundle).find(\n        (file) =>\n          file.type === 'chunk' &&\n          file.name === 'sanity' &&\n          file.facadeModuleId?.endsWith(entryChunkId),\n      )\n\n      if (!entryFile) {\n        throw new Error(`Failed to find entry file in bundle (${entryChunkId})`)\n      }\n\n      if (entryFile.type !== 'chunk') {\n        throw new Error('Entry file is not a chunk')\n      }\n\n      const entryFileName = entryFile.fileName\n      const entryPath = [basePath.replace(/\\/+$/, ''), entryFileName].join('/')\n\n      let css: string[] = []\n      if (entryFile.viteMetadata?.importedCss) {\n        // Check all the top-level imports of the entryPoint to see if they have\n        // static CSS assets that need loading\n        css = [...entryFile.viteMetadata.importedCss]\n        for (const key of entryFile.imports) {\n          // Traverse all CSS assets that isn't loaded by the runtime and\n          // need <link> tags in the HTML template\n          const entry = bundle[key]\n          const importedCss =\n            entry && entry.type === 'chunk' ? entry.viteMetadata.importedCss : undefined\n\n          if (importedCss) {\n            css.push(...importedCss)\n          }\n        }\n      }\n\n      this.emitFile({\n        type: 'asset',\n        fileName: 'index.html',\n        source: decorateIndexWithBridgeScript(\n          await renderDocument({\n            studioRootPath: cwd,\n            importMap,\n            props: {\n              basePath,\n              entryPath,\n              css,\n            },\n            isApp,\n          }),\n        ),\n      })\n    },\n  }\n}\n","export interface WebManifest {\n  icons: {\n    src: string\n    type: string\n    sizes: string\n  }[]\n}\n\nexport function generateWebManifest(basePath: string): WebManifest {\n  return {\n    icons: [\n      {src: `${basePath}/favicon-96.png`, type: 'image/png', sizes: '96x96'},\n      {src: `${basePath}/favicon-192.png`, type: 'image/png', sizes: '192x192'},\n      {src: `${basePath}/favicon-512.png`, type: 'image/png', sizes: '512x512'},\n    ],\n  }\n}\n","import fs from 'node:fs/promises'\nimport path from 'node:path'\n\nimport {type Plugin} from 'vite'\n\nimport {generateWebManifest} from '../webManifest'\n\nconst mimeTypes: Record<string, string | undefined> = {\n  '.ico': 'image/x-icon',\n  '.svg': 'image/svg+xml',\n  '.png': 'image/png',\n}\n\n/**\n * Fallback favicons plugin for Sanity.\n *\n * If a favicon is not found in the static folder, this plugin will serve the default\n * Sanity favicons from the npm bundle. If a custom `favicon.ico` is found in the static\n * folder, it will also be served for a root `/favicon.ico` request.\n *\n * @param options - Options for the plugin\n * @returns A Vite plugin\n * @internal\n */\nexport function sanityFaviconsPlugin({\n  defaultFaviconsPath,\n  customFaviconsPath,\n  staticUrlPath,\n}: {\n  defaultFaviconsPath: string\n  customFaviconsPath: string\n  staticUrlPath: string\n}): Plugin {\n  const cache: {favicons?: string[]} = {}\n\n  async function getFavicons(): Promise<string[]> {\n    if (cache.favicons) {\n      return cache.favicons\n    }\n\n    cache.favicons = await fs.readdir(defaultFaviconsPath)\n    return cache.favicons\n  }\n\n  async function hasCustomFavicon(fileName: string): Promise<boolean> {\n    try {\n      await fs.access(path.join(customFaviconsPath, fileName))\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  return {\n    name: 'sanity/server/sanity-favicons',\n    apply: 'serve',\n    configureServer(viteDevServer) {\n      const webManifest = JSON.stringify(generateWebManifest(staticUrlPath), null, 2)\n      const webManifestPath = `${staticUrlPath}/manifest.webmanifest`\n\n      viteDevServer.middlewares.use(async (req, res, next) => {\n        if (req.url?.endsWith(webManifestPath)) {\n          res.writeHead(200, 'OK', {'content-type': 'application/manifest+json'})\n          res.write(webManifest)\n          res.end()\n          return\n        }\n\n        const parsedUrl =\n          ((req as any)._parsedUrl as URL) || new URL(req.url || '/', 'http://localhost:3333')\n\n        const pathName = parsedUrl.pathname || ''\n        const fileName = path.basename(pathName || '')\n        const icons = await getFavicons()\n        const isIconRequest =\n          pathName.startsWith('/favicon.ico') ||\n          (icons.includes(fileName) && pathName.includes(staticUrlPath))\n\n        if (!isIconRequest) {\n          next()\n          return\n        }\n\n        const faviconPath = (await hasCustomFavicon(fileName))\n          ? path.join(customFaviconsPath, fileName)\n          : path.join(defaultFaviconsPath, fileName)\n\n        const mimeType = mimeTypes[path.extname(fileName)] || 'application/octet-stream'\n        res.writeHead(200, 'OK', {'content-type': mimeType})\n        res.write(await fs.readFile(faviconPath))\n        res.end()\n      })\n    },\n  }\n}\n","import {type Plugin} from 'vite'\n\nexport function sanityRuntimeRewritePlugin(): Plugin {\n  return {\n    name: 'sanity/server/sanity-runtime-rewrite',\n    apply: 'serve',\n    configureServer(viteDevServer) {\n      return () => {\n        viteDevServer.middlewares.use((req, res, next) => {\n          if (req.url === '/index.html') {\n            req.url = '/.sanity/runtime/index.html'\n          }\n\n          next()\n        })\n      }\n    },\n  }\n}\n","import path, {isAbsolute} from 'node:path'\n\nimport {type CliCommandContext} from '@sanity/cli'\nimport {debounce, mean, once} from 'lodash-es'\nimport logSymbols from 'log-symbols'\nimport picomatch from 'picomatch'\nimport {type Plugin} from 'vite'\n\nimport {\n  SchemaExtractedTrace,\n  SchemaExtractionWatchModeTrace,\n} from '../../actions/schema/extractSchema.telemetry'\nimport {formatSchemaValidation} from '../../actions/schema/formatSchemaValidation'\nimport {extractSchemaToFile, SchemaExtractionError} from '../../actions/schema/schemaExtractorApi'\n\n/**\n * Default glob patterns to watch for schema changes.\n * Covers the sanity config file and common schema directory naming conventions.\n */\nconst DEFAULT_SCHEMA_PATTERNS = [\n  'sanity.config.{js,jsx,ts,tsx,mjs}',\n  'schema*/**/*.{js,jsx,ts,tsx,mjs}',\n]\n\n/** Default debounce delay in milliseconds */\nconst DEFAULT_DEBOUNCE_MS = 1000\n\n/**\n * Delay before initial extraction to allow Vite to finish startup\n * and avoid race conditions with module resolution.\n */\nconst INITIAL_EXTRACTION_DELAY_MS = 1000\n\n/**\n * Options for the Sanity schema extraction Vite plugin.\n *\n * @public\n */\nexport interface SchemaExtractionPluginOptions {\n  /**\n   * Working directory containing the Sanity configuration.\n   * This should be the root of your Sanity Studio project where\n   * `sanity.config.ts` is located.\n   * @defaultValue Vite's project root (`config.root`)\n   */\n  workDir?: string\n\n  /**\n   * Path where the extracted schema JSON will be written.\n   * Can be absolute or relative to the working directory.\n   * @defaultValue `path.join(workDir, 'schema.json')`\n   */\n  outputPath?: string\n\n  /**\n   * Logger for output messages. Must implement `log`, `info`, and `error` methods.\n   * @defaultValue `console`\n   */\n  output?: Pick<Console, 'log' | 'info' | 'error'>\n\n  /**\n   * Workspace name for multi-workspace Sanity configurations.\n   * Required when your `sanity.config.ts` exports multiple workspaces\n   * and you want to extract schema from a specific one.\n   */\n  workspaceName?: string\n\n  /**\n   * Additional glob patterns to watch for schema changes.\n   * These are merged with the default patterns.\n   * @example `['lib/custom-types/**\\/*.ts', 'shared/schemas/**\\/*.ts']`\n   */\n  additionalPatterns?: string[]\n\n  /**\n   * Debounce delay in milliseconds before triggering extraction\n   * after a file change. Helps prevent excessive extractions\n   * during rapid file saves.\n   * @defaultValue 1000\n   */\n  debounceMs?: number\n\n  /**\n   * When true, marks all fields as required in the extracted schema\n   * unless they are explicitly marked as optional.\n   * @defaultValue false\n   */\n  enforceRequiredFields?: boolean\n\n  /**\n   * Format of schema export. groq-type-nodes is the only avilable format at the moment\n   */\n  format?: string\n\n  /**\n   * Telemetry logger for the Sanity CLI tooling. If no logger is provided no telemetry\n   * is sent. Also, no telemetry will be sent if telemetry is disabled in the sanity CLI.\n   */\n  telemetryLogger?: CliCommandContext['telemetry']\n}\n\n/**\n * Creates a Vite plugin that automatically extracts Sanity schema during development and build.\n *\n * **During development:**\n * The plugin performs an initial extraction when the dev server starts, then watches\n * for file changes and re-extracts the schema when relevant files are modified.\n *\n * **During build:**\n * The plugin extracts the schema once at the end of the build process, ensuring\n * the schema is always up-to-date when deploying.\n *\n * **How it works in dev mode:**\n * 1. Registers watch patterns with Vite's built-in file watcher\n * 2. Performs initial schema extraction when the server starts\n * 3. On file changes matching the patterns, triggers a debounced extraction\n * 4. Uses concurrency control to prevent overlapping extractions\n *\n * @param options - Configuration options for the plugin\n * @returns A Vite plugin configured for schema extraction\n *\n * @internal\n */\nexport function sanitySchemaExtractionPlugin(options: SchemaExtractionPluginOptions = {}) {\n  const {\n    workDir: workDirOption,\n    outputPath: outputPathOption = 'schema.json',\n    output = console,\n    workspaceName,\n    additionalPatterns = [],\n    debounceMs = DEFAULT_DEBOUNCE_MS,\n    enforceRequiredFields = false,\n    telemetryLogger,\n    format = 'groq-type-nodes',\n  } = options\n\n  const watchPatterns = [...DEFAULT_SCHEMA_PATTERNS, ...additionalPatterns]\n\n  // Resolved after Vite config is available\n  let resolvedWorkDir: string\n  let resolvedOutputPath: string\n\n  // State for concurrency control\n  let isExtracting = false\n  let pendingExtraction = false\n\n  // Stats for telemetry\n  const startTime = Date.now()\n  const stats: {successfulDurations: number[]; failedCount: number} = {\n    successfulDurations: [],\n    failedCount: 0,\n  }\n\n  const extractSchema = () =>\n    extractSchemaToFile({\n      workDir: resolvedWorkDir,\n      outputPath: resolvedOutputPath,\n      workspaceName,\n      enforceRequiredFields,\n      format,\n    })\n\n  /**\n   * Runs extraction with concurrency control.\n   * If extraction is already running, queues one more extraction to run after completion.\n   */\n  async function runExtraction(isBuilding = false): Promise<void> {\n    if (isExtracting) {\n      pendingExtraction = true\n      return\n    }\n\n    isExtracting = true\n    pendingExtraction = false\n\n    const extractionStartTime = Date.now()\n    try {\n      await extractSchema()\n      if (isBuilding) {\n        // TODO: Remove when we have better control over progress reporting in build\n        output.log('')\n      }\n      output.log(logSymbols.success, `Extracted schema to ${outputPathOption}`)\n\n      // add stats for the successful extraction run to use later for telemetry\n      stats.successfulDurations.push(Date.now() - extractionStartTime)\n    } catch (err) {\n      output.log(\n        logSymbols.error,\n        `Extraction failed: ${err instanceof Error ? err.message : String(err)}`,\n      )\n      if (err instanceof SchemaExtractionError && err.validation && err.validation.length > 0) {\n        output.log(logSymbols.error, formatSchemaValidation(err.validation))\n      }\n\n      // track the failed extraction\n      stats.failedCount++\n    } finally {\n      isExtracting = false\n\n      // If a change came in during extraction, run again\n      if (pendingExtraction) {\n        pendingExtraction = false\n        await runExtraction()\n      }\n    }\n  }\n\n  const debouncedExtract = debounce(() => {\n    void runExtraction()\n  }, debounceMs)\n\n  // Create a matcher function from all watch patterns\n  const isMatch = picomatch(watchPatterns)\n\n  return {\n    name: 'sanity/schema-extraction',\n\n    configResolved(config) {\n      // Resolve workDir from option or Vite's project root\n      resolvedWorkDir = workDirOption ?? config.root\n\n      if (isAbsolute(outputPathOption)) {\n        resolvedOutputPath = outputPathOption\n      } else {\n        resolvedOutputPath = path.join(resolvedWorkDir, outputPathOption)\n      }\n    },\n\n    configureServer(server) {\n      const trace = telemetryLogger?.trace(SchemaExtractionWatchModeTrace)\n      trace?.start()\n\n      trace?.log({step: 'started', enforceRequiredFields, schemaFormat: format})\n\n      // Add schema patterns to Vite's watcher\n      const absolutePatterns = watchPatterns.map((pattern) => path.join(resolvedWorkDir, pattern))\n      server.watcher.add(absolutePatterns)\n\n      // Listen for file changes\n      const handleChange = (filePath: string) => {\n        const relativePath = path.isAbsolute(filePath)\n          ? path.relative(resolvedWorkDir, filePath)\n          : filePath\n        if (isMatch(relativePath)) {\n          debouncedExtract()\n        }\n      }\n\n      // Prepare function to log \"stopped\" event to trace and complete the trace\n      const onClose = once(() => {\n        if (!trace) {\n          return\n        }\n        trace.log({\n          step: 'stopped',\n          watcherDuration: Date.now() - startTime,\n          extractionSuccessfulCount: stats.successfulDurations.length,\n          extractionFailedCount: stats.failedCount,\n          averageExtractionDuration: mean(stats.successfulDurations),\n        })\n        trace.complete()\n      })\n\n      server.watcher.on('change', handleChange)\n      server.watcher.on('add', handleChange)\n      server.watcher.on('unlink', handleChange)\n\n      // call the watcherClosed method when watcher is closed or when process is stopped/killed\n      server.watcher.on('close', onClose)\n      process.on('SIGTERM', onClose)\n      process.on('SIGINT', onClose)\n\n      // Run initial extraction after server is ready\n      const startExtraction = () => {\n        setTimeout(() => {\n          // Notify about schema extraction enabled\n          output.info(logSymbols.info, 'Schema extraction enabled. Watching:')\n          for (const pattern of watchPatterns) {\n            output.info(`  - ${pattern}`)\n          }\n\n          // Perform first extraction\n          void runExtraction()\n        }, INITIAL_EXTRACTION_DELAY_MS)\n      }\n\n      if (server.httpServer) {\n        server.httpServer.once('listening', startExtraction)\n      } else {\n        // Middleware mode - no HTTP server, run extraction immediately\n        startExtraction()\n      }\n    },\n\n    async buildEnd() {\n      const trace = telemetryLogger?.trace(SchemaExtractedTrace)\n      trace?.start()\n\n      try {\n        const start = Date.now()\n        const schema = await extractSchema()\n        console.error(`âœ“ Extract schema (${Date.now() - start}ms)`)\n\n        trace?.log({\n          schemaAllTypesCount: schema.length,\n          schemaDocumentTypesCount: schema.filter((type) => type.type === 'document').length,\n          schemaTypesCount: schema.filter((type) => type.type === 'type').length,\n          enforceRequiredFields,\n          schemaFormat: format,\n        })\n      } catch (err) {\n        trace?.error(err)\n        throw err\n      } finally {\n        trace?.complete()\n      }\n    },\n  } satisfies Plugin\n}\n","import {existsSync} from 'node:fs'\nimport path from 'node:path'\n\nimport {type CliCommandContext} from '@sanity/cli'\nimport {\n  type GenerationResult,\n  runTypegenGenerate,\n  type TypeGenConfig,\n  TypegenWatchModeTrace,\n  TypesGeneratedTrace,\n} from '@sanity/codegen'\nimport {debounce, mean, once} from 'lodash-es'\nimport logSymbols from 'log-symbols'\nimport picomatch from 'picomatch'\nimport {type Plugin} from 'vite'\n\n/**\n * Default glob patterns to watch for query file changes.\n * Covers common source directory naming conventions.\n */\nconst DEFAULT_QUERY_PATTERNS = ['./src/**/*.{ts,tsx,js,jsx}', './app/**/*.{ts,tsx,js,jsx}']\n\n/** Default debounce delay in milliseconds */\nconst DEFAULT_DEBOUNCE_MS = 1000\n\n/**\n * Delay before initial generation to allow Vite to finish startup\n * and avoid race conditions with module resolution.\n */\nconst INITIAL_GENERATION_DELAY_MS = 1000\n\n/**\n * Options for the Sanity typegen Vite plugin.\n *\n * @internal\n */\nexport interface TypegenPluginOptions {\n  /**\n   * Working directory containing the Sanity configuration.\n   * This should be the root of your Sanity Studio project.\n   */\n  workDir: string\n\n  /**\n   * Typegen configuration from sanity.cli.ts.\n   * All fields are optional and will use sensible defaults.\n   */\n  config: Partial<TypeGenConfig>\n\n  /**\n   * Logger for output messages. Must implement `log`, `info`, and `error` methods.\n   * @defaultValue `console`\n   */\n  output?: Pick<Console, 'log' | 'info' | 'error'>\n\n  /**\n   * Telemetry logger for the Sanity CLI tooling.\n   */\n  telemetryLogger?: CliCommandContext['telemetry']\n}\n\n/**\n * Creates a Vite plugin that automatically generates TypeScript types during development and build.\n *\n * **During development:**\n * The plugin performs an initial generation when the dev server starts, then watches\n * for file changes and re-generates types when relevant files are modified.\n *\n * **During build:**\n * The plugin generates types once at the end of the build process.\n *\n * **Prerequisites:**\n * The schema.json file must exist before typegen can run. Run `sanity schema extract`\n * first to generate the schema file.\n *\n * @param options - Configuration options for the plugin\n * @returns A Vite plugin configured for typegen\n *\n * @internal\n */\nexport function sanityTypegenPlugin(options: TypegenPluginOptions): Plugin {\n  const {workDir, config: inputConfig, output = console, telemetryLogger} = options\n\n  // Apply defaults to config\n  const config: TypeGenConfig = {\n    schema: inputConfig.schema ?? 'schema.json',\n    generates: inputConfig.generates ?? 'sanity.types.ts',\n    path: inputConfig.path ?? DEFAULT_QUERY_PATTERNS,\n    overloadClientMethods: inputConfig.overloadClientMethods ?? false,\n    formatGeneratedCode: inputConfig.formatGeneratedCode ?? false,\n  }\n\n  // Build query patterns from config\n  const queryPatterns = Array.isArray(config.path) ? config.path : [config.path]\n\n  // Resolved after Vite config is available\n  let resolvedSchemaPath: string\n  let resolvedOutputPath: string\n\n  // State for concurrency control\n  let isGenerating = false\n  let pendingGeneration = false\n\n  // Stats for telemetry\n  const startTime = Date.now()\n  const stats: {successfulDurations: number[]; failedCount: number} = {\n    successfulDurations: [],\n    failedCount: 0,\n  }\n\n  /**\n   * Runs type generation with concurrency control.\n   * If generation is already running, queues one more generation to run after completion.\n   * Returns the generation result, or null if generation was skipped or failed.\n   */\n  async function runGeneration(isBuilding = false): Promise<GenerationResult | null> {\n    if (isGenerating) {\n      pendingGeneration = true\n      return null\n    }\n\n    isGenerating = true\n    pendingGeneration = false\n\n    const generationStartTime = Date.now()\n\n    try {\n      // Validate schema.json exists\n      if (!existsSync(resolvedSchemaPath)) {\n        output.error(\n          `${logSymbols.error} Schema file not found: ${config.schema}\\n` +\n            `Run \"sanity schema extract\" first to generate the schema file.`,\n        )\n        return null\n      }\n\n      const result = await runTypegenGenerate({\n        workDir,\n        config,\n      })\n\n      if (isBuilding) {\n        // Add newline for better formatting in build output\n        output.log('')\n      }\n\n      if (result.filesWithErrors > 0) {\n        output.log(\n          logSymbols.warning,\n          `Generated types to ${config.generates} (with errors in ${result.filesWithErrors} file${result.filesWithErrors === 1 ? '' : 's'})`,\n        )\n      } else {\n        output.log(logSymbols.success, `Generated types to ${config.generates}`)\n      }\n\n      // Track stats for telemetry (all completed generations count as successful)\n      stats.successfulDurations.push(Date.now() - generationStartTime)\n\n      return result\n    } catch (err) {\n      output.error(\n        `${logSymbols.error} Generation failed: ${err instanceof Error ? err.message : String(err)}`,\n      )\n      stats.failedCount++\n      return null\n    } finally {\n      isGenerating = false\n\n      // If a change came in during generation, run again\n      if (pendingGeneration) {\n        pendingGeneration = false\n        void runGeneration()\n      }\n    }\n  }\n\n  const debouncedGenerate = debounce(() => {\n    void runGeneration()\n  }, DEFAULT_DEBOUNCE_MS)\n\n  // Create a matcher function from query patterns\n  const isQueryMatch = picomatch(queryPatterns)\n\n  return {\n    name: 'sanity/typegen',\n\n    configResolved(viteConfig) {\n      // Resolve paths from options or Vite's project root\n      const rootDir = workDir ?? viteConfig.root\n\n      resolvedSchemaPath = path.isAbsolute(config.schema)\n        ? config.schema\n        : path.join(rootDir, config.schema)\n\n      resolvedOutputPath = path.isAbsolute(config.generates)\n        ? config.generates\n        : path.join(rootDir, config.generates)\n    },\n\n    configureServer(server) {\n      const trace = telemetryLogger?.trace(TypegenWatchModeTrace)\n      trace?.start()\n      trace?.log({step: 'started'})\n\n      // Build absolute patterns for query files\n      const absoluteQueryPatterns = queryPatterns.map((pattern) =>\n        path.isAbsolute(pattern) ? pattern : path.join(workDir, pattern),\n      )\n\n      // Add query patterns AND schema.json to Vite's watcher\n      server.watcher.add([...absoluteQueryPatterns, resolvedSchemaPath])\n\n      // Listen for file changes\n      const handleChange = (filePath: string) => {\n        const relativePath = path.isAbsolute(filePath) ? path.relative(workDir, filePath) : filePath\n\n        // Trigger on schema.json change OR matching query file\n        if (filePath === resolvedSchemaPath || isQueryMatch(relativePath)) {\n          debouncedGenerate()\n        }\n      }\n\n      // Prepare function to log \"stopped\" event to trace and complete the trace\n      const onClose = once(() => {\n        if (!trace) {\n          return\n        }\n        trace.log({\n          step: 'stopped',\n          watcherDuration: Date.now() - startTime,\n          generationSuccessfulCount: stats.successfulDurations.length,\n          generationFailedCount: stats.failedCount,\n          averageGenerationDuration: mean(stats.successfulDurations) || 0,\n        })\n        trace.complete()\n      })\n\n      server.watcher.on('change', handleChange)\n      server.watcher.on('add', handleChange)\n      server.watcher.on('unlink', handleChange)\n\n      // Call the onClose method when watcher is closed or when process is stopped/killed\n      server.watcher.on('close', onClose)\n      process.on('SIGTERM', onClose)\n      process.on('SIGINT', onClose)\n\n      // Run initial generation after server is ready\n      const startGeneration = () => {\n        setTimeout(() => {\n          // Notify about typegen enabled\n          output.info(logSymbols.info, 'Typegen enabled. Watching:')\n          for (const pattern of queryPatterns) {\n            output.info(`  - ${pattern}`)\n          }\n          output.info(`  - ${config.schema} (schema)`)\n\n          // Perform first generation\n          void runGeneration()\n        }, INITIAL_GENERATION_DELAY_MS)\n      }\n\n      if (server.httpServer) {\n        server.httpServer.once('listening', startGeneration)\n      } else {\n        // Middleware mode - no HTTP server, run generation immediately\n        startGeneration()\n      }\n    },\n\n    async buildEnd() {\n      // Build mode: One-time generation with telemetry tracking\n      const result = await runGeneration(true)\n\n      // Only log telemetry if generation completed successfully\n      if (result && telemetryLogger) {\n        const trace = telemetryLogger.trace(TypesGeneratedTrace)\n        trace.start()\n        trace.log({\n          outputSize: result.code.length,\n          queriesCount: result.queriesCount,\n          schemaTypesCount: result.schemaTypesCount,\n          queryFilesCount: result.queryFilesCount,\n          filesWithErrors: result.filesWithErrors,\n          typeNodesGenerated: result.typeNodesGenerated,\n          unknownTypeNodesGenerated: result.unknownTypeNodesGenerated,\n          unknownTypeNodesRatio:\n            result.typeNodesGenerated > 0\n              ? result.unknownTypeNodesGenerated / result.typeNodesGenerated\n              : 0,\n          emptyUnionTypeNodesGenerated: result.emptyUnionTypeNodesGenerated,\n          configOverloadClientMethods: config.overloadClientMethods ?? false,\n          configMethod: 'cli',\n        })\n        trace.complete()\n      }\n    },\n  } satisfies Plugin\n}\n","import path from 'node:path'\nimport {fileURLToPath} from 'node:url'\n\nimport {\n  type CliCommandContext,\n  type CliConfig,\n  type ReactCompilerConfig,\n  type UserViteConfig,\n} from '@sanity/cli'\nimport debug from 'debug'\nimport readPkgUp from 'read-pkg-up'\nimport {type ConfigEnv, type InlineConfig, type Rollup} from 'vite'\n\nimport {createExternalFromImportMap} from './createExternalFromImportMap'\nimport {\n  getAppEnvironmentVariables,\n  getStudioEnvironmentVariables,\n} from './getStudioEnvironmentVariables'\nimport {normalizeBasePath} from './helpers'\nimport {sanityBuildEntries} from './vite/plugin-sanity-build-entries'\nimport {sanityFaviconsPlugin} from './vite/plugin-sanity-favicons'\nimport {sanityRuntimeRewritePlugin} from './vite/plugin-sanity-runtime-rewrite'\nimport {sanitySchemaExtractionPlugin} from './vite/plugin-schema-extraction'\nimport {sanityTypegenPlugin} from './vite/plugin-typegen'\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url))\n\nexport interface ViteOptions {\n  /**\n   * Root path of the studio/sanity app\n   */\n  cwd: string\n\n  /**\n   * Base path (eg under where to serve the app - `/studio` or similar)\n   * Will be normalized to ensure it starts and ends with a `/`\n   */\n  basePath?: string\n\n  /**\n   * Output directory (eg where to place the built files, if any)\n   */\n  outputDir?: string\n\n  /**\n   * Whether or not to enable source maps\n   */\n  sourceMap?: boolean\n\n  /**\n   * Whether or not to minify the output (only used in `mode: 'production'`)\n   */\n  minify?: boolean\n\n  /**\n   * Schema extraction configuration\n   */\n  schemaExtraction?: CliConfig['schemaExtraction']\n\n  /**\n   * HTTP development server configuration\n   */\n  server?: {port?: number; host?: string}\n\n  /**\n   * Mode to run vite in - eg development or production\n   */\n  mode: 'development' | 'production'\n\n  importMap?: {imports?: Record<string, string>}\n  reactCompiler: ReactCompilerConfig | undefined\n  isApp?: boolean\n\n  /**\n   * Typegen configuration. When enabled, types are generated on startup\n   * and when query files or schema.json change.\n   */\n  typegen?: CliConfig['typegen'] & {enabled?: boolean}\n\n  /**\n   * Telemetry logger for tracking plugin usage\n   */\n  telemetryLogger?: CliCommandContext['telemetry']\n}\n\n/**\n * Get a configuration object for Vite based on the passed options\n *\n * @internal Only meant for consumption inside of Sanity modules, do not depend on this externally\n */\nexport async function getViteConfig(options: ViteOptions): Promise<InlineConfig> {\n  const {\n    cwd,\n    mode,\n    outputDir,\n    // default to `true` when `mode=development`\n    sourceMap = options.mode === 'development',\n    server,\n    minify,\n    basePath: rawBasePath = '/',\n    importMap,\n    reactCompiler,\n    isApp,\n    typegen,\n    telemetryLogger,\n    schemaExtraction,\n  } = options\n  const basePath = normalizeBasePath(rawBasePath)\n\n  const sanityPkgPath = (await readPkgUp({cwd: __dirname}))?.path\n  if (!sanityPkgPath) {\n    throw new Error('Unable to resolve `sanity` module root')\n  }\n\n  const customFaviconsPath = path.join(cwd, 'static')\n  const defaultFaviconsPath = path.join(path.dirname(sanityPkgPath), 'static', 'favicons')\n  const staticPath = `${basePath}static`\n\n  const {default: viteReact} = await import('@vitejs/plugin-react')\n\n  const envVars = isApp\n    ? getAppEnvironmentVariables({prefix: 'process.env.', jsonEncode: true})\n    : getStudioEnvironmentVariables({prefix: 'process.env.', jsonEncode: true})\n\n  const viteConfig: InlineConfig = {\n    // Define a custom cache directory so that sanity's vite cache\n    // does not conflict with any potential local vite projects\n    cacheDir: 'node_modules/.sanity/vite',\n    root: cwd,\n    base: basePath,\n    build: {\n      outDir: outputDir || path.resolve(cwd, 'dist'),\n      sourcemap: sourceMap,\n    },\n    server: {\n      host: server?.host,\n      port: server?.port || 3333,\n      // Only enable strict port for studio,\n      // since apps can run on any port\n      strictPort: isApp ? false : true,\n\n      /**\n       * Significantly speed up startup time,\n       * and most importantly eliminates the `new dependencies optimized: foobar. optimized dependencies changed. reloading`\n       * types of initial reload loops that otherwise happen as vite discovers deps that need to be optimized.\n       * This option starts the traversal up front, and warms up the dep tree required to render the userland sanity.config.ts file,\n       * and thus avoids frustrating reload loops.\n       */\n      warmup: {\n        clientFiles: ['./.sanity/runtime/app.js'],\n      },\n    },\n    configFile: false,\n    mode,\n    plugins: [\n      viteReact(\n        reactCompiler\n          ? {\n              babel: {\n                plugins: [['babel-plugin-react-compiler', reactCompiler]],\n                generatorOpts: {compact: true},\n              },\n            }\n          : {},\n      ),\n      sanityFaviconsPlugin({defaultFaviconsPath, customFaviconsPath, staticUrlPath: staticPath}),\n      sanityRuntimeRewritePlugin(),\n      sanityBuildEntries({basePath, cwd, importMap, isApp}),\n      // Add typegen plugin when enabled\n      ...(typegen?.enabled\n        ? [\n            sanityTypegenPlugin({\n              workDir: cwd,\n              config: typegen,\n              telemetryLogger,\n            }),\n          ]\n        : []),\n      // Add schema extraction when enabled\n      ...(schemaExtraction?.enabled\n        ? [\n            sanitySchemaExtractionPlugin({\n              workDir: cwd,\n              outputPath: schemaExtraction.path,\n              workspaceName: schemaExtraction.workspace,\n              additionalPatterns: schemaExtraction.watchPatterns,\n              enforceRequiredFields: schemaExtraction.enforceRequiredFields,\n              telemetryLogger: telemetryLogger,\n            }),\n          ]\n        : []),\n    ],\n    envPrefix: isApp ? 'SANITY_APP_' : 'SANITY_STUDIO_',\n    logLevel: mode === 'production' ? 'silent' : 'info',\n    resolve: {\n      dedupe: ['react', 'react-dom', 'sanity', 'styled-components'],\n    },\n    define: {\n      '__SANITY_STAGING__': process.env.SANITY_INTERNAL_ENV === 'staging',\n      '__SANITY_BUILD_TIMESTAMP__': JSON.stringify(Date.now()),\n      'process.env.PKG_BUILD_VERSION': JSON.stringify(process.env.PKG_BUILD_VERSION),\n      'process.env.MODE': JSON.stringify(mode),\n      /**\n       * Yes, double negatives are confusing.\n       * The default value of `SC_DISABLE_SPEEDY` is `process.env.NODE_ENV === 'production'`: https://github.com/styled-components/styled-components/blob/99c02f52d69e8e509c0bf012cadee7f8e819a6dd/packages/styled-components/src/constants.ts#L34\n       * Which means that in production, use the much faster way of inserting CSS rules, based on the CSSStyleSheet API (https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule)\n       * while in dev mode, use the slower way of inserting CSS rules, which appends text nodes to the `<style>` tag: https://github.com/styled-components/styled-components/blob/99c02f52d69e8e509c0bf012cadee7f8e819a6dd/packages/styled-components/src/sheet/Tag.ts#L74-L76\n       * There are historical reasons for this, primarily that browsers initially did not support editing CSS rules in the DevTools inspector if `CSSStyleSheet.insetRule` were used.\n       * However, that's no longer the case (since Chrome 81 back in April 2020: https://developer.chrome.com/docs/css-ui/css-in-js), the latest version of FireFox also supports it,\n       * and there is no longer any reason to use the much slower method in dev mode.\n       */\n      'process.env.SC_DISABLE_SPEEDY': JSON.stringify('false'),\n      ...envVars,\n    },\n  }\n\n  if (mode === 'production') {\n    viteConfig.build = {\n      ...viteConfig.build,\n\n      assetsDir: 'static',\n      minify: minify ? 'esbuild' : false,\n      emptyOutDir: false, // Rely on CLI to do this\n\n      rollupOptions: {\n        onwarn: onRollupWarn,\n        external: createExternalFromImportMap(importMap),\n        input: {\n          sanity: path.join(cwd, '.sanity', 'runtime', 'app.js'),\n        },\n      },\n    }\n  }\n\n  return viteConfig\n}\n\nfunction onRollupWarn(warning: Rollup.RollupLog, warn: Rollup.LoggingFunction) {\n  if (suppressUnusedImport(warning)) {\n    return\n  }\n\n  warn(warning)\n}\n\nfunction suppressUnusedImport(warning: Rollup.RollupLog & {ids?: string[]}): boolean {\n  if (warning.code !== 'UNUSED_EXTERNAL_IMPORT') return false\n\n  // Suppress:\n  // ```\n  // \"useDebugValue\" is imported from external module \"react\"â€¦\n  // ```\n  if (warning.names?.includes('useDebugValue')) {\n    warning.names = warning.names.filter((n) => n !== 'useDebugValue')\n    if (warning.names.length === 0) return true\n  }\n\n  // If some library does something unexpected, we suppress since it isn't actionable\n  if (warning.ids?.every((id) => id.includes('/node_modules/'))) return true\n\n  return false\n}\n\n/**\n * Ensure Sanity entry chunk is always loaded\n *\n * @param config - User-modified configuration\n * @returns Merged configuration\n * @internal\n */\nexport async function finalizeViteConfig(config: InlineConfig): Promise<InlineConfig> {\n  if (typeof config.build?.rollupOptions?.input !== 'object') {\n    throw new Error(\n      'Vite config must contain `build.rollupOptions.input`, and it must be an object',\n    )\n  }\n\n  if (!config.root) {\n    throw new Error(\n      'Vite config must contain `root` property, and must point to the Sanity root directory',\n    )\n  }\n\n  const {mergeConfig} = await import('vite')\n  return mergeConfig(config, {\n    build: {\n      rollupOptions: {\n        input: {\n          sanity: path.join(config.root, '.sanity', 'runtime', 'app.js'),\n        },\n      },\n    },\n  })\n}\n\n/**\n * Merge user-provided Vite configuration object or function\n *\n * @param defaultConfig - Default configuration object\n * @param userConfig - User-provided configuration object or function\n * @returns Merged configuration\n * @internal\n */\nexport async function extendViteConfigWithUserConfig(\n  env: ConfigEnv,\n  defaultConfig: InlineConfig,\n  userConfig: UserViteConfig,\n): Promise<InlineConfig> {\n  let config = defaultConfig\n\n  if (typeof userConfig === 'function') {\n    debug('Extending vite config using user-specified function')\n    config = await userConfig(config, env)\n  } else if (typeof userConfig === 'object') {\n    debug('Merging vite config using user-specified object')\n    const {mergeConfig} = await import('vite')\n    config = mergeConfig(config, userConfig)\n  }\n\n  return config\n}\n","/**\n * The import order here is significant.\n * The `import studioConfig from %STUDIO_CONFIG_LOCATION%` line should always come first,\n * otherwise it's impossible to setup tooling like React Scan which requires userland to import a dependency\n * _before_ any `import from 'react'` happens.\n */\nconst entryModule = `\n// This file is auto-generated on 'sanity dev'\n// Modifications to this file are automatically discarded\nimport studioConfig from %STUDIO_CONFIG_LOCATION%\nimport {renderStudio} from \"sanity\"\n\nrenderStudio(\n  document.getElementById(\"sanity\"),\n  studioConfig,\n  {reactStrictMode: %STUDIO_REACT_STRICT_MODE%, basePath: %STUDIO_BASE_PATH%}\n)\n`\n\nconst noConfigEntryModule = `\n// This file is auto-generated on 'sanity dev'\n// Modifications to this file are automatically discarded\nimport {renderStudio} from \"sanity\"\n\nconst studioConfig = {missingConfigFile: true}\n\nrenderStudio(\n  document.getElementById(\"sanity\"),\n  studioConfig,\n  {reactStrictMode: %STUDIO_REACT_STRICT_MODE%, basePath: %STUDIO_BASE_PATH%}\n)\n`\n\nconst appEntryModule = `\n// This file is auto-generated on 'sanity dev'\n// Modifications to this file are automatically discarded\nimport {createRoot} from 'react-dom/client'\nimport {createElement} from 'react'\nimport App from %ENTRY%\n\nconst root = createRoot(document.getElementById('root'))\nconst element = createElement(App)\nroot.render(element)\n`\n\nexport function getEntryModule(options: {\n  reactStrictMode: boolean\n  relativeConfigLocation: string | null\n  basePath?: string\n  entry?: string\n  isApp?: boolean\n}): string {\n  const {reactStrictMode, relativeConfigLocation, basePath, entry, isApp} = options\n\n  if (isApp) {\n    return appEntryModule.replace(/%ENTRY%/, JSON.stringify(entry || './src/App'))\n  }\n\n  const sourceModule = relativeConfigLocation ? entryModule : noConfigEntryModule\n\n  return sourceModule\n    .replace(/%STUDIO_REACT_STRICT_MODE%/, JSON.stringify(Boolean(reactStrictMode)))\n    .replace(/%STUDIO_CONFIG_LOCATION%/, JSON.stringify(relativeConfigLocation))\n    .replace(/%STUDIO_BASE_PATH%/, JSON.stringify(basePath || '/'))\n}\n","import fs from 'node:fs/promises'\nimport path from 'node:path'\n\nimport {debug as serverDebug} from './debug'\n\nconst debug = serverDebug.extend('config')\n\n/**\n * Resolves the path to the studio configuration file with the following extensions,\n * in preferred order: '.mjs', '.js', '.ts', '.jsx', '.tsx' (aligns with vite)\n *\n * Falls back to the default studio configuration exported by `sanity` if none is found\n *\n * @internal\n */\nexport async function getSanityStudioConfigPath(studioRootPath: string): Promise<string | null> {\n  const configPaths = [\n    path.join(studioRootPath, 'sanity.config.mjs'),\n    path.join(studioRootPath, 'sanity.config.js'),\n    path.join(studioRootPath, 'sanity.config.ts'),\n    path.join(studioRootPath, 'sanity.config.jsx'),\n    path.join(studioRootPath, 'sanity.config.tsx'),\n  ]\n\n  debug('Looking for configuration file in %d possible locations', configPaths.length)\n  const configs = await Promise.all(\n    configPaths.map(async (configPath) => ({\n      path: configPath,\n      exists: await fileExists(configPath),\n    })),\n  )\n\n  const availableConfigs = configs.filter((config) => config.exists)\n  debug('Found %d available configuration files', availableConfigs.length)\n\n  // No config file exists?\n  if (availableConfigs.length === 0) {\n    console.warn('No `sanity.config.js`/`sanity.config.ts` found - using default studio config')\n    return null\n  }\n\n  if (availableConfigs.length > 1) {\n    console.warn('Found multiple potential studio configs:')\n    availableConfigs.forEach((config) => console.warn(` - ${config.path}`))\n    console.warn(`Using ${availableConfigs[0].path}`)\n  }\n\n  return availableConfigs[0].path\n}\n\n/**\n * Asynchronously checks if a file exists. This is prone to race conditions,\n * as the file can exist/not exist by the time this resolves, but in this\n * case this is an acceptable trade-off. Best effort, and all that.\n */\nfunction fileExists(filePath: string): Promise<boolean> {\n  return fs.stat(filePath).then(\n    () => true,\n    () => false,\n  )\n}\n","import fs from 'node:fs/promises'\nimport path from 'node:path'\n\nimport chokidar from 'chokidar'\n\nimport {debug as serverDebug} from './debug'\nimport {getEntryModule} from './getEntryModule'\nimport {\n  decorateIndexWithAutoGeneratedWarning,\n  decorateIndexWithBridgeScript,\n  getPossibleDocumentComponentLocations,\n  renderDocument,\n} from './renderDocument'\nimport {getSanityStudioConfigPath} from './sanityConfig'\n\nconst debug = serverDebug.extend('runtime')\n\n/**\n * Converts path separators to forward slashes for ESM imports.\n * @internal\n */\nexport function toForwardSlashes(filePath: string): string {\n  return filePath.replace(/\\\\/g, '/')\n}\n\nexport interface RuntimeOptions {\n  cwd: string\n  reactStrictMode: boolean\n  watch: boolean\n  basePath?: string\n  entry?: string\n  isApp?: boolean\n}\n\n/**\n * Generates the `.sanity/runtime` directory, and optionally watches for custom\n * document files, rebuilding when they change\n *\n * @param options - Current working directory (Sanity root dir), and whether or not to watch\n * @internal\n */\nexport async function writeSanityRuntime({\n  cwd,\n  reactStrictMode,\n  watch,\n  basePath,\n  entry,\n  isApp,\n}: RuntimeOptions): Promise<void> {\n  debug('Making runtime directory')\n  const runtimeDir = path.join(cwd, '.sanity', 'runtime')\n  await fs.mkdir(runtimeDir, {recursive: true})\n\n  async function renderAndWriteDocument() {\n    debug('Rendering document template')\n    const indexHtml = decorateIndexWithBridgeScript(\n      decorateIndexWithAutoGeneratedWarning(\n        await renderDocument({\n          studioRootPath: cwd,\n          props: {\n            entryPath: `/${toForwardSlashes(path.relative(cwd, path.join(runtimeDir, 'app.js')))}`,\n            basePath: basePath || '/',\n          },\n          isApp,\n        }),\n      ),\n    )\n\n    debug('Writing index.html to runtime directory')\n    await fs.writeFile(path.join(runtimeDir, 'index.html'), indexHtml)\n  }\n\n  if (watch) {\n    chokidar\n      .watch(getPossibleDocumentComponentLocations(cwd))\n      .on('all', () => renderAndWriteDocument())\n  }\n\n  await renderAndWriteDocument()\n\n  debug('Writing app.js to runtime directory')\n  let relativeConfigLocation: string | null = null\n  if (!isApp) {\n    const studioConfigPath = await getSanityStudioConfigPath(cwd)\n    relativeConfigLocation = studioConfigPath\n      ? toForwardSlashes(path.relative(runtimeDir, studioConfigPath))\n      : null\n  }\n\n  const relativeEntry = toForwardSlashes(\n    path.relative(runtimeDir, path.resolve(cwd, entry || './src/App')),\n  )\n  const appJsContent = getEntryModule({\n    reactStrictMode,\n    relativeConfigLocation,\n    basePath,\n    entry: relativeEntry,\n    isApp,\n  })\n  await fs.writeFile(path.join(runtimeDir, 'app.js'), appJsContent)\n}\n"],"names":["debug","debugIt","createExternalFromImportMap","imports","Object","keys","map","specifier","endsWith","RegExp","escapeRegExp","normalizeBasePath","pathName","replace","Favicons","$","_c","t0","Symbol","for","errorHandlerScript","GlobalErrorHandler","__html","NoJsStyles","NoJavascript","t1","t2","EMPTY_ARRAY","BasicDocument","props","entryPath","css","undefined","t3","t4","t5","t6","t7","t8","_temp","t9","t10","t11","t12","t13","t14","href","globalStyles","DefaultDocument","t15","TIMESTAMPED_IMPORTMAP_INJECTOR_SCRIPT","__filename","fileURLToPath","import","url","path","dirname","serverDebug","extend","useThreads","process","env","JEST_WORKER_ID","hasWarnedAbout","Set","defaultProps","autoGeneratedWarning","trim","renderDocument","options","Promise","resolve","reject","getDocumentHtml","studioRootPath","importMap","isApp","worker","Worker","execArgv","workerData","dev","shouldWarn","on","msg","type","has","warnKey","Array","isArray","message","forEach","warning","console","warn","chalk","yellow","add","error","Error","html","length","err","code","decorateIndexWithAutoGeneratedWarning","template","decorateIndexWithBridgeScript","scriptURL","SANITY_INTERNAL_ENV","getPossibleDocumentComponentLocations","join","_prefixUrlWithBasePath","basePath","normalizedBasePath","startsWith","slice","isMainThread","parentPort","renderDocumentFromWorkerData","global","__DEV__","postMessage","version","register","unregister","target","supported","jsx","extensions","format","unregisterJs","loader","Document","getDocumentComponent","URL","toString","addTimestampedImportMapScriptToHtml","renderToStaticMarkup","root","parseHtml","htmlEl","querySelector","oldRoot","appendChild","headEl","insertAdjacentHTML","JSON","stringify","outerHTML","userDefined","tryLoadDocumentComponent","DocumentComp","component","default","userExports","relativePath","relative","cwd","typeHint","modified","locations","componentPath","importFresh","Math","floor","fs","statSync","mtimeMs","entryChunkId","sanityBuildEntries","name","apply","buildStart","emitFile","id","generateBundle","_options","outputBundle","bundle","entryFile","values","find","file","facadeModuleId","entryFileName","fileName","viteMetadata","importedCss","key","entry","push","source","generateWebManifest","icons","src","sizes","mimeTypes","sanityFaviconsPlugin","defaultFaviconsPath","customFaviconsPath","staticUrlPath","cache","getFavicons","favicons","readdir","hasCustomFavicon","access","configureServer","viteDevServer","webManifest","webManifestPath","middlewares","use","req","res","next","writeHead","write","end","_parsedUrl","pathname","basename","includes","faviconPath","mimeType","extname","readFile","sanityRuntimeRewritePlugin","DEFAULT_SCHEMA_PATTERNS","DEFAULT_DEBOUNCE_MS","INITIAL_EXTRACTION_DELAY_MS","sanitySchemaExtractionPlugin","workDir","workDirOption","outputPath","outputPathOption","output","workspaceName","additionalPatterns","debounceMs","enforceRequiredFields","telemetryLogger","watchPatterns","resolvedWorkDir","resolvedOutputPath","isExtracting","pendingExtraction","startTime","Date","now","stats","successfulDurations","failedCount","extractSchema","extractSchemaToFile","runExtraction","isBuilding","extractionStartTime","log","logSymbols","success","String","SchemaExtractionError","validation","formatSchemaValidation","debouncedExtract","debounce","isMatch","picomatch","configResolved","config","isAbsolute","server","trace","SchemaExtractionWatchModeTrace","start","step","schemaFormat","absolutePatterns","pattern","watcher","handleChange","filePath","onClose","once","watcherDuration","extractionSuccessfulCount","extractionFailedCount","averageExtractionDuration","mean","complete","startExtraction","setTimeout","info","httpServer","buildEnd","SchemaExtractedTrace","schema","schemaAllTypesCount","schemaDocumentTypesCount","filter","schemaTypesCount","DEFAULT_QUERY_PATTERNS","INITIAL_GENERATION_DELAY_MS","sanityTypegenPlugin","inputConfig","generates","overloadClientMethods","formatGeneratedCode","queryPatterns","resolvedSchemaPath","isGenerating","pendingGeneration","runGeneration","generationStartTime","existsSync","result","runTypegenGenerate","filesWithErrors","debouncedGenerate","isQueryMatch","viteConfig","rootDir","TypegenWatchModeTrace","absoluteQueryPatterns","generationSuccessfulCount","generationFailedCount","averageGenerationDuration","startGeneration","TypesGeneratedTrace","outputSize","queriesCount","queryFilesCount","typeNodesGenerated","unknownTypeNodesGenerated","unknownTypeNodesRatio","emptyUnionTypeNodesGenerated","configOverloadClientMethods","configMethod","__dirname","getViteConfig","mode","outputDir","sourceMap","minify","rawBasePath","reactCompiler","typegen","schemaExtraction","sanityPkgPath","readPkgUp","staticPath","viteReact","envVars","getAppEnvironmentVariables","prefix","jsonEncode","getStudioEnvironmentVariables","cacheDir","base","build","outDir","sourcemap","host","port","strictPort","warmup","clientFiles","configFile","plugins","babel","generatorOpts","compact","enabled","workspace","envPrefix","logLevel","dedupe","define","PKG_BUILD_VERSION","assetsDir","emptyOutDir","rollupOptions","onwarn","onRollupWarn","external","input","sanity","suppressUnusedImport","names","n","ids","every","finalizeViteConfig","mergeConfig","extendViteConfigWithUserConfig","defaultConfig","userConfig","entryModule","noConfigEntryModule","appEntryModule","getEntryModule","reactStrictMode","relativeConfigLocation","Boolean","getSanityStudioConfigPath","configPaths","availableConfigs","all","configPath","exists","fileExists","stat","then","toForwardSlashes","writeSanityRuntime","watch","runtimeDir","mkdir","recursive","renderAndWriteDocument","indexHtml","writeFile","chokidar","studioConfigPath","relativeEntry","appJsContent"],"mappings":"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"}