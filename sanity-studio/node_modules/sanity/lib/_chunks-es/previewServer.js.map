{"version":3,"file":"previewServer.js","sources":["../../src/_internal/cli/server/buildStaticFiles.ts","../../src/_internal/cli/server/vite/plugin-sanity-basepath-redirect.ts","../../src/_internal/cli/server/previewServer.ts"],"sourcesContent":["import {constants as fsConstants} from 'node:fs'\nimport fs from 'node:fs/promises'\nimport path from 'node:path'\nimport {fileURLToPath} from 'node:url'\n\nimport {\n  type CliCommandContext,\n  type CliConfig,\n  type ReactCompilerConfig,\n  type UserViteConfig,\n} from '@sanity/cli'\nimport readPkgUp from 'read-pkg-up'\n\nimport {debug as serverDebug} from './debug'\nimport {\n  extendViteConfigWithUserConfig,\n  finalizeViteConfig,\n  getViteConfig,\n  type ViteOptions,\n} from './getViteConfig'\nimport {writeSanityRuntime} from './runtime'\nimport {generateWebManifest} from './webManifest'\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url))\n\nconst debug = serverDebug.extend('static')\n\nexport interface ChunkModule {\n  name: string\n  originalLength: number\n  renderedLength: number\n}\n\nexport interface ChunkStats {\n  name: string\n  modules: ChunkModule[]\n}\n\nexport interface StaticBuildOptions {\n  cwd: string\n  basePath: string\n  outputDir: string\n  minify?: boolean\n  profile?: boolean\n  sourceMap?: boolean\n  importMap?: {imports?: Record<string, string>}\n\n  vite?: UserViteConfig\n  reactCompiler: ReactCompilerConfig | undefined\n  entry?: string\n  isApp?: boolean\n\n  /**\n   * Typegen configuration. When enabled, types are generated during build.\n   */\n  typegen?: CliConfig['typegen'] & {enabled?: boolean}\n\n  /**\n   * Telemetry logger for tracking plugin usage\n   */\n  telemetryLogger?: CliCommandContext['telemetry']\n\n  /** Schema extraction options */\n  schemaExtraction?: ViteOptions['schemaExtraction']\n}\n\nexport async function buildStaticFiles(\n  options: StaticBuildOptions,\n): Promise<{chunks: ChunkStats[]}> {\n  const {\n    cwd,\n    outputDir,\n    sourceMap = false,\n    minify = true,\n    basePath,\n    vite: extendViteConfig,\n    importMap,\n    reactCompiler,\n    entry,\n    isApp,\n    telemetryLogger,\n    schemaExtraction,\n  } = options\n\n  debug('Writing Sanity runtime files')\n  await writeSanityRuntime({\n    cwd,\n    reactStrictMode: false,\n    watch: false,\n    basePath,\n    entry,\n    isApp,\n  })\n\n  debug('Resolving vite config')\n  const mode = 'production'\n  let viteConfig = await getViteConfig({\n    cwd,\n    basePath,\n    outputDir,\n    minify,\n    sourceMap,\n    mode,\n    importMap,\n    reactCompiler,\n    isApp,\n    telemetryLogger,\n    schemaExtraction,\n  })\n\n  // Extend Vite configuration with user-provided config\n  if (extendViteConfig) {\n    viteConfig = await extendViteConfigWithUserConfig(\n      {command: 'build', mode},\n      viteConfig,\n      extendViteConfig,\n    )\n    viteConfig = await finalizeViteConfig(viteConfig)\n  }\n\n  // Copy files placed in /static to the built /static\n  debug('Copying static files from /static to output dir')\n  const staticPath = path.join(outputDir, 'static')\n  await copyDir(path.join(cwd, 'static'), staticPath)\n\n  // Write favicons, not overwriting ones that already exist, to static folder\n  debug('Writing favicons to output dir')\n  const faviconBasePath = `${basePath.replace(/\\/+$/, '')}/static`\n  await writeFavicons(faviconBasePath, staticPath)\n\n  debug('Bundling using vite')\n  const {build} = await import('vite')\n  const bundle = await build(viteConfig)\n  debug('Bundling complete')\n\n  // For typescript only - this shouldn't ever be the case given we're not watching\n  if (Array.isArray(bundle) || !('output' in bundle)) {\n    return {chunks: []}\n  }\n\n  const stats: ChunkStats[] = []\n  bundle.output.forEach((chunk) => {\n    if (chunk.type !== 'chunk') {\n      return\n    }\n\n    stats.push({\n      name: chunk.name,\n      modules: Object.entries(chunk.modules).map(([rawFilePath, chunkModule]) => {\n        const filePath = rawFilePath.startsWith('\\x00')\n          ? rawFilePath.slice('\\x00'.length)\n          : rawFilePath\n\n        return {\n          name: path.isAbsolute(filePath) ? path.relative(cwd, filePath) : filePath,\n          originalLength: chunkModule.originalLength,\n          renderedLength: chunkModule.renderedLength,\n        }\n      }),\n    })\n  })\n\n  return {chunks: stats}\n}\n\nasync function copyDir(srcDir: string, destDir: string, skipExisting?: boolean): Promise<void> {\n  await fs.mkdir(destDir, {recursive: true})\n\n  for (const file of await tryReadDir(srcDir)) {\n    const srcFile = path.resolve(srcDir, file)\n    if (srcFile === destDir) {\n      continue\n    }\n\n    const destFile = path.resolve(destDir, file)\n    const stat = await fs.stat(srcFile)\n\n    if (stat.isDirectory()) {\n      await copyDir(srcFile, destFile, skipExisting)\n    } else if (skipExisting) {\n      await fs.copyFile(srcFile, destFile, fsConstants.COPYFILE_EXCL).catch(skipIfExistsError)\n    } else {\n      await fs.copyFile(srcFile, destFile)\n    }\n  }\n}\n\nasync function tryReadDir(dir: string): Promise<string[]> {\n  try {\n    const content = await fs.readdir(dir)\n    return content\n  } catch (err) {\n    if (err.code === 'ENOENT') {\n      return []\n    }\n\n    throw err\n  }\n}\n\nfunction skipIfExistsError(err: Error & {code: string}) {\n  if (err.code === 'EEXIST') {\n    return\n  }\n\n  throw err\n}\n\nasync function writeFavicons(basePath: string, destDir: string): Promise<void> {\n  const sanityPkgPath = (await readPkgUp({cwd: __dirname}))?.path\n  const faviconsPath = sanityPkgPath\n    ? path.join(path.dirname(sanityPkgPath), 'static', 'favicons')\n    : undefined\n\n  if (!faviconsPath) {\n    throw new Error('Unable to resolve `sanity` module root')\n  }\n\n  await fs.mkdir(destDir, {recursive: true})\n  await copyDir(faviconsPath, destDir, true)\n  await writeWebManifest(basePath, destDir)\n\n  // Copy the /static/favicon.ico to /favicon.ico as well, because some tools/browsers\n  // blindly expects it to be there before requesting the HTML containing the actual path\n  await fs.copyFile(path.join(destDir, 'favicon.ico'), path.join(destDir, '..', 'favicon.ico'))\n}\n\nasync function writeWebManifest(basePath: string, destDir: string): Promise<void> {\n  const content = JSON.stringify(generateWebManifest(basePath), null, 2)\n  await fs\n    .writeFile(path.join(destDir, 'manifest.webmanifest'), content, 'utf8')\n    .catch(skipIfExistsError)\n}\n","import {type Plugin} from 'vite'\n\nexport function sanityBasePathRedirectPlugin(basePath: string | undefined): Plugin {\n  return {\n    name: 'sanity/server/sanity-base-path-redirect',\n    apply: 'serve',\n    configurePreviewServer(vitePreviewServer) {\n      return () => {\n        if (!basePath) {\n          return\n        }\n\n        vitePreviewServer.middlewares.use((req, res, next) => {\n          if (req.url !== '/') {\n            next()\n            return\n          }\n\n          res.writeHead(302, {Location: basePath})\n          res.end()\n        })\n      }\n    },\n  }\n}\n","import fs from 'node:fs/promises'\nimport path from 'node:path'\n\nimport {type UserViteConfig} from '@sanity/cli'\nimport chalk from 'chalk'\nimport {type InlineConfig, version} from 'vite'\n\nimport {debug as serverDebug} from './debug'\nimport {extendViteConfigWithUserConfig} from './getViteConfig'\nimport {sanityBasePathRedirectPlugin} from './vite/plugin-sanity-basepath-redirect'\n\nconst debug = serverDebug.extend('preview')\n\nexport interface PreviewServer {\n  urls: {local: string[]; network: string[]}\n  close(): Promise<void>\n}\n\nexport interface PreviewServerOptions {\n  root: string\n  cwd: string\n\n  httpPort: number\n  httpHost?: string\n\n  vite?: UserViteConfig\n  isApp?: boolean\n}\n\nexport async function startPreviewServer(options: PreviewServerOptions): Promise<PreviewServer> {\n  const {httpPort, httpHost, root, vite: extendViteConfig, isApp} = options\n  const startTime = Date.now()\n\n  const indexPath = path.join(root, 'index.html')\n  let basePath: string | undefined\n  try {\n    const index = await fs.readFile(indexPath, 'utf8')\n    basePath = tryResolveBasePathFromIndex(index)\n  } catch (err) {\n    if (err.code !== 'ENOENT') {\n      throw err\n    }\n\n    const error = new Error(\n      `Could not find a production build in the '${root}' directory.\\nTry building your ${isApp ? 'application' : 'studio '}app with 'sanity build' before starting the preview server.`,\n    )\n    error.name = 'BUILD_NOT_FOUND'\n    throw error\n  }\n\n  const mode = 'production'\n  let previewConfig: InlineConfig = {\n    root,\n    base: basePath || '/',\n    plugins: [sanityBasePathRedirectPlugin(basePath)],\n    configFile: false,\n    preview: {\n      port: httpPort,\n      host: httpHost,\n      strictPort: true,\n    },\n    // Needed for vite to not serve `root/dist`\n    build: {\n      outDir: root,\n    },\n    mode,\n  }\n\n  // Extend Vite configuration with user-provided config\n  if (extendViteConfig) {\n    previewConfig = await extendViteConfigWithUserConfig(\n      {command: 'serve', mode},\n      previewConfig,\n      extendViteConfig,\n    )\n  }\n\n  debug('Creating vite server')\n  const {preview} = await import('vite')\n  const server = await preview(previewConfig)\n  const warn = server.config.logger.warn\n  const info = server.config.logger.info\n  const url = server.resolvedUrls!.local[0]\n\n  if (typeof basePath === 'undefined') {\n    warn('Could not determine base path from index.html, using \"/\" as default')\n  } else if (basePath && basePath !== '/') {\n    info(`Using resolved base path from static build: ${chalk.cyan(basePath)}`)\n  }\n\n  const startupDuration = Date.now() - startTime\n\n  info(\n    `Sanity ${isApp ? 'application' : 'Studio'} ` +\n      `using ${chalk.cyan(`vite@${version}`)} ` +\n      `ready in ${chalk.cyan(`${Math.ceil(startupDuration)}ms`)} ` +\n      `and running at ${chalk.cyan(url)} (production preview mode)`,\n  )\n\n  return {\n    urls: server.resolvedUrls!,\n    close: () =>\n      new Promise((resolve, reject) =>\n        server.httpServer.close((err) => (err ? reject(err) : resolve())),\n      ),\n  }\n}\n\nfunction tryResolveBasePathFromIndex(index: string): string | undefined {\n  // <script ... src=\"/some-base-path/static/sanity-a3cc3d86.js\"></script>\n  const basePath = index.match(/<script[^>]+src=\"(.*?)\\/static\\/sanity-/)?.[1]\n\n  // We _expect_ to be able to find the base path. If we can't, we should warn.\n  // Note that we're checking for `undefined` here, since an empty string is a\n  // valid base path.\n  if (typeof basePath === 'undefined') {\n    return undefined\n  }\n\n  // In the case of an empty base path, we still want to return `/` to indicate\n  // that we _found_ the basepath - it just happens to be empty. Eg:\n  // <script ... src = \"/static/sanity-a3cc3d86.js\"></script>\n  // Which differs from not being able to find the script tag at all, in which\n  // case we'll want to show a warning to indicate that it is an abnormality.\n  return basePath === '' ? '/' : basePath\n}\n"],"names":["__dirname","path","dirname","fileURLToPath","import","url","debug","serverDebug","extend","buildStaticFiles","options","cwd","outputDir","sourceMap","minify","basePath","vite","extendViteConfig","importMap","reactCompiler","entry","isApp","telemetryLogger","schemaExtraction","writeSanityRuntime","reactStrictMode","watch","mode","viteConfig","getViteConfig","extendViteConfigWithUserConfig","command","finalizeViteConfig","staticPath","join","copyDir","faviconBasePath","replace","writeFavicons","build","bundle","Array","isArray","chunks","stats","output","forEach","chunk","type","push","name","modules","Object","entries","map","rawFilePath","chunkModule","filePath","startsWith","slice","isAbsolute","relative","originalLength","renderedLength","srcDir","destDir","skipExisting","fs","mkdir","recursive","file","tryReadDir","srcFile","resolve","destFile","stat","isDirectory","copyFile","fsConstants","COPYFILE_EXCL","catch","skipIfExistsError","dir","readdir","err","code","sanityPkgPath","readPkgUp","faviconsPath","undefined","Error","writeWebManifest","content","JSON","stringify","generateWebManifest","writeFile","sanityBasePathRedirectPlugin","apply","configurePreviewServer","vitePreviewServer","middlewares","use","req","res","next","writeHead","Location","end","startPreviewServer","httpPort","httpHost","root","startTime","Date","now","indexPath","index","readFile","tryResolveBasePathFromIndex","error","previewConfig","base","plugins","configFile","preview","port","host","strictPort","outDir","server","warn","config","logger","info","resolvedUrls","local","chalk","cyan","startupDuration","version","Math","ceil","urls","close","Promise","reject","httpServer","match"],"mappings":"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"}