{"version":3,"file":"devAction2.js","sources":["../../src/_internal/cli/server/devServer.ts","../../src/_internal/cli/actions/dev/devAction.ts"],"sourcesContent":["import {\n  type CliCommandContext,\n  type CliConfig,\n  type ReactCompilerConfig,\n  type UserViteConfig,\n} from '@sanity/cli'\nimport {type ViteDevServer} from 'vite'\n\nimport {debug} from './debug'\nimport {extendViteConfigWithUserConfig, getViteConfig, type ViteOptions} from './getViteConfig'\nimport {writeSanityRuntime} from './runtime'\n\nexport interface SchemaExtractionOptions {\n  enabled: boolean\n  outputPath?: string\n  workspaceName?: string\n}\n\nexport interface DevServerOptions {\n  cwd: string\n  basePath: string\n  staticPath: string\n\n  httpPort: number\n  httpHost?: string\n  projectName?: string\n\n  reactStrictMode: boolean\n  reactCompiler: ReactCompilerConfig | undefined\n  vite?: UserViteConfig\n  entry?: string\n  isApp?: boolean\n\n  /**\n   * Typegen configuration. When enabled, types are generated on startup\n   * and when query files or schema.json change.\n   */\n  typegen?: CliConfig['typegen'] & {enabled?: boolean}\n\n  /**\n   * Telemetry logger for tracking plugin usage\n   */\n  telemetryLogger?: CliCommandContext['telemetry']\n\n  /** Schema extraction options */\n  schemaExtraction?: ViteOptions['schemaExtraction']\n}\n\nexport interface DevServer {\n  server: ViteDevServer\n  close(): Promise<void>\n}\n\nexport async function startDevServer(options: DevServerOptions): Promise<DevServer> {\n  const {\n    cwd,\n    httpPort,\n    httpHost,\n    basePath,\n    reactStrictMode,\n    vite: extendViteConfig,\n    reactCompiler,\n    entry,\n    isApp,\n    typegen,\n    telemetryLogger,\n    schemaExtraction,\n  } = options\n\n  debug('Writing Sanity runtime files')\n  await writeSanityRuntime({cwd, reactStrictMode, watch: true, basePath, entry, isApp})\n\n  debug('Resolving vite config')\n  const mode = 'development'\n\n  let viteConfig = await getViteConfig({\n    basePath,\n    mode: 'development',\n    server: {port: httpPort, host: httpHost},\n    cwd,\n    reactCompiler,\n    isApp,\n    typegen,\n    telemetryLogger,\n    schemaExtraction,\n  })\n\n  // Extend Vite configuration with user-provided config\n  if (extendViteConfig) {\n    viteConfig = await extendViteConfigWithUserConfig(\n      {command: 'serve', mode},\n      viteConfig,\n      extendViteConfig,\n    )\n  }\n\n  debug('Creating vite server')\n  const {createServer} = await import('vite')\n  const server = await createServer(viteConfig)\n\n  debug('Listening on specified port')\n  await server.listen()\n\n  return {\n    server,\n    close: () => server.close(),\n  }\n}\n","/* eslint-disable max-statements */\nimport path from 'node:path'\n\nimport {\n  type CliCommandArguments,\n  type CliCommandContext,\n  type CliConfig,\n  type CliOutputter,\n} from '@sanity/cli'\nimport {type SanityProject} from '@sanity/client'\nimport chalk from 'chalk'\nimport logSymbols from 'log-symbols'\nimport semver from 'semver'\nimport {version} from 'vite'\nimport {hideBin} from 'yargs/helpers'\nimport yargs from 'yargs/yargs'\n\nimport {debug as debugIt} from '../../debug'\nimport {type DevServerOptions, startDevServer} from '../../server/devServer'\nimport {checkRequiredDependencies} from '../../util/checkRequiredDependencies'\nimport {checkStudioDependencyVersions} from '../../util/checkStudioDependencyVersions'\nimport {compareDependencyVersions} from '../../util/compareDependencyVersions'\nimport {getAppId} from '../../util/getAppId'\nimport {isInteractive} from '../../util/isInteractive'\nimport {getPackageManagerChoice} from '../../util/packageManager/packageManagerChoice'\nimport {upgradePackages} from '../../util/packageManager/upgradePackages'\nimport {getSharedServerConfig, gracefulServerDeath} from '../../util/servers'\nimport {shouldAutoUpdate} from '../../util/shouldAutoUpdate'\nimport {getTimer} from '../../util/timing'\n\nexport interface StartDevServerCommandFlags {\n  'host'?: string\n  'port'?: string\n  'load-in-dashboard'?: boolean\n  'auto-updates'?: boolean\n  'force'?: boolean\n}\n\nconst debug = debugIt.extend('dev')\n\nconst baseUrl =\n  process.env.SANITY_INTERNAL_ENV === 'staging' ? 'https://sanity.work' : 'https://sanity.io'\n\nconst getDefaultDashboardURL = ({\n  organizationId,\n  url,\n}: {\n  organizationId: string\n  url: string\n}): string => {\n  return `${baseUrl}/@${organizationId}?${new URLSearchParams({\n    dev: url,\n  }).toString()}`\n}\n\nexport const getDashboardURL = async ({\n  fetchFn = globalThis.fetch,\n  timeout = 5000,\n  organizationId,\n  url,\n}: {\n  fetchFn?: typeof globalThis.fetch\n  timeout?: number\n  organizationId: string\n  url: string\n}): Promise<string> => {\n  const abortController = new AbortController()\n  // Wait for 5 seconds before aborting the request\n  const timer = setTimeout(() => abortController.abort(), timeout)\n  try {\n    const queryParams = new URLSearchParams({\n      organizationId,\n      url,\n    })\n\n    const res = await fetchFn(\n      `${baseUrl}/api/dashboard/mode/development/resolve-url?${queryParams.toString()}`,\n      {\n        signal: abortController.signal,\n      },\n    )\n\n    if (!res.ok) {\n      debug(`Failed to fetch dashboard URL: ${res.statusText}`)\n      return getDefaultDashboardURL({organizationId, url})\n    }\n\n    const body = await res.json()\n    return body.url\n  } catch (err) {\n    debug(`Failed to fetch dashboard URL: ${err.message}`)\n    return getDefaultDashboardURL({organizationId, url})\n  } finally {\n    clearTimeout(timer)\n  }\n}\n\n/**\n * Gets the dashboard URL from API or uses the default dashboard URL\n */\nexport const getDashboardAppURL = async ({\n  organizationId,\n  httpHost = 'localhost',\n  httpPort = 3333,\n}: {\n  organizationId: string\n  httpHost?: string\n  httpPort?: number\n}): Promise<string> => {\n  const url = await getDashboardURL({\n    organizationId,\n    url: `http://${httpHost}:${httpPort}`,\n  })\n\n  // <dashboard-app-url>/<orgniazationId>?dev=<dev-server-url>\n  return url\n}\n\nfunction parseCliFlags(args: {argv?: string[]}) {\n  // Using slice(1) to remove the first argument, which is the command `dev` path to the CLI\n  return yargs(hideBin(args.argv || process.argv).slice(1))\n    .options('host', {type: 'string'})\n    .options('port', {type: 'number'})\n    .options('auto-updates', {type: 'boolean'})\n    .option('load-in-dashboard', {type: 'boolean', default: false}).argv\n}\n\nexport default async function startSanityDevServer(\n  args: CliCommandArguments<StartDevServerCommandFlags>,\n  context: CliCommandContext,\n): Promise<void> {\n  const timers = getTimer()\n  const flags = await parseCliFlags(args)\n  const {output, apiClient, workDir, cliConfig, prompt, cliConfigPath, telemetry} = context\n\n  const {loadInDashboard} = flags\n\n  timers.start('checkStudioDependencyVersions')\n  await checkStudioDependencyVersions(workDir)\n  timers.end('checkStudioDependencyVersions')\n\n  // If the check resulted in a dependency install, the CLI command will be re-run,\n  // thus we want to exit early\n  if ((await checkRequiredDependencies(context)).didInstall) {\n    return\n  }\n\n  // If the check resulted in a dependency install, the CLI command will be re-run,\n  // thus we want to exit early\n  const {didInstall, installedSanityVersion} = await checkRequiredDependencies(context)\n  if (didInstall) {\n    return\n  }\n\n  const autoUpdatesEnabled = shouldAutoUpdate({flags, cliConfig})\n\n  if (autoUpdatesEnabled) {\n    // Get the clean version without build metadata: https://semver.org/#spec-item-10\n    const cleanSanityVersion = semver.parse(installedSanityVersion)?.version\n    if (!cleanSanityVersion) {\n      throw new Error(`Failed to parse installed Sanity version: ${installedSanityVersion}`)\n    }\n\n    const sanityDependencies = [\n      {name: 'sanity', version: cleanSanityVersion},\n      {name: '@sanity/vision', version: cleanSanityVersion},\n    ]\n    const appId = getAppId({cliConfig, output})\n\n    output.print(`${logSymbols.info} Running with auto-updates enabled`)\n\n    // Check local versions against deployed versions\n    let result: Awaited<ReturnType<typeof compareDependencyVersions>> | undefined\n    try {\n      result = await compareDependencyVersions(sanityDependencies, workDir, {appId})\n    } catch (err) {\n      console.warn(\n        new Error('Failed to compare local versions against auto-updating versions', {\n          cause: err,\n        }),\n      )\n    }\n    if (result?.length) {\n      const message =\n        `The following local package versions are different from the versions currently served at runtime.\\n` +\n        `When using auto updates, we recommend that you run with the same versions locally as will be used when deploying. \\n\\n` +\n        `${result.map((mod) => ` - ${mod.pkg} (local version: ${mod.installed}, runtime version: ${mod.remote})`).join('\\n')} \\n\\n`\n\n      // mismatch between local and auto-updating dependencies\n      if (isInteractive) {\n        const shouldUpgrade = await prompt.single({\n          type: 'confirm',\n          message: chalk.yellow(`${message}Do you want to upgrade local versions?`),\n          default: true,\n        })\n        if (shouldUpgrade) {\n          await upgradePackages(\n            {\n              packageManager: (await getPackageManagerChoice(workDir, {interactive: false})).chosen,\n              packages: result.map((res) => [res.pkg, res.remote]),\n            },\n            context,\n          )\n        }\n      } else {\n        // In this case we warn the user but we don't ask them if they want to upgrade because it's not interactive.\n        output.print(chalk.yellow(message))\n      }\n    }\n  }\n\n  if (cliConfig?.schemaExtraction?.enabled) {\n    output.print(`${logSymbols.info} Running dev server with schema extraction enabled`)\n  }\n\n  // Try to load CLI configuration from sanity.cli.(js|ts)\n  const config = getDevServerConfig({flags, workDir, cliConfig, output})\n\n  const projectId = cliConfig?.api?.projectId\n  let organizationId: string | undefined | null\n\n  if (loadInDashboard) {\n    if (!projectId) {\n      output.error('Project Id is required to load in dashboard')\n      process.exit(1)\n    }\n\n    const client = apiClient({\n      requireUser: true,\n      requireProject: true,\n    })\n\n    try {\n      const project = await client.request<SanityProject>({uri: `/projects/${projectId}`})\n      organizationId = project.organizationId\n    } catch (err) {\n      debug(`Failed to get organization Id from project Id: ${err}`)\n      output.error('Failed to get organization Id from project Id')\n      process.exit(1)\n    }\n  }\n\n  try {\n    const startTime = Date.now()\n    const spinner = output.spinner('Starting dev server').start()\n    const {server} = await startDevServer({\n      ...config,\n      telemetryLogger: telemetry,\n    })\n\n    const {info: loggerInfo} = server.config.logger\n    const {port} = server.config.server\n    const httpHost = config.httpHost || 'localhost'\n\n    spinner.succeed()\n\n    if (loadInDashboard) {\n      if (!organizationId) {\n        output.error('Organization Id not found for project')\n        process.exit(1)\n      }\n\n      output.print(`Dev server started on ${config.httpPort} port`)\n      output.print(`View your app in the Sanity dashboard here:`)\n      output.print(\n        chalk.blue(\n          chalk.underline(\n            await getDashboardAppURL({\n              organizationId,\n              httpHost: config.httpHost,\n              httpPort: config.httpPort,\n            }),\n          ),\n        ),\n      )\n    } else {\n      const startupDuration = Date.now() - startTime\n      const url = `http://${httpHost || 'localhost'}:${port}${config.basePath}`\n      const appType = 'Sanity Studio'\n\n      loggerInfo(\n        `${appType} ` +\n          `using ${chalk.cyan(`vite@${version}`)} ` +\n          `ready in ${chalk.cyan(`${Math.ceil(startupDuration)}ms`)} ` +\n          `and running at ${chalk.cyan(url)}`,\n      )\n    }\n  } catch (err) {\n    debug(`Failed to start dev server: ${err}`)\n    gracefulServerDeath('dev', config.httpHost, config.httpPort, err)\n  }\n}\n\nexport function getDevServerConfig({\n  flags,\n  workDir,\n  cliConfig,\n  output,\n}: {\n  flags: {host?: string; port?: number}\n  workDir: string\n  cliConfig?: CliConfig\n  output: CliOutputter\n}): Omit<DevServerOptions, 'spinner'> {\n  const configSpinner = output.spinner('Checking configuration files...')\n  const baseConfig = getSharedServerConfig({\n    flags: {\n      host: flags.host,\n      port: flags.port,\n    },\n    workDir,\n    cliConfig,\n  })\n  configSpinner.succeed()\n\n  const env = process.env\n  const reactStrictMode = env.SANITY_STUDIO_REACT_STRICT_MODE\n    ? env.SANITY_STUDIO_REACT_STRICT_MODE === 'true'\n    : Boolean(cliConfig?.reactStrictMode)\n\n  if (env.SANITY_STUDIO_BASEPATH && cliConfig?.project?.basePath) {\n    output.warn(\n      `Overriding configured base path (${cliConfig.project.basePath}) with value from environment variable (${env.SANITY_STUDIO_BASEPATH})`,\n    )\n  }\n\n  return {\n    ...baseConfig,\n    staticPath: path.join(workDir, 'static'),\n    reactStrictMode,\n    reactCompiler: cliConfig && 'reactCompiler' in cliConfig ? cliConfig.reactCompiler : undefined,\n    typegen: cliConfig?.typegen,\n    schemaExtraction: cliConfig?.schemaExtraction,\n  }\n}\n"],"names":["startDevServer","options","cwd","httpPort","httpHost","basePath","reactStrictMode","vite","extendViteConfig","reactCompiler","entry","isApp","typegen","telemetryLogger","schemaExtraction","debug","writeSanityRuntime","watch","mode","viteConfig","getViteConfig","server","port","host","extendViteConfigWithUserConfig","command","createServer","listen","close","debugIt","extend","baseUrl","process","env","SANITY_INTERNAL_ENV","getDefaultDashboardURL","organizationId","url","URLSearchParams","dev","toString","getDashboardURL","fetchFn","globalThis","fetch","timeout","abortController","AbortController","timer","setTimeout","abort","queryParams","res","signal","ok","json","statusText","err","message","clearTimeout","getDashboardAppURL","parseCliFlags","args","yargs","hideBin","argv","slice","type","option","default","startSanityDevServer","context","timers","getTimer","flags","output","apiClient","workDir","cliConfig","prompt","telemetry","loadInDashboard","start","checkStudioDependencyVersions","end","checkRequiredDependencies","didInstall","installedSanityVersion","shouldAutoUpdate","cleanSanityVersion","semver","parse","version","Error","sanityDependencies","name","appId","getAppId","print","logSymbols","info","result","compareDependencyVersions","console","warn","cause","length","map","mod","pkg","installed","remote","join","isInteractive","single","chalk","yellow","upgradePackages","packageManager","getPackageManagerChoice","interactive","chosen","packages","enabled","config","getDevServerConfig","projectId","api","error","exit","client","requireUser","requireProject","request","uri","startTime","Date","now","spinner","loggerInfo","logger","succeed","blue","underline","startupDuration","cyan","Math","ceil","gracefulServerDeath","configSpinner","baseConfig","getSharedServerConfig","SANITY_STUDIO_REACT_STRICT_MODE","Boolean","SANITY_STUDIO_BASEPATH","project","staticPath","path","undefined"],"mappings":"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"}